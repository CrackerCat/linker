"use strict";(self["webpackChunklinker_web"]=self["webpackChunklinker_web"]||[]).push([[389],{3363:function(e,t,a){a.d(t,{EQ:function(){return r},QI:function(){return n},ZK:function(){return o},gv:function(){return s}});var l=a(4);const n=e=>(0,l.zG)("access/GetAccesss",e),o=e=>(0,l.zG)("access/SetAccess",e),r=()=>(0,l.zG)("access/refresh"),s=e=>(0,l.zG)("access/SetApiPassword",e)},9232:function(e,t,a){a.d(t,{W4:function(){return o},q:function(){return n},uQ:function(){return r}});var l=a(4);const n=e=>(0,l.zG)("relay/SetServers",e),o=()=>(0,l.zG)("relay/Subscribe"),r=e=>(0,l.zG)("relay/Connect",e)},743:function(e,t,a){a.d(t,{Ap:function(){return n},Co:function(){return o},DY:function(){return d},Qs:function(){return i},a9:function(){return s},eX:function(){return c},gz:function(){return u},pY:function(){return r}});var l=a(4);const n=()=>(0,l.zG)("sforward/GetSecretKey"),o=e=>(0,l.zG)("sforward/SetSecretKey",e),r=e=>(0,l.zG)("sforward/get",e),s=()=>(0,l.zG)("sforward/refresh"),u=(e="0")=>(0,l.zG)("sforward/getcount",e),d=e=>(0,l.zG)("sforward/remove",e),i=e=>(0,l.zG)("sforward/add",e),c=e=>(0,l.zG)("sforward/TestLocal",e)},83:function(e,t,a){a.d(t,{$M:function(){return s},KW:function(){return r},gM:function(){return o},r7:function(){return n}});var l=a(4);const n=(e="0")=>(0,l.zG)("tunnel/get",e),o=()=>(0,l.zG)("tunnel/refresh"),r=e=>(0,l.zG)("tunnel/SetRouteLevel",e),s=e=>(0,l.zG)("tunnel/SetTransports",e)},920:function(e,t,a){a.d(t,{BJ:function(){return c},Ce:function(){return v},NS:function(){return r},PY:function(){return d},UB:function(){return p},Vk:function(){return i},aP:function(){return m},ir:function(){return u},lJ:function(){return o},mK:function(){return n},y2:function(){return h},yN:function(){return s}});var l=a(4);const n=(e="0")=>(0,l.zG)("updater/get",e),o=e=>(0,l.zG)("updater/confirm",e),r=e=>(0,l.zG)("updater/exit",e),s=()=>(0,l.zG)("updater/GetSecretKey"),u=e=>(0,l.zG)("updater/SetSecretKey",e),d=e=>(0,l.zG)("updater/SetInterval",e),i=()=>(0,l.zG)("updater/getcurrent"),c=()=>(0,l.zG)("updater/getserver"),h=e=>(0,l.zG)("updater/confirmserver",e),m=()=>(0,l.zG)("updater/exitserver"),p=()=>(0,l.zG)("updater/Subscribe"),v=e=>(0,l.zG)("updater/check",e)},5962:function(e,t,a){a.d(t,{Y:function(){return s},q:function(){return u}});var l=a(3363),n=a(144),o=a(6768);const r=Symbol(),s=()=>{const e=(0,n.KR)({list:{},timer:0,hashcode:0});(0,o.Gt)(r,e);const t=()=>{(0,l.EQ)()},a=()=>{(0,l.QI)(e.value.hashcode.toString()).then((t=>{e.value.hashcode=t.HashCode,t.List&&(e.value.list=t.List),e.value.timer=setTimeout(a,1e3)})).catch((()=>{e.value.timer=setTimeout(a,1e3)}))},s=()=>{clearTimeout(e.value.timer)};return{access:e,_getAccessInfo:a,clearAccessTimeout:s,handleAccesssRefresh:t}},u=()=>(0,o.WQ)(r)},9383:function(e,t,a){a.d(t,{T:function(){return d},d:function(){return u}});var l=a(920),n=a(3830),o=a(144),r=a(6768);const s=Symbol(),u=()=>{const e=(0,n.B)(),t=(0,o.KR)({timer:0,list:{},hashcode:0,current:{Version:"",Msg:[],DateTime:"",Status:0,Length:0,Current:0},subscribeTimer:0,device:{},show:!1});(0,r.Gt)(s,t);const a=()=>{(0,l.mK)(t.value.hashcode.toString()).then((l=>{if(t.value.hashcode=l.HashCode,l.List){const a=Object.values(l.List).filter((e=>!!e.Version))[0];a&&(Object.assign(t.value.current,{DateTime:a.DateTime,Version:a.Version,Status:a.Status,Length:a.Length,Current:a.Current,Msg:a.Msg}),e.value.updater=t.value.current),t.value.list=l.List}t.value.timer=setTimeout(a,800)})).catch((()=>{t.value.timer=setTimeout(a,800)}))},u=()=>{(0,l.UB)().then((()=>{t.value.subscribeTimer=setTimeout(u,5e3)})).catch((()=>{t.value.subscribeTimer=setTimeout(u,5e3)}))},d=()=>{clearTimeout(t.value.timer),clearTimeout(t.value.subscribeTimer)};return{updater:t,_getUpdater:a,_subscribeUpdater:u,clearUpdaterTimeout:d}},d=()=>(0,r.WQ)(s)},6158:function(e,t,a){a.d(t,{A:function(){return c}});var l=a(6768);function n(e,t,a,n,o,r){const s=(0,l.g2)("el-checkbox"),u=(0,l.g2)("el-col"),d=(0,l.g2)("el-row"),i=(0,l.g2)("el-checkbox-group");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(u,{span:8},{default:(0,l.k6)((()=>[(0,l.bF)(s,{modelValue:n.state.checkAll,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.checkAll=e),onChange:n.handleCheckAllChange,label:"全选",indeterminate:n.state.isIndeterminate},null,8,["modelValue","onChange","indeterminate"])])),_:1})])),_:1}),(0,l.bF)(i,{modelValue:n.state.checkList,"onUpdate:modelValue":t[1]||(t[1]=e=>n.state.checkList=e),onChange:n.handleCheckedChange},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.access,((e,t)=>((0,l.uX)(),(0,l.Wv)(u,{key:t,span:8},{default:(0,l.k6)((()=>[(0,l.bF)(s,{value:e.Value,label:e.Text},null,8,["value","label"])])),_:2},1024)))),128))])),_:1})])),_:1},8,["modelValue","onChange"])],64)}a(4114);var o=a(144),r=a(3830),s=a(5962),u={props:["machineid"],setup(e){const t=(0,r.B)(),a=(0,s.q)(),n=(0,l.EW)((()=>{const e=t.value.config.Client.Accesss;return Object.keys(e).reduce(((a,l,n)=>{if(t.value.hasAccess(l)){const t=e[l];t.Key=l,a.push(t)}return a}),[])})),u=(0,o.Kh)({checkList:[t.value.config.Client.Accesss.Api.Value,t.value.config.Client.Accesss.Web.Value,t.value.config.Client.Accesss.NetManager.Value,t.value.config.Client.Accesss.FullManager.Value,t.value.config.Client.Accesss.Transport.Value,t.value.config.Client.Accesss.Action.Value,t.value.config.Client.Accesss.Group.Value],checkAll:!1,isIndeterminate:!1}),d=()=>+u.checkList.reduce(((e,t)=>e|BigInt(t)),BigInt(0)).toString(),i=e=>{const t=e.length;u.checkAll=t===n.value.length,u.isIndeterminate=t>0&&t<n.value.length},c=e=>{u.checkAll=e,u.checkList=e?n.value.map((e=>e.Value)):[],u.isIndeterminate=!1};return(0,l.sV)((()=>{if(a&&a.value.list[e.machineid]){const t=a.value.list[e.machineid];u.checkList=n.value.reduce(((e,a)=>(+(BigInt(t)&BigInt(a.Value)).toString()==a.Value&&e.push(a.Value),e)),[])}i(u.checkList)})),{state:u,access:n,getValue:d,handleCheckAllChange:c,handleCheckedChange:i}}},d=a(1241);const i=(0,d.A)(u,[["render",n],["__scopeId","data-v-7a697708"]]);var c=i},9882:function(e,t,a){a.r(t),a.d(t,{default:function(){return pl}});var l=a(6768);const n={class:"home-list-wrap absolute"},o={class:"page t-c"},r={class:"page-wrap"};function s(e,t,a,s,u,d){const i=(0,l.g2)("Sort"),c=(0,l.g2)("Device"),h=(0,l.g2)("Tunnel"),m=(0,l.g2)("Tuntap"),p=(0,l.g2)("Socks5"),v=(0,l.g2)("Forward"),g=(0,l.g2)("Oper"),k=(0,l.g2)("el-table"),f=(0,l.g2)("el-pagination"),w=(0,l.g2)("DeviceEdit"),b=(0,l.g2)("AccessEdit"),C=(0,l.g2)("TunnelEdit"),F=(0,l.g2)("ConnectionsEdit"),L=(0,l.g2)("TuntapEdit"),E=(0,l.g2)("Socks5Edit"),_=(0,l.g2)("TuntapLease"),V=(0,l.g2)("ForwardEdit"),I=(0,l.g2)("SForwardEdit"),y=(0,l.g2)("UpdaterConfirm");return(0,l.uX)(),(0,l.CE)("div",n,[(0,l.bF)(i,{onSort:s.handleSortChange},null,8,["onSort"]),(0,l.bF)(k,{data:s.devices.page.List,stripe:"",border:"",style:{width:"100%"},height:`${s.state.height}px`,size:"small"},{default:(0,l.k6)((()=>[(0,l.bF)(c,{onEdit:s.handleDeviceEdit,onRefresh:s.handlePageRefresh},null,8,["onEdit","onRefresh"]),(0,l.bF)(h,{onEdit:s.handleTunnelEdit,onRefresh:s.handleTunnelRefresh,onConnections:s.handleTunnelConnections},null,8,["onEdit","onRefresh","onConnections"]),s.tuntap.show?((0,l.uX)(),(0,l.Wv)(m,{key:0,onEdit:s.handleTuntapEdit,onRefresh:s.handleTuntapRefresh},null,8,["onEdit","onRefresh"])):(0,l.Q3)("",!0),s.socks5.show?((0,l.uX)(),(0,l.Wv)(p,{key:1,onEdit:s.handleSocks5Edit,onRefresh:s.handleSocks5Refresh},null,8,["onEdit","onRefresh"])):(0,l.Q3)("",!0),s.forward.show?((0,l.uX)(),(0,l.Wv)(v,{key:2,onEdit:s.handleForwardEdit,onSedit:s.handleSForwardEdit},null,8,["onEdit","onSedit"])):(0,l.Q3)("",!0),(0,l.bF)(g,{onRefresh:s.handlePageRefresh,onAccess:s.handleAccessEdit},null,8,["onRefresh","onAccess"])])),_:1},8,["data","height"]),(0,l.Lk)("div",o,[(0,l.Lk)("div",r,[(0,l.bF)(f,{small:"",background:"",layout:"total,sizes,prev,pager, next",total:s.devices.page.Count,"page-size":s.devices.page.Request.Size,"current-page":s.devices.page.Request.Page,onCurrentChange:s.handlePageChange,onSizeChange:s.handlePageSizeChange,"page-sizes":[10,20,50,100,255]},null,8,["total","page-size","current-page","onCurrentChange","onSizeChange"])])]),s.devices.showDeviceEdit?((0,l.uX)(),(0,l.Wv)(w,{key:0,modelValue:s.devices.showDeviceEdit,"onUpdate:modelValue":t[0]||(t[0]=e=>s.devices.showDeviceEdit=e),onChange:s.handlePageChange,data:s.devices.deviceInfo},null,8,["modelValue","onChange","data"])):(0,l.Q3)("",!0),s.devices.showAccessEdit?((0,l.uX)(),(0,l.Wv)(b,{key:1,modelValue:s.devices.showAccessEdit,"onUpdate:modelValue":t[1]||(t[1]=e=>s.devices.showAccessEdit=e),onChange:s.handlePageChange,data:s.devices.deviceInfo},null,8,["modelValue","onChange","data"])):(0,l.Q3)("",!0),s.tunnel.showEdit?((0,l.uX)(),(0,l.Wv)(C,{key:2,modelValue:s.tunnel.showEdit,"onUpdate:modelValue":t[2]||(t[2]=e=>s.tunnel.showEdit=e),onChange:s.handleTunnelRefresh},null,8,["modelValue","onChange"])):(0,l.Q3)("",!0),s.connections.showEdit?((0,l.uX)(),(0,l.Wv)(F,{key:3,modelValue:s.connections.showEdit,"onUpdate:modelValue":t[3]||(t[3]=e=>s.connections.showEdit=e)},null,8,["modelValue"])):(0,l.Q3)("",!0),s.tuntap.showEdit?((0,l.uX)(),(0,l.Wv)(L,{key:4,modelValue:s.tuntap.showEdit,"onUpdate:modelValue":t[4]||(t[4]=e=>s.tuntap.showEdit=e),onChange:s.handleTuntapRefresh},null,8,["modelValue","onChange"])):(0,l.Q3)("",!0),s.socks5.showEdit?((0,l.uX)(),(0,l.Wv)(E,{key:5,modelValue:s.socks5.showEdit,"onUpdate:modelValue":t[5]||(t[5]=e=>s.socks5.showEdit=e),onChange:s.handleSocks5Refresh},null,8,["modelValue","onChange"])):(0,l.Q3)("",!0),s.tuntap.showLease?((0,l.uX)(),(0,l.Wv)(_,{key:6,modelValue:s.tuntap.showLease,"onUpdate:modelValue":t[6]||(t[6]=e=>s.tuntap.showLease=e),onChange:s.handleTuntapRefresh},null,8,["modelValue","onChange"])):(0,l.Q3)("",!0),s.forward.showEdit?((0,l.uX)(),(0,l.Wv)(V,{key:7,modelValue:s.forward.showEdit,"onUpdate:modelValue":t[7]||(t[7]=e=>s.forward.showEdit=e)},null,8,["modelValue"])):(0,l.Q3)("",!0),s.sforward.showEdit?((0,l.uX)(),(0,l.Wv)(I,{key:8,modelValue:s.sforward.showEdit,"onUpdate:modelValue":t[8]||(t[8]=e=>s.sforward.showEdit=e)},null,8,["modelValue"])):(0,l.Q3)("",!0),s.updater.show?((0,l.uX)(),(0,l.Wv)(y,{key:9,modelValue:s.updater.show,"onUpdate:modelValue":t[9]||(t[9]=e=>s.updater.show=e)},null,8,["modelValue"])):(0,l.Q3)("",!0)])}a(4114);var u=a(3830),d=a(144),i=a(1219);function c(e,t,a,n,o,r){const s=(0,l.g2)("el-table-column"),u=(0,l.g2)("el-checkbox"),d=(0,l.g2)("el-table");return(0,l.uX)(),(0,l.Wv)(d,{border:"",style:{width:"100%"},height:"32px",size:"small",onSortChange:n.handleSortChange,class:"table-sort"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{prop:"MachineId",label:"设备名",width:"110",sortable:"custom"}),(0,l.bF)(s,{prop:"Version",label:"版本",width:"110",sortable:"custom"}),(0,l.bF)(s,{prop:"tunnel",label:"网关",width:"76",sortable:"custom"}),n.tuntap.show?((0,l.uX)(),(0,l.Wv)(s,{key:0,prop:"tuntap",label:"网卡IP",width:"160",sortable:"custom"})):(0,l.Q3)("",!0),n.socks5.show?((0,l.uX)(),(0,l.Wv)(s,{key:1,prop:"socks5",label:"代理转发",width:"160",sortable:"custom"})):(0,l.Q3)("",!0),(0,l.bF)(s,{label:"columns",fixed:"right"},{header:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:n.tuntap.show,"onUpdate:modelValue":t[0]||(t[0]=e=>n.tuntap.show=e),onChange:n.handleTuntapShow,size:"small",style:{"margin-right":"1rem"}},{default:(0,l.k6)((()=>[(0,l.eW)("网卡")])),_:1},8,["modelValue","onChange"]),(0,l.bF)(u,{modelValue:n.socks5.show,"onUpdate:modelValue":t[1]||(t[1]=e=>n.socks5.show=e),onChange:n.handleSocks5Show,size:"small",style:{"margin-right":"1rem"}},{default:(0,l.k6)((()=>[(0,l.eW)("代理")])),_:1},8,["modelValue","onChange"]),(0,l.bF)(u,{modelValue:n.forward.show,"onUpdate:modelValue":t[2]||(t[2]=e=>n.forward.show=e),onChange:n.handleForwardShow,size:"small",style:{"margin-right":"0rem"}},{default:(0,l.k6)((()=>[(0,l.eW)("转发")])),_:1},8,["modelValue","onChange"])])),_:1})])),_:1},8,["onSortChange"])}var h=a(7716);const m=Symbol(),p=()=>{(0,u.B)();const e=(0,d.KR)({show:!0,timer:0,showEdit:!1,machineId:null,list:{},hashcode:0});(0,l.Gt)(m,e);const t=()=>{(0,h.dS)()},a=()=>{(0,h.V1)(e.value.hashcode.toString()).then((t=>{e.value.hashcode=t.HashCode,t.List&&(e.value.list=t.List),e.value.timer=setTimeout(a,1020)})).catch((()=>{e.value.timer=setTimeout(a,1020)}))},n=t=>{e.value.machineId=t[0],e.value.machineName=t[1],e.value.showEdit=!0},o=()=>{clearTimeout(e.value.timer)};return{forward:e,_getForwardCountInfo:a,handleForwardEdit:n,clearForwardTimeout:o,handleForwardRefresh:t}},v=()=>(0,l.WQ)(m);var g=a(2173);const k=Symbol(),f=()=>{const e=(0,d.KR)({show:!0,timer:0,showEdit:!1,current:null,list:{},hashcode:0});(0,l.Gt)(k,e);const t=()=>{clearTimeout(e.value.timer),(0,g.$y)(e.value.hashcode.toString()).then((a=>{if(e.value.hashcode=a.HashCode,a.List){for(let e in a.List)Object.assign(a.List[e],{running:2==a.List[e].Status,loading:1==a.List[e].Status});e.value.list=a.List}e.value.timer=setTimeout(t,1100)})).catch((a=>{e.value.timer=setTimeout(t,1100)}))},a=t=>{e.value.current=t,e.value.showEdit=!0},n=()=>{(0,g.QP)()},o=()=>{clearTimeout(e.value.timer),e.value.timer=0},r=t=>Object.values(e.value.list).filter((e=>e.Port.toString().indexOf(t)>=0||e.Lans.filter((e=>e.IP.indexOf(t)>=0)).length>0)).map((e=>e.MachineId)),s=t=>{const a=Object.values(e.value.list).sort(((e,t)=>e.Port-t.Port));return a.map((e=>e.MachineId))};return{socks5:e,_getSocks5Info:t,handleSocks5Edit:a,handleSocks5Refresh:n,clearSocks5Timeout:o,getSocks5Machines:r,sortSocks5:s}},w=()=>(0,l.WQ)(k);var b=a(8104),C={emits:["sort"],setup(e,{emit:t}){const a=(0,b.W)();a.value.show="false"!=localStorage.getItem("tuntap.show");const l=w();l.value.show="false"!=localStorage.getItem("socks5.show");const n=v();n.value.show="false"!=localStorage.getItem("forward.show");const o=e=>{t("sort",e)},r=()=>{localStorage.setItem("tuntap.show",a.value.show)},s=()=>{localStorage.setItem("socks5.show",l.value.show)},u=()=>{localStorage.setItem("forward.show",n.value.show)};return{tuntap:a,socks5:l,forward:n,handleSortChange:o,handleTuntapShow:r,handleSocks5Show:s,handleForwardShow:u}}},F=a(1241);const L=(0,F.A)(C,[["render",c],["__scopeId","data-v-4b2df38c"]]);var E=L;const _=e=>((0,l.Qi)("data-v-6e34f330"),e=e(),(0,l.jt)(),e),V={class:"dropdown"},I=_((()=>(0,l.Lk)("span",null,"操作",-1)));function y(e,t,a,n,o,r){const s=(0,l.g2)("ArrowDown"),u=(0,l.g2)("el-icon"),d=(0,l.g2)("SwitchButton"),i=(0,l.g2)("el-dropdown-item"),c=(0,l.g2)("Delete"),h=(0,l.g2)("Flag"),m=(0,l.g2)("HelpFilled"),p=(0,l.g2)("el-dropdown-menu"),v=(0,l.g2)("el-dropdown"),g=(0,l.g2)("el-table-column");return(0,l.uX)(),(0,l.Wv)(g,{label:"操作",fixed:"right"},{default:(0,l.k6)((e=>[(0,l.bF)(v,{size:"small"},{dropdown:(0,l.k6)((()=>[(0,l.bF)(p,null,{default:(0,l.k6)((()=>[e.row.showReboot&&n.hasReboot?((0,l.uX)(),(0,l.Wv)(i,{key:0,onClick:t=>n.handleExit(e.row.MachineId,e.row.MachineName)},{default:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(d)])),_:1}),(0,l.eW)(" 重启")])),_:2},1032,["onClick"])):(0,l.Q3)("",!0),e.row.showDel&&n.hasRemove?((0,l.uX)(),(0,l.Wv)(i,{key:1,onClick:t=>n.handleDel(e.row.MachineId,e.row.MachineName)},{default:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(c)])),_:1}),(0,l.eW)(" 删除")])),_:2},1032,["onClick"])):(0,l.Q3)("",!0),n.handleShowAccess(e.row,n.accessList[e.row.MachineId]||0)?((0,l.uX)(),(0,l.Wv)(i,{key:2,onClick:t=>n.handleAccess(e.row)},{default:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(h)])),_:1}),(0,l.eW)(" 权限")])),_:2},1032,["onClick"])):(0,l.Q3)("",!0),e.row.isSelf&&n.hasApiPassword?((0,l.uX)(),(0,l.Wv)(i,{key:3,onClick:t=>n.handleApiPassword(e.row)},{default:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(m)])),_:1}),(0,l.eW)(" 管理接口")])),_:2},1032,["onClick"])):n.hasApiPasswordOther?((0,l.uX)(),(0,l.Wv)(i,{key:4,onClick:t=>n.handleApiPassword(e.row)},{default:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(m)])),_:1}),(0,l.eW)(" 管理接口")])),_:2},1032,["onClick"])):(0,l.Q3)("",!0)])),_:2},1024)])),default:(0,l.k6)((()=>[(0,l.Lk)("div",V,[I,(0,l.bF)(u,{class:"el-icon--right"},{default:(0,l.k6)((()=>[(0,l.bF)(s)])),_:1})])])),_:2},1024)])),_:1})}var S=a(9299),P=a(920),T=a(7477),M=a(2933),A=a(5962),W=a(3363),R={emits:["refresh","access"],components:{Delete:T.epd,SwitchButton:T.L$q,ArrowDown:T.yd$,Flag:T.lNU,HelpFilled:T.adD},setup(e,{emit:t}){const a=(0,u.B)(),n=(0,A.q)(),o=(0,l.EW)((()=>a.value.config.Client.Access)),r=(0,l.EW)((()=>a.value.hasAccess("Access"))),s=(0,l.EW)((()=>n.value.list)),d=(0,l.EW)((()=>a.value.hasAccess("Reboot"))),c=(0,l.EW)((()=>a.value.hasAccess("Remove"))),h=(0,l.EW)((()=>a.value.hasAccess("SetApiPassword"))),m=(0,l.EW)((()=>a.value.hasAccess("SetApiPasswordOther"))),p=(e,a)=>{M.s.confirm(`确认删除[${a}]?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,S.Se)(e).then((()=>{t("refresh")}))})).catch((()=>{}))},v=(e,a)=>{M.s.confirm(`确认关闭[${a}]?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,P.NS)(e).then((()=>{t("refresh")}))})).catch((()=>{}))},g=(e,t)=>e.showAccess&&r.value&&t>=0&&0==+(~BigInt(o.value)&BigInt(t)).toString(),k=e=>{t("access",e)},f=e=>{M.s.prompt("输入新的管理接口密码",`重置【${e.MachineName}】的接口密码`,{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^[0-9a-zA-Z]{1,32}$/,inputErrorMessage:"数字字母1-32位"}).then((({value:t})=>{(0,W.gv)({machineId:e.MachineId,password:t}).then((()=>{i.nk.success("操作成功，重启后生效~")})).catch((()=>{i.nk.error("操作失败~")}))})).catch((()=>{}))};return{accessList:s,handleDel:p,handleExit:v,hasReboot:d,hasRemove:c,hasAccess:r,handleShowAccess:g,handleAccess:k,hasApiPassword:h,hasApiPasswordOther:m,handleApiPassword:f}}};const X=(0,F.A)(R,[["render",y],["__scopeId","data-v-6e34f330"]]);var N=X,B=a(4232);const z=e=>((0,l.Qi)("data-v-5db71b03"),e=e(),(0,l.jt)(),e),x={class:"flex"},U=z((()=>(0,l.Lk)("span",{class:"flex-1"},"设备",-1))),D={class:"flex"},K=["onClick"],$=["onClick"],G=z((()=>(0,l.Lk)("span",null,"😴㊙.㊙.㊙.㊙",-1))),Q=[G],O=z((()=>(0,l.Lk)("span",{class:"flex-1"},null,-1)));function j(e,t,a,n,o,r){const s=(0,l.g2)("el-input"),u=(0,l.g2)("Search"),d=(0,l.g2)("el-icon"),i=(0,l.g2)("el-button"),c=(0,l.g2)("DeviceName"),h=(0,l.g2)("UpdaterBtn"),m=(0,l.g2)("el-table-column");return(0,l.uX)(),(0,l.Wv)(m,{prop:"MachineId",label:"设备",width:"220"},{header:(0,l.k6)((()=>[(0,l.Lk)("div",x,[U,(0,l.Lk)("span",null,[(0,l.bF)(s,{size:"small",modelValue:n.name,"onUpdate:modelValue":t[0]||(t[0]=e=>n.name=e),clearable:"",onInput:n.handleRefresh,placeholder:"设备/虚拟网卡/端口转发"},null,8,["modelValue","onInput"])]),(0,l.Lk)("span",null,[(0,l.bF)(i,{size:"small",onClick:n.handleRefresh},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(u)])),_:1})])),_:1},8,["onClick"])])])])),default:(0,l.k6)((e=>[(0,l.Lk)("div",null,[(0,l.Lk)("p",null,[(0,l.bF)(c,{onEdit:n.handleEdit,config:!0,item:e.row},null,8,["onEdit","item"])]),(0,l.Lk)("p",D,[e.row.showip?((0,l.uX)(),(0,l.CE)("span",{key:0,title:"此设备的外网IP",class:"ipaddress",onClick:t=>n.handleExternal(e.row)},[(0,l.Lk)("span",null,"😀"+(0,B.v_)(e.row.IP),1)],8,K)):((0,l.uX)(),(0,l.CE)("span",{key:1,title:"此设备的外网IP",class:"ipaddress",onClick:t=>n.handleExternal(e.row)},Q,8,$)),O,0==e.row.showip?((0,l.uX)(),(0,l.Wv)(h,{key:2,config:!0,item:e.row},null,8,["item"])):(0,l.Q3)("",!0)])])])),_:1})}var q=a(4001),H=a(3347),J={emits:["edit","refresh"],components:{Search:T.vji,UpdaterBtn:q.A,DeviceName:H.A},setup(e,{emit:t}){const a=(0,u.B)(),n=(0,l.EW)((()=>a.value.hasAccess("ExternalShow"))),o=(0,d.KR)(sessionStorage.getItem("search-name")||""),r=e=>{n.value&&(e.showip=!e.showip)},s=e=>{t("edit",e)},i=()=>{sessionStorage.setItem("search-name",o.value),t("refresh",o.value)};return{handleEdit:s,handleRefresh:i,name:o,handleExternal:r}}};const Y=(0,F.A)(J,[["render",j],["__scopeId","data-v-5db71b03"]]);var Z=Y;const ee=(0,l.Lk)("div",null,"修改后最好能重启一次客户端",-1),te={class:"t-c w-100"};function ae(e,t,a,n,o,r){const s=(0,l.g2)("el-form-item"),u=(0,l.g2)("el-input"),d=(0,l.g2)("el-button"),i=(0,l.g2)("el-form"),c=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(c,{modelValue:n.state.show,"onUpdate:modelValue":t[2]||(t[2]=e=>n.state.show=e),"close-on-click-modal":!1,"append-to":".app-wrap",title:`设置[${n.state.ruleForm.MachineName}]设备`,width:"360"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(i,{ref:"ruleFormRef",model:n.state.ruleForm,rules:n.state.rules,"label-width":"auto"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{label:""},{default:(0,l.k6)((()=>[ee])),_:1}),(0,l.bF)(s,{label:"设备名",prop:"MachineName"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{maxlength:"32","show-word-limit":"",modelValue:n.state.ruleForm.MachineName,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.ruleForm.MachineName=e)},null,8,["modelValue"])])),_:1}),(0,l.bF)(s,{label:"",prop:"Btns"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",te,[(0,l.bF)(d,{onClick:t[1]||(t[1]=e=>n.state.show=!1)},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1}),(0,l.bF)(d,{type:"primary",onClick:n.handleSave},{default:(0,l.k6)((()=>[(0,l.eW)("确认")])),_:1},8,["onClick"])])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])}var le={props:["data","modelValue"],emits:["change","update:modelValue"],setup(e,{emit:t}){const a=(0,d.KR)(null),n=(0,d.Kh)({show:!0,ruleForm:{MachineName1:e.data.MachineName,MachineName:e.data.MachineName},rules:{}});(0,l.wB)((()=>n.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const o=()=>{e.data.MachineName!=n.ruleForm.MachineName&&(0,S.gC)({Id:e.data.MachineId,newName:n.ruleForm.MachineName}).then((()=>{n.show=!1,i.nk.success("已操作！"),t("change")})).catch((e=>{console.log(e),i.nk.error("操作失败！")}))};return{state:n,ruleFormRef:a,handleSave:o}}};const ne=(0,F.A)(le,[["render",ae]]);var oe=ne,re=a(7985);function se(e,t,a,n,o,r){const s=(0,l.g2)("Access"),u=(0,l.g2)("el-button"),d=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(d,{modelValue:n.state.show,"onUpdate:modelValue":t[1]||(t[1]=e=>n.state.show=e),"close-on-click-modal":!1,center:"","append-to":".app-wrap",title:`设置[${n.machineName}]的权限`,width:"580",top:"1vh"},{footer:(0,l.k6)((()=>[(0,l.bF)(u,{plain:"",onClick:t[0]||(t[0]=e=>n.state.show=!1),loading:n.state.loading},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1},8,["loading"]),(0,l.bF)(u,{type:"success",plain:"",onClick:n.handleSave,loading:n.state.loading},{default:(0,l.k6)((()=>[(0,l.eW)("确定保存")])),_:1},8,["onClick","loading"])])),default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(s,{machineid:n.machineid,ref:"accessDom"},null,8,["machineid"])])])),_:1},8,["modelValue","title"])}var ue=a(6158),de={props:["data","modelValue"],emits:["change","update:modelValue"],components:{Access:ue.A},setup(e,{emit:t}){const a=(0,d.Kh)({show:!0,loading:!1});(0,l.wB)((()=>a.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const n=(0,d.KR)(null),o=()=>{a.loading=!0,(0,W.ZK)({ToMachineId:e.data.MachineId,Access:n.value.getValue()}).then((()=>{a.loading=!1,a.show=!1,i.nk.success("已操作！"),t("change")})).catch((e=>{console.log(e),a.loading=!1,i.nk.error("操作失败！")}))};return{machineName:e.data.MachineName,machineid:e.data.MachineId,state:a,accessDom:n,handleSave:o}}};const ie=(0,F.A)(de,[["render",se]]);var ce=ie;const he={key:0};function me(e,t,a,n,o,r){const s=(0,l.g2)("TuntapShow"),u=(0,l.g2)("el-table-column");return(0,l.uX)(),(0,l.Wv)(u,{prop:"tuntap",label:"虚拟网卡",width:"160"},{header:(0,l.k6)((()=>[(0,l.Lk)("a",{href:"javascript:;",class:"a-line",onClick:t[0]||(t[0]=(...e)=>n.handleShowLease&&n.handleShowLease(...e))},"虚拟网卡")])),default:(0,l.k6)((e=>[n.tuntap.list[e.row.MachineId]?((0,l.uX)(),(0,l.CE)("div",he,[(0,l.bF)(s,{config:!0,item:e.row,onEdit:n.handleTuntapIP,onRefresh:n.handleTuntapRefresh},null,8,["item","onEdit","onRefresh"])])):(0,l.Q3)("",!0)])),_:1})}var pe=a(9982),ve={emits:["edit","refresh"],components:{TuntapShow:pe.A},setup(e,{emit:t}){const a=(0,b.W)(),l=e=>{t("edit",e)},n=()=>{t("refresh")},o=()=>{a.value.showLease=!0};return{tuntap:a,handleTuntapIP:l,handleTuntapRefresh:n,handleShowLease:o}}};const ge=(0,F.A)(ve,[["render",me]]);var ke=ge;const fe=e=>((0,l.Qi)("data-v-078917af"),e=e(),(0,l.jt)(),e),we=fe((()=>(0,l.Lk)("span",null,"留空则使用【本组网络】的设置",-1))),be=fe((()=>(0,l.Lk)("span",null,"/",-1))),Ce=fe((()=>(0,l.Lk)("span",{style:{width:"2rem"}},null,-1))),Fe={key:0,class:"upgrade-wrap"},Le={class:"w-100 t-c"};function Ee(e,t,a,n,o,r){const s=(0,l.g2)("el-input"),u=(0,l.g2)("el-form-item"),d=(0,l.g2)("el-checkbox"),i=(0,l.g2)("TuntapLan"),c=(0,l.g2)("TuntapForward"),h=(0,l.g2)("el-button"),m=(0,l.g2)("el-form"),p=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(p,{modelValue:n.state.show,"onUpdate:modelValue":t[9]||(t[9]=e=>n.state.show=e),"close-on-click-modal":!1,"append-to":".app-wrap",title:`设置[${n.state.machineName}]组网`,top:"1vh",width:"760"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(m,{ref:"ruleFormRef",model:n.state.ruleForm,rules:n.state.rules,"label-width":"8rem"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{label:"网卡名",prop:"Name"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{modelValue:n.state.ruleForm.Name,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.ruleForm.Name=e),style:{width:"14rem"}},null,8,["modelValue"]),(0,l.eW)(),we])),_:1}),(0,l.bF)(u,{label:"网卡IP",prop:"IP"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{modelValue:n.state.ruleForm.IP,"onUpdate:modelValue":t[1]||(t[1]=e=>n.state.ruleForm.IP=e),style:{width:"14rem"}},null,8,["modelValue"]),be,(0,l.bF)(s,{onChange:n.handlePrefixLengthChange,modelValue:n.state.ruleForm.PrefixLength,"onUpdate:modelValue":t[2]||(t[2]=e=>n.state.ruleForm.PrefixLength=e),style:{width:"4rem"}},null,8,["onChange","modelValue"]),Ce,(0,l.bF)(d,{modelValue:n.state.ruleForm.ShowDelay,"onUpdate:modelValue":t[3]||(t[3]=e=>n.state.ruleForm.ShowDelay=e),label:"显示延迟",size:"large",style:{"margin-right":"1rem"}},null,8,["modelValue"]),(0,l.bF)(d,{modelValue:n.state.ruleForm.AutoConnect,"onUpdate:modelValue":t[4]||(t[4]=e=>n.state.ruleForm.AutoConnect=e),label:"自动连接",size:"large",style:{"margin-right":"1rem"}},null,8,["modelValue"]),(0,l.bF)(d,{modelValue:n.state.ruleForm.Multicast,"onUpdate:modelValue":t[5]||(t[5]=e=>n.state.ruleForm.Multicast=e),label:"禁用广播",size:"large"},null,8,["modelValue"]),(0,l.bF)(d,{modelValue:n.state.ruleForm.Nat,"onUpdate:modelValue":t[6]||(t[6]=e=>n.state.ruleForm.Nat=e),label:"禁用NAT",size:"large"},null,8,["modelValue"])])),_:1}),(0,l.bF)(u,{prop:"upgrade",class:"m-b-0"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{modelValue:n.state.ruleForm.Upgrade,"onUpdate:modelValue":t[7]||(t[7]=e=>n.state.ruleForm.Upgrade=e),label:"我很懂，我要使用高级功能(点对网和网对网)",size:"large"},null,8,["modelValue"])])),_:1}),n.state.ruleForm.Upgrade?((0,l.uX)(),(0,l.CE)("div",Fe,[(0,l.bF)(u,{label:"局域网IP",prop:"LanIP",class:"m-b-0",style:{"border-bottom":"1px solid #ddd"}},{default:(0,l.k6)((()=>[(0,l.bF)(i,{ref:"lanDom"},null,512)])),_:1}),(0,l.bF)(u,{label:"端口转发",prop:"forwards"},{default:(0,l.k6)((()=>[(0,l.bF)(c,{ref:"forwardDom"},null,512)])),_:1})])):(0,l.Q3)("",!0),(0,l.bF)(u,{label:"",prop:"Btns","label-width":"0"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",Le,[(0,l.bF)(h,{onClick:t[8]||(t[8]=e=>n.state.show=!1)},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1}),(0,l.bF)(h,{type:"primary",onClick:n.handleSave},{default:(0,l.k6)((()=>[(0,l.eW)("确认")])),_:1},8,["onClick"])])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])}var _e=a(5241);const Ve=e=>((0,l.Qi)("data-v-786fe646"),e=e(),(0,l.jt)(),e),Ie={class:"w-100"},ye=Ve((()=>(0,l.Lk)("span",{class:"yellow"},"此设备无法使用NAT转发，或只想使用端口转发",-1))),Se={key:0,class:"green"},Pe={class:"wrap"},Te=["title"],Me={key:1},Ae=["title"],We={key:1},Re=["title"],Xe={key:1},Ne={key:1,class:"remark"};function Be(e,t,a,n,o,r){const s=(0,l.g2)("el-input"),u=(0,l.g2)("el-table-column"),d=(0,l.g2)("Delete"),i=(0,l.g2)("el-icon"),c=(0,l.g2)("el-button"),h=(0,l.g2)("el-popconfirm"),m=(0,l.g2)("Plus"),p=(0,l.g2)("el-table");return(0,l.uX)(),(0,l.CE)("div",Ie,[(0,l.Lk)("div",null,[ye,n.state.testing?((0,l.uX)(),(0,l.CE)("span",Se,"、testing")):(0,l.Q3)("",!0)]),(0,l.Lk)("div",Pe,[(0,l.bF)(p,{stripe:"",data:n.state.forwards,border:"",size:"small",width:"100%",height:"300px",onCellDblclick:n.handleCellClick},{default:(0,l.k6)((()=>[(0,l.bF)(u,{prop:"ListenPort",label:"源端口",width:"60"},{default:(0,l.k6)((e=>[e.row.ListenPortEditing?((0,l.uX)(),(0,l.Wv)(s,{key:0,autofocus:"",size:"small",modelValue:e.row.ListenPort,"onUpdate:modelValue":t=>e.row.ListenPort=t,onBlur:t=>n.handleEditBlur(e.row,"ListenPort")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[e.row.Error?((0,l.uX)(),(0,l.CE)("strong",{key:0,title:e.row.Error,class:"red"},(0,B.v_)(e.row.ListenPort),9,Te)):((0,l.uX)(),(0,l.CE)("span",Me,(0,B.v_)(e.row.ListenPort),1))],64))])),_:1}),(0,l.bF)(u,{prop:"ConnectAddr",label:"目标IP",width:"120"},{default:(0,l.k6)((e=>[e.row.ConnectAddrEditing?((0,l.uX)(),(0,l.Wv)(s,{key:0,autofocus:"",size:"small",modelValue:e.row.ConnectAddr,"onUpdate:modelValue":t=>e.row.ConnectAddr=t,onBlur:t=>n.handleEditBlur(e.row,"ConnectAddr")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[e.row.Error?((0,l.uX)(),(0,l.CE)("strong",{key:0,title:e.row.Error,class:"red"},(0,B.v_)(e.row.ConnectAddr),9,Ae)):((0,l.uX)(),(0,l.CE)("span",We,(0,B.v_)(e.row.ConnectAddr),1))],64))])),_:1}),(0,l.bF)(u,{prop:"ConnectPort",label:"目标端口",width:"80"},{default:(0,l.k6)((e=>[e.row.ConnectPortEditing?((0,l.uX)(),(0,l.Wv)(s,{key:0,autofocus:"",size:"small",modelValue:e.row.ConnectPort,"onUpdate:modelValue":t=>e.row.ConnectPort=t,onBlur:t=>n.handleEditBlur(e.row,"ConnectPort")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[e.row.Error?((0,l.uX)(),(0,l.CE)("strong",{key:0,title:e.row.Error,class:"red"},(0,B.v_)(e.row.ConnectPort),9,Re)):((0,l.uX)(),(0,l.CE)("span",Xe,(0,B.v_)(e.row.ConnectPort),1))],64))])),_:1}),(0,l.bF)(u,{prop:"Remark",label:"备注"},{default:(0,l.k6)((e=>[e.row.RemarkEditing?((0,l.uX)(),(0,l.Wv)(s,{key:0,autofocus:"",size:"small",modelValue:e.row.Remark,"onUpdate:modelValue":t=>e.row.Remark=t,onBlur:t=>n.handleEditBlur(e.row,"Remark")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)("div",Ne,(0,B.v_)(e.row.Remark),1))])),_:1}),(0,l.bF)(u,{prop:"Oper",label:"操作",width:"110"},{default:(0,l.k6)((e=>[(0,l.Lk)("div",null,[(0,l.bF)(h,{title:"删除不可逆，是否确认?",onConfirm:t=>n.handleDel(e.$index)},{reference:(0,l.k6)((()=>[(0,l.bF)(c,{type:"danger",size:"small"},{default:(0,l.k6)((()=>[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)(d)])),_:1})])),_:1})])),_:2},1032,["onConfirm"]),(0,l.bF)(c,{type:"primary",size:"small",onClick:t=>n.handleAdd(e.$index)},{default:(0,l.k6)((()=>[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)(m)])),_:1})])),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data","onCellDblclick"])])])}var ze={props:["modelValue"],emits:["update:modelValue"],components:{Delete:T.epd,Plus:T.FWt,Warning:T.N5l,Refresh:T.C42},setup(e){const t=(0,b.W)(),a=(0,d.Kh)({machineName:t.value.current.device.MachineName,forwards:0==t.value.current.Forwards.length?[{ListenAddr:"0.0.0.0",ListenPort:0,ConnectAddr:"0.0.0.0",ConnectPort:0,Remark:""}]:t.value.current.Forwards.slice(0),timer:0,testing:!1}),n=(e,t)=>{o(e,t.property)},o=(e,t)=>{a.forwards.forEach((e=>{e["ListenAddrEditing"]=!1,e["ListenPortEditing"]=!1,e["ConnectAddrEditing"]=!1,e["ConnectPortEditing"]=!1,e["RemarkEditing"]=!1})),e[`${t}Editing`]=!0,e["__editing"]=!0},r=(e,t)=>{e[`${t}Editing`]=!1,e["__editing"]=!1},s=e=>{1==a.forwards.length?a.forwards[0]={ListenAddr:"0.0.0.0",ListenPort:0,ConnectAddr:"0.0.0.0",ConnectPort:0,Remark:""}:a.forwards.splice(e,1)},u=e=>{a.forwards.filter((e=>"0.0.0.0"==e.ConnectAddr||0==e.ConnectPort||0==e.ListenPort)).length>0||a.forwards.splice(e+1,0,{ListenAddr:"0.0.0.0",ListenPort:0,ConnectAddr:"0.0.0.0",ConnectPort:0,Remark:""})},i=()=>{clearTimeout(a.timer),a.testing=!0,(0,_e._)({MachineId:t.value.current.MachineId,List:a.forwards.map((e=>({ListenAddr:e.ListenAddr,ListenPort:+e.ListenPort,ConnectAddr:e.ConnectAddr,ConnectPort:+e.ConnectPort})))}).then((e=>{var t=e.List;for(let l=0;l<t.length;l++){const e=t[l],n=`${e.ListenPort}->${e.ConnectAddr}:${e.ConnectPort}`,o=a.forwards.filter((e=>`${e.ListenPort}->${e.ConnectAddr}:${e.ConnectPort}`==n));for(let t=0;t<o.length;t++)o[t].Error=e.Error}a.testing=!1,a.timer=setTimeout(i,3e3)})).catch((()=>{a.testing=!1,a.timer=setTimeout(i,3e3)}))};(0,l.sV)((()=>{i()})),(0,l.hi)((()=>{clearTimeout(a.timer)}));const c=()=>a.forwards.map((e=>(e.ListenPort=+e.ListenPort,e.ConnectPort=+e.ConnectPort,e)));return{state:a,handleCellClick:n,handleEditBlur:r,handleDel:s,handleAdd:u,getData:c}}};const xe=(0,F.A)(ze,[["render",Be],["__scopeId","data-v-786fe646"]]);var Ue=xe;const De=e=>((0,l.Qi)("data-v-286c7cac"),e=e(),(0,l.jt)(),e),Ke={class:"w-100"},$e=De((()=>(0,l.Lk)("div",null,[(0,l.Lk)("span",{class:"yellow"},"填写局域网IP，使用NAT转发")],-1))),Ge={class:"wrap"},Qe=De((()=>(0,l.Lk)("span",null,"/",-1))),Oe={class:"pdl-10"},je={class:"pdl-10"};function qe(e,t,a,n,o,r){const s=(0,l.g2)("el-input"),u=(0,l.g2)("el-checkbox"),d=(0,l.g2)("Delete"),i=(0,l.g2)("el-icon"),c=(0,l.g2)("el-button"),h=(0,l.g2)("Plus");return(0,l.uX)(),(0,l.CE)("div",Ke,[$e,(0,l.Lk)("div",Ge,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.lans,((e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:t,class:"flex",style:{"margin-bottom":".6rem"}},[(0,l.Lk)("div",null,[(0,l.bF)(s,{modelValue:e.IP,"onUpdate:modelValue":t=>e.IP=t,style:{width:"14rem"}},null,8,["modelValue","onUpdate:modelValue"]),Qe,(0,l.bF)(s,{onChange:e=>n.handleMaskChange(t),modelValue:e.PrefixLength,"onUpdate:modelValue":t=>e.PrefixLength=t,style:{width:"4rem"}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),(0,l.Lk)("div",Oe,[(0,l.bF)(u,{modelValue:e.Disabled,"onUpdate:modelValue":t=>e.Disabled=t,label:"禁用记录",style:{"vertical-align":"middle"}},null,8,["modelValue","onUpdate:modelValue"])]),(0,l.Lk)("div",je,[(0,l.bF)(c,{type:"danger",onClick:e=>n.handleDel(t),size:"small"},{default:(0,l.k6)((()=>[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)(d)])),_:1})])),_:2},1032,["onClick"]),(0,l.bF)(c,{type:"primary",onClick:e=>n.handleAdd(t),size:"small"},{default:(0,l.k6)((()=>[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)(h)])),_:1})])),_:2},1032,["onClick"])])])))),128))])])}var He={props:["modelValue"],emits:["update:modelValue"],components:{Delete:T.epd,Plus:T.FWt,Warning:T.N5l,Refresh:T.C42},setup(e){const t=(0,b.W)(),a=(0,d.Kh)({lans:t.value.current.Lans.slice(0)});0==a.lans.length&&a.lans.push({IP:"0.0.0.0",PrefixLength:24});const l=e=>{var t=+a.lans[e].PrefixLength;(t>32||t<0||isNaN(t))&&(t=24),a.lans[e].PrefixLength=t},n=e=>{a.lans.splice(e,1),0==a.lans.length&&o(0)},o=e=>{a.lans.splice(e+1,0,{IP:"0.0.0.0",PrefixLength:24})},r=()=>a.lans.map((e=>(e.PrefixLength=+e.PrefixLength,e)));return{state:a,handleMaskChange:l,handleDel:n,handleAdd:o,getData:r}}};const Je=(0,F.A)(He,[["render",qe],["__scopeId","data-v-286c7cac"]]);var Ye=Je,Ze={props:["modelValue"],emits:["change","update:modelValue"],components:{Delete:T.epd,Plus:T.FWt,Warning:T.N5l,Refresh:T.C42,TuntapForward:Ue,TuntapLan:Ye},setup(e,{emit:t}){const a=(0,u.B)(),n=(0,b.W)(),o=(0,d.KR)(null),r=(0,d.Kh)({show:!0,machineName:n.value.current.device.MachineName,bufferSize:a.value.bufferSize,ruleForm:{IP:n.value.current.IP,PrefixLength:n.value.current.PrefixLength||24,Gateway:n.value.current.Gateway,ShowDelay:n.value.current.ShowDelay,AutoConnect:n.value.current.AutoConnect,Upgrade:n.value.current.Upgrade,Multicast:n.value.current.Multicast,Nat:n.value.current.Nat,Forwards:n.value.current.Forwards,Name:n.value.current.Name},rules:{Name:{type:"string",pattern:/^$|^[A-Za-z][A-Za-z0-9]{0,31}$/,message:"请输入正确的网卡名",transform(e){return e.trim()}}}});(0,l.wB)((()=>r.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const s=()=>{var e=+r.ruleForm.PrefixLength;(e>32||e<16||isNaN(e))&&(e=24),r.ruleForm.PrefixLength=e},c=(0,d.KR)(null),h=(0,d.KR)(null),m=()=>{const e=JSON.parse(JSON.stringify(n.value.current));e.IP=r.ruleForm.IP.replace(/\s/g,"")||"0.0.0.0",e.Lans=c.value?c.value.getData():n.value.current.Lans,e.PrefixLength=+r.ruleForm.PrefixLength,e.Gateway=r.ruleForm.Gateway,e.ShowDelay=r.ruleForm.ShowDelay,e.AutoConnect=r.ruleForm.AutoConnect,e.Upgrade=r.ruleForm.Upgrade,e.Multicast=r.ruleForm.Multicast,e.Nat=r.ruleForm.Nat,e.Forwards=h.value?h.value.getData():n.value.current.Forwards,e.Name=r.ruleForm.Name,(0,_e.ac)(e).then((()=>{r.show=!1,i.nk.success("已操作！"),t("change")})).catch((e=>{console.log(e),i.nk.error("操作失败！")}))};return{state:r,ruleFormRef:o,handlePrefixLengthChange:s,handleSave:m,lanDom:c,forwardDom:h}}};const et=(0,F.A)(Ze,[["render",Ee],["__scopeId","data-v-078917af"]]);var tt=et;const at=e=>((0,l.Qi)("data-v-67ed3552"),e=e(),(0,l.jt)(),e),lt=at((()=>(0,l.Lk)("p",null,"网络租期30天、IP租期7天",-1))),nt=at((()=>(0,l.Lk)("span",null,"/",-1))),ot=at((()=>(0,l.Lk)("span",{style:{width:"1rem"}},null,-1))),rt={class:"calc"},st=at((()=>(0,l.Lk)("span",{class:"label"},"网络号",-1))),ut={class:"value"},dt=at((()=>(0,l.Lk)("span",{class:"label"},"网关",-1))),it={class:"value"},ct=at((()=>(0,l.Lk)("span",{class:"label"},"开始IP",-1))),ht={class:"value"},mt=at((()=>(0,l.Lk)("span",{class:"label"},"结束IP",-1))),pt={class:"value"},vt=at((()=>(0,l.Lk)("span",{class:"label"},"广播号",-1))),gt={class:"value"},kt=at((()=>(0,l.Lk)("span",{class:"label"},"IP数量",-1))),ft={class:"value"};function wt(e,t,a,n,o,r){const s=(0,l.g2)("el-form-item"),u=(0,l.g2)("el-input"),d=(0,l.g2)("el-button"),i=(0,l.g2)("el-form"),c=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(c,{modelValue:n.state.show,"onUpdate:modelValue":t[4]||(t[4]=e=>n.state.show=e),"close-on-click-modal":!1,"append-to":".app-wrap",title:"配置本组的网络",top:"1vh",width:"400"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(i,{ref:"ruleFormRef",model:n.state.ruleForm,rules:n.state.rules,"label-width":"100"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{prop:"gateway"},{default:(0,l.k6)((()=>[lt])),_:1}),(0,l.bF)(s,{label:"网卡名",prop:"Name"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:n.state.ruleForm.Name,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.ruleForm.Name=e),style:{width:"14rem"}},null,8,["modelValue"])])),_:1}),(0,l.bF)(s,{label:"网络前缀",prop:"IP"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:n.state.ruleForm.IP,"onUpdate:modelValue":t[1]||(t[1]=e=>n.state.ruleForm.IP=e),style:{width:"14rem"},onChange:n.handlePrefixLengthChange},null,8,["modelValue","onChange"]),nt,(0,l.bF)(u,{onChange:n.handlePrefixLengthChange,modelValue:n.state.ruleForm.PrefixLength,"onUpdate:modelValue":t[2]||(t[2]=e=>n.state.ruleForm.PrefixLength=e),style:{width:"4rem"}},null,8,["onChange","modelValue"]),ot,(0,l.bF)(d,{onClick:n.handleClear},{default:(0,l.k6)((()=>[(0,l.eW)("重置")])),_:1},8,["onClick"])])),_:1}),(0,l.bF)(s,{label:"",prop:"IP1"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",rt,[(0,l.Lk)("p",null,[st,(0,l.Lk)("span",ut,(0,B.v_)(n.state.values.Network),1)]),(0,l.Lk)("p",null,[dt,(0,l.Lk)("span",it,(0,B.v_)(n.state.values.Gateway),1)]),(0,l.Lk)("p",null,[ct,(0,l.Lk)("span",ht,(0,B.v_)(n.state.values.Start),1)]),(0,l.Lk)("p",null,[mt,(0,l.Lk)("span",pt,(0,B.v_)(n.state.values.End),1)]),(0,l.Lk)("p",null,[vt,(0,l.Lk)("span",gt,(0,B.v_)(n.state.values.Broadcast),1)]),(0,l.Lk)("p",null,[kt,(0,l.Lk)("span",ft,(0,B.v_)(n.state.values.Count),1)])])])),_:1}),n.hasLease?((0,l.uX)(),(0,l.Wv)(s,{key:0,label:"",prop:"Btns"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(d,{onClick:t[3]||(t[3]=e=>n.state.show=!1)},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1}),(0,l.bF)(d,{type:"primary",onClick:n.handleSave},{default:(0,l.k6)((()=>[(0,l.eW)("确认")])),_:1},8,["onClick"])])])),_:1})):(0,l.Q3)("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["modelValue"])}var bt={props:["modelValue"],emits:["change","update:modelValue"],components:{Delete:T.epd,Plus:T.FWt},setup(e,{emit:t}){const a=(0,u.B)(),n=(0,l.EW)((()=>a.value.hasAccess("Lease"))),o=(0,d.KR)(null),r=(0,d.Kh)({show:!0,ruleForm:{Name:"",IP:"0.0.0.0",PrefixLength:24},rules:{Name:{type:"string",pattern:/^$|^[A-Za-z][A-Za-z0-9]{0,31}$/,message:"请输入正确的网卡名",transform(e){return e.trim()}}},values:{}});(0,l.wB)((()=>r.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const s=()=>{(0,_e.w0)(r.ruleForm).then((e=>{r.values=e}))},c=()=>{(0,_e.Nj)().then((e=>{r.ruleForm.Name=e.Name,r.ruleForm.IP=e.IP,r.ruleForm.PrefixLength=e.PrefixLength,s()}))},h=()=>{var e=+r.ruleForm.PrefixLength;(e>32||e<16||isNaN(e))&&(e=24),r.ruleForm.PrefixLength=e,s()},m=()=>{(0,_e.AE)(r.ruleForm).then((()=>{i.nk.success("已操作"),r.show=!1})).catch((e=>{console.log(e),i.nk.error("操作失败")}))},p=()=>{(0,_e.AE)({Name:"",IP:"0.0.0.0",PrefixLength:24}).then((()=>{i.nk.success("已操作"),c()})).catch((e=>{console.log(e),i.nk.error("操作失败")}))};return(0,l.sV)((()=>{c()})),{state:r,hasLease:n,ruleFormRef:o,handleSave:m,handlePrefixLengthChange:h,handleClear:p}}};const Ct=(0,F.A)(bt,[["render",wt],["__scopeId","data-v-67ed3552"]]);var Ft=Ct;const Lt={key:0};function Et(e,t,a,n,o,r){const s=(0,l.g2)("Socks5Show"),u=(0,l.g2)("el-table-column");return(0,l.uX)(),(0,l.Wv)(u,{prop:"socks5",label:"代理转发",width:"160"},{default:(0,l.k6)((e=>[n.socks5.list[e.row.MachineId]?((0,l.uX)(),(0,l.CE)("div",Lt,[(0,l.bF)(s,{config:!0,item:e.row,onEdit:n.handleSocks5,onRefresh:n.handleSocks5Refresh},null,8,["item","onEdit","onRefresh"])])):(0,l.Q3)("",!0)])),_:1})}const _t={class:"flex"},Vt={class:"flex-1"},It=["title"],yt={key:0,class:"green gateway"},St={key:1},Pt={key:0},Tt={key:0,class:"flex yellow",title:"已禁用"},Mt={key:1,class:"flex red",title:"与其它设备填写IP、或本机局域网IP有冲突"};function At(e,t,a,n,o,r){const s=(0,l.g2)("ConnectionShow"),u=(0,l.g2)("Loading"),d=(0,l.g2)("el-icon"),i=(0,l.g2)("el-switch");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.Lk)("div",_t,[(0,l.Lk)("div",Vt,[(0,l.bF)(s,{data:n.connections.list[n.item.MachineId]},null,8,["data"]),(0,l.Lk)("a",{href:"javascript:;",class:"a-line",onClick:t[0]||(t[0]=e=>n.handleSocks5Port(n.socks5.list[n.item.MachineId])),title:"此设备的socks5代理"},[n.socks5.list[n.item.MachineId].SetupError?((0,l.uX)(),(0,l.CE)("strong",{key:0,class:"red",title:n.socks5.list[n.item.MachineId].SetupError}," socks5://*:"+(0,B.v_)(n.socks5.list[n.item.MachineId].Port),9,It)):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[n.socks5.list[n.item.MachineId].running?((0,l.uX)(),(0,l.CE)("strong",yt,"socks5://*:"+(0,B.v_)(n.socks5.list[n.item.MachineId].Port),1)):((0,l.uX)(),(0,l.CE)("span",St,"socks5://*:"+(0,B.v_)(n.socks5.list[n.item.MachineId].Port),1))],64))])]),n.socks5.list[n.item.MachineId].loading?((0,l.uX)(),(0,l.CE)("div",Pt,[(0,l.bF)(d,{size:"14",class:"loading"},{default:(0,l.k6)((()=>[(0,l.bF)(u)])),_:1})])):((0,l.uX)(),(0,l.Wv)(i,{key:1,modelValue:n.socks5.list[n.item.MachineId].running,"onUpdate:modelValue":t[1]||(t[1]=e=>n.socks5.list[n.item.MachineId].running=e),loading:n.socks5.list[n.item.MachineId].loading,disabled:"",onClick:t[2]||(t[2]=e=>n.handleSocks5(n.socks5.list[n.item.MachineId])),size:"small","inline-prompt":"","active-text":"😀","inactive-text":"😣"},null,8,["modelValue","loading"]))]),(0,l.Lk)("div",null,[(0,l.Lk)("div",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.socks5.list[n.item.MachineId].Lans,((e,t)=>((0,l.uX)(),(0,l.CE)(l.FK,{key:t},[e.Disabled?((0,l.uX)(),(0,l.CE)("div",Tt,(0,B.v_)(e.IP)+" / "+(0,B.v_)(e.PrefixLength),1)):e.Exists?((0,l.uX)(),(0,l.CE)("div",Mt,(0,B.v_)(e.IP)+" / "+(0,B.v_)(e.PrefixLength),1)):((0,l.uX)(),(0,l.CE)("div",{key:2,class:(0,B.C4)(["flex",{green:n.socks5.list[n.item.MachineId].running}]),title:"正常使用"},(0,B.v_)(e.IP)+" / "+(0,B.v_)(e.PrefixLength),3))],64)))),128))])])])}var Wt=a(9983),Rt=a(4867),Xt={props:["item","config"],emits:["edit","refresh"],components:{Loading:T.Rhj,ConnectionShow:Rt.A},setup(e,{emit:t}){const a=w(),n=(0,u.B)(),o=(0,l.EW)((()=>n.value.config.Client.Id)),r=(0,l.EW)((()=>n.value.hasAccess("Socks5ChangeSelf"))),s=(0,l.EW)((()=>n.value.hasAccess("Socks5ChangeOther"))),d=(0,l.EW)((()=>n.value.hasAccess("Socks5StatusSelf"))),c=(0,l.EW)((()=>n.value.hasAccess("Socks5StatusOther"))),h=(0,Wt.bB)(),m=t=>{if(!e.config)return;if(o.value===t.MachineId){if(!d.value)return}else if(!c.value)return;const a=t.running?(0,g.R2)(t.MachineId):(0,g.qH)(t.MachineId);t.loading=!0,a.then((()=>{i.nk.success("操作成功！")})).catch((e=>{console.log(e),i.nk.error("操作失败！")}))},p=a=>{if(e.config||o.value==a.MachineId){if(o.value===a.MachineId){if(!r.value)return}else if(!s.value)return;a.device=e.item,t("edit",a)}},v=()=>{t("refresh")};return{item:(0,l.EW)((()=>e.item)),socks5:a,connections:h,handleSocks5:m,handleSocks5Port:p,handleSocks5Refresh:v}}};const Nt=(0,F.A)(Xt,[["render",At],["__scopeId","data-v-d37c5992"]]);var Bt=Nt,zt={emits:["edit","refresh"],components:{Socks5Show:Bt},setup(e,{emit:t}){const a=w(),l=e=>{t("edit",e)},n=()=>{t("refresh")};return{socks5:a,handleSocks5:l,handleSocks5Refresh:n}}};const xt=(0,F.A)(zt,[["render",Et]]);var Ut=xt;const Dt=e=>((0,l.Qi)("data-v-022e3781"),e=e(),(0,l.jt)(),e),Kt={class:"upgrade-wrap"},$t={class:"flex-1"},Gt=Dt((()=>(0,l.Lk)("span",null,"/",-1))),Qt={class:"pdl-10"},Ot={class:"pdl-10"};function jt(e,t,a,n,o,r){const s=(0,l.g2)("el-form-item"),u=(0,l.g2)("el-input"),d=(0,l.g2)("el-checkbox"),i=(0,l.g2)("Delete"),c=(0,l.g2)("el-icon"),h=(0,l.g2)("el-button"),m=(0,l.g2)("Plus"),p=(0,l.g2)("el-form"),v=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(v,{modelValue:n.state.show,"onUpdate:modelValue":t[2]||(t[2]=e=>n.state.show=e),"close-on-click-modal":!1,"append-to":".app-wrap",title:`设置[${n.state.machineName}]代理`,top:"1vh",width:"600"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(p,{ref:"ruleFormRef",model:n.state.ruleForm,rules:n.state.rules,"label-width":"140"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{prop:"gateway",style:{"margin-bottom":"0"}},{default:(0,l.k6)((()=>[(0,l.eW)(" 配置代理，通过代理访问其它设备 ")])),_:1}),(0,l.bF)(s,{label:"代理端口",prop:"Port"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:n.state.ruleForm.Port,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.ruleForm.Port=e),style:{width:"14rem"}},null,8,["modelValue"])])),_:1}),(0,l.Lk)("div",Kt,[(0,l.bF)(s,{label:"此设备局域网IP",prop:"LanIP",class:"lan-item"},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.ruleForm.Lans,((e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:t,class:"flex",style:{"margin-bottom":".6rem"}},[(0,l.Lk)("div",$t,[(0,l.bF)(u,{modelValue:e.IP,"onUpdate:modelValue":t=>e.IP=t,style:{width:"14rem"}},null,8,["modelValue","onUpdate:modelValue"]),Gt,(0,l.bF)(u,{onChange:e=>n.handleMaskChange(t),modelValue:e.PrefixLength,"onUpdate:modelValue":t=>e.PrefixLength=t,style:{width:"4rem"}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),(0,l.Lk)("div",Qt,[(0,l.bF)(d,{modelValue:e.Disabled,"onUpdate:modelValue":t=>e.Disabled=t,label:"禁用记录",size:"large"},null,8,["modelValue","onUpdate:modelValue"])]),(0,l.Lk)("div",Ot,[(0,l.bF)(h,{type:"danger",onClick:e=>n.handleDel(t)},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.bF)(i)])),_:1})])),_:2},1032,["onClick"]),(0,l.bF)(h,{type:"primary",onClick:e=>n.handleAdd(t)},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.bF)(m)])),_:1})])),_:2},1032,["onClick"])])])))),128))])),_:1})]),(0,l.bF)(s,{label:"",prop:"Btns"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(h,{onClick:t[1]||(t[1]=e=>n.state.show=!1)},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1}),(0,l.bF)(h,{type:"primary",onClick:n.handleSave},{default:(0,l.k6)((()=>[(0,l.eW)("确认")])),_:1},8,["onClick"])])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])}var qt={props:["modelValue"],emits:["change","update:modelValue"],components:{Delete:T.epd,Plus:T.FWt},setup(e,{emit:t}){const a=(0,u.B)(),n=w(),o=(0,d.KR)(null),r=(0,d.Kh)({show:!0,machineName:n.value.current.device.MachineName,bufferSize:a.value.bufferSize,ruleForm:{Port:n.value.current.Port,Lans:n.value.current.Lans.slice(0)},rules:{}});0==r.ruleForm.Lans.length&&r.ruleForm.Lans.push({IP:"0.0.0.0",PrefixLength:24}),(0,l.wB)((()=>r.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const s=e=>{var t=+r.ruleForm.Lans[e].PrefixLength;(t>32||t<16||isNaN(t))&&(t=24),r.ruleForm.Lans[e].PrefixLength=t},c=e=>{r.ruleForm.Lans.splice(e,1),0==r.ruleForm.Lans.length&&h(0)},h=e=>{r.ruleForm.Lans.splice(e+1,0,{IP:"0.0.0.0",PrefixLength:24})},m=()=>{const e=JSON.parse(JSON.stringify(n.value.current));e.Port=+(r.ruleForm.Port||"1805"),e.Lans=r.ruleForm.Lans.map((e=>(e.PrefixLength=+e.PrefixLength,e))),(0,g._Q)(e).then((()=>{r.show=!1,i.nk.success("已操作！"),t("change")})).catch((e=>{console.log(e),i.nk.error("操作失败！")}))};return{state:r,ruleFormRef:o,handleMaskChange:s,handleDel:c,handleAdd:h,handleSave:m}}};const Ht=(0,F.A)(qt,[["render",jt],["__scopeId","data-v-022e3781"]]);var Jt=Ht;const Yt={key:0},Zt=["title","onClick"],ea=["onClick"];function ta(e,t,a,n,o,r){const s=(0,l.g2)("el-table-column");return(0,l.uX)(),(0,l.Wv)(s,{prop:"tunnel",label:"隧道",width:"76"},{default:(0,l.k6)((e=>[n.tunnel.list[e.row.MachineId]?((0,l.uX)(),(0,l.CE)("div",Yt,[(0,l.Lk)("a",{href:"javascript:;",class:(0,B.C4)(["a-line",{yellow:n.tunnel.list[e.row.MachineId].NeedReboot}]),title:n.title(n.tunnel.list[e.row.MachineId]),onClick:t=>n.handleTunnel(n.tunnel.list[e.row.MachineId],e.row)},[(0,l.Lk)("span",null,"网关:"+(0,B.v_)(n.tunnel.list[e.row.MachineId].RouteLevel)+"+"+(0,B.v_)(n.tunnel.list[e.row.MachineId].RouteLevelPlus),1)],10,Zt)])):(0,l.Q3)("",!0),(0,l.Lk)("div",null,[(0,l.Lk)("a",{href:"javascript:;",title:"与此设备的隧道连接",class:(0,B.C4)(["a-line",{green:n.connectionCount(e.row.MachineId)>0}]),onClick:t=>n.handleConnections(e.row)},[(0,l.Lk)("span",{class:(0,B.C4)({gateway:n.connectionCount(e.row.MachineId)>0})},[(0,l.eW)("连接:"),(0,l.Lk)("span",null,(0,B.v_)(n.connectionCount(e.row.MachineId)),1)],2)],10,ea)])])),_:1})}var aa=a(83);const la=Symbol(),na=()=>{(0,u.B)();const e=(0,d.KR)({timer:0,showEdit:!1,current:null,list:{},hashcode:0});(0,l.Gt)(la,e);const t=()=>{(0,aa.r7)(e.value.hashcode.toString()).then((a=>{e.value.hashcode=a.HashCode,a.List&&(e.value.list=a.List),e.value.timer=setTimeout(t,1060)})).catch((()=>{e.value.timer=setTimeout(t,1060)}))},a=t=>{e.value.current=t,e.value.showEdit=!0},n=()=>{(0,aa.gM)()},o=()=>{clearTimeout(e.value.timer)},r=t=>Object.values(e.value.list).sort(((e,t)=>e.RouteLevel+e.RouteLevelPlus-t.RouteLevel+t.RouteLevelPlus)).map((e=>e.MachineId));return{tunnel:e,_getTunnelInfo:t,handleTunnelEdit:a,handleTunnelRefresh:n,clearTunnelTimeout:o,sortTunnel:r}},oa=()=>(0,l.WQ)(la);var ra={emits:["edit","refresh"],setup(e,{emit:t}){const a=(0,u.B)(),n=(0,l.EW)((()=>a.value.config.Client.Id)),o=(0,l.EW)((()=>a.value.hasAccess("TunnelChangeSelf"))),r=(0,l.EW)((()=>a.value.hasAccess("TunnelChangeOther"))),s=oa(),d=((0,Wt.ZY)(),(0,Wt.mx)()),i=(0,Wt.FG)(),c=(0,Wt.bB)(),h=e=>{let t=["调整网关层级有助于打洞成功",`${e.HostName}`,e.Lans.filter((e=>e.Ips.length>0)).map((e=>`\t【${e.Mac||"00-00-00-00-00-00"}】${e.Name}\r\n\t\t${e.Ips.join("\r\n\t\t")}`)).join("\r\n"),`跳跃点\r\n\t${e.Routes.join("\r\n\t")}`];return e.NeedReboot?"需要重启":t.join("\r\n")},m=e=>{const t=[d.value.list[e],i.value.list[e],c.value.list[e]].filter((e=>!!e&&e.Connected)).length;return t},p=(e,a)=>{if(n.value===e.MachineId){if(!o.value)return}else if(!r.value)return;e.device=a,t("edit",e)},v=()=>{t("refresh")},g=e=>{t("connections",e)};return{tunnel:s,handleTunnel:p,handleTunnelRefresh:v,connectionCount:m,handleConnections:g,title:h}}};const sa=(0,F.A)(ra,[["render",ta],["__scopeId","data-v-3c85bbf3"]]);var ua=sa;const da=e=>((0,l.Qi)("data-v-74ef14ca"),e=e(),(0,l.jt)(),e),ia=da((()=>(0,l.Lk)("div",null,"网关层级为你的设备与外网的距离，你可以手动调整数值",-1))),ca=da((()=>(0,l.Lk)("h3",null,"跳跃点",-1))),ha={class:"t-c w-100"};function ma(e,t,a,n,o,r){const s=(0,l.g2)("el-form-item"),u=(0,l.g2)("el-input"),d=(0,l.g2)("el-col"),i=(0,l.g2)("el-input-number"),c=(0,l.g2)("el-row"),h=(0,l.g2)("el-button"),m=(0,l.g2)("el-form"),p=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(p,{modelValue:n.state.show,"onUpdate:modelValue":t[5]||(t[5]=e=>n.state.show=e),"close-on-click-modal":!1,"append-to":".app-wrap",title:`设置[${n.state.machineName}]网关`,width:"500",top:"1vh"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(m,{ref:"ruleFormRef",model:n.state.ruleForm,rules:n.state.rules,"label-width":"auto"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{label:"",prop:"alert"},{default:(0,l.k6)((()=>[ia])),_:1}),(0,l.bF)(s,{label:""},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.bF)(d,{span:12},{default:(0,l.k6)((()=>[(0,l.bF)(s,{label:"网关层级",prop:"RouteLevel"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{readonly:"",modelValue:n.state.ruleForm.RouteLevel,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.ruleForm.RouteLevel=e),style:{width:"6rem"}},null,8,["modelValue"]),(0,l.eW)(" + ")])),_:1})])),_:1}),(0,l.bF)(d,{span:12},{default:(0,l.k6)((()=>[(0,l.bF)(s,{label:"",prop:"RouteLevelPlus"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:n.state.ruleForm.RouteLevelPlus,"onUpdate:modelValue":t[1]||(t[1]=e=>n.state.ruleForm.RouteLevelPlus=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,l.bF)(s,{label:""},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.bF)(d,{span:12},{default:(0,l.k6)((()=>[(0,l.bF)(s,{label:"外网端口",prop:"PortMapWan"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:n.state.ruleForm.PortMapWan,"onUpdate:modelValue":t[2]||(t[2]=e=>n.state.ruleForm.PortMapWan=e)},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.bF)(d,{span:12},{default:(0,l.k6)((()=>[(0,l.bF)(s,{label:"内网端口",prop:"PortMapLan"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:n.state.ruleForm.PortMapLan,"onUpdate:modelValue":t[3]||(t[3]=e=>n.state.ruleForm.PortMapLan=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,l.bF)(s,{label:"",prop:"alert"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.Lk)("h3",null,(0,B.v_)(n.tunnel.current.HostName),1),(0,l.Lk)("ul",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.tunnel.current.Lans.filter((e=>e.Ips.length>0)),((e,t)=>((0,l.uX)(),(0,l.CE)("li",null,[(0,l.Lk)("div",null,"【"+(0,B.v_)(e.Mac||"00-00-00-00-00-00")+"】"+(0,B.v_)(e.Desc),1),(0,l.Lk)("div",null,[(0,l.Lk)("ul",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.Ips,((e,t)=>((0,l.uX)(),(0,l.CE)("li",null,(0,B.v_)(e),1)))),256))])])])))),256))]),ca,(0,l.Lk)("ul",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.tunnel.current.Routes,((e,t)=>((0,l.uX)(),(0,l.CE)("li",null,(0,B.v_)(e),1)))),256))])])])),_:1}),(0,l.bF)(s,{label:"",prop:"Btns"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",ha,[(0,l.bF)(h,{onClick:t[4]||(t[4]=e=>n.state.show=!1)},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1}),(0,l.bF)(h,{type:"primary",onClick:n.handleSave},{default:(0,l.k6)((()=>[(0,l.eW)("确认")])),_:1},8,["onClick"])])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])}var pa={props:["modelValue"],emits:["change","update:modelValue"],setup(e,{emit:t}){const a=oa(),n=(0,d.KR)(null),o=(0,d.Kh)({show:!0,machineName:a.value.current.device.MachineName,ruleForm:{RouteLevel:a.value.current.RouteLevel,RouteLevelPlus:a.value.current.RouteLevelPlus,PortMapWan:a.value.current.PortMapWan,PortMapLan:a.value.current.PortMapLan},rules:{}});(0,l.wB)((()=>o.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const r=()=>{const e=JSON.parse(JSON.stringify(a.value.current));e.RouteLevel=+o.ruleForm.RouteLevel,e.RouteLevelPlus=+o.ruleForm.RouteLevelPlus,e.PortMapWan=+o.ruleForm.PortMapWan,e.PortMapLan=+o.ruleForm.PortMapLan,(0,aa.KW)(e).then((()=>{o.show=!1,i.nk.success("已操作！"),t("change")})).catch((e=>{console.log(e),i.nk.error("操作失败！")}))};return{state:o,ruleFormRef:n,handleSave:r,tunnel:a}}};const va=(0,F.A)(pa,[["render",ma],["__scopeId","data-v-74ef14ca"]]);var ga=va;const ka=["onClick"],fa=["onClick"],wa=["onClick"],ba=["onClick"];function Ca(e,t,a,n,o,r){const s=(0,l.g2)("ConnectionShow"),u=(0,l.g2)("el-table-column");return(0,l.uX)(),(0,l.Wv)(u,{prop:"forward",label:"转发/穿透"},{default:(0,l.k6)((t=>[t.row.Connected?((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[t.row.isSelf&&(n.hasForwardShowSelf||e.hasForwardSelf)?((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[(0,l.Lk)("div",null,[(0,l.bF)(s,{data:n.connections.list[t.row.MachineId]},null,8,["data"]),(0,l.Lk)("a",{href:"javascript:;",title:"管理自己的端口转发",class:(0,B.C4)({green:n.forward.list[t.row.MachineId]>0}),onClick:e=>n.handleEdit(t.row.MachineId,t.row.MachineName)},[(0,l.Lk)("span",{class:(0,B.C4)({gateway:n.forward.list[t.row.MachineId]>0})},"端口转发("+(0,B.v_)(n.forward.list[t.row.MachineId]>99?"99+":n.forward.list[t.row.MachineId])+")",3)],10,ka)]),(0,l.Lk)("div",null,[(0,l.Lk)("a",{href:"javascript:;",title:"管理自己的内网穿透",class:(0,B.C4)({green:n.sforward.list[t.row.MachineId]>0}),onClick:e=>n.handleSEdit(t.row.MachineId,t.row.MachineName)},[(0,l.Lk)("span",{class:(0,B.C4)({gateway:n.sforward.list[t.row.MachineId]>0})},"内网穿透("+(0,B.v_)(n.sforward.list[t.row.MachineId]>99?"99+":n.sforward.list[t.row.MachineId])+")",3)],10,fa)])],64)):n.hasForwardShowOther||e.hasForwardOther?((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.Lk)("div",null,[(0,l.bF)(s,{data:n.connections.list[t.row.MachineId]},null,8,["data"]),(0,l.Lk)("a",{href:"javascript:;",title:"管理自己的端口转发",class:(0,B.C4)({green:n.forward.list[t.row.MachineId]>0}),onClick:e=>n.handleEdit(t.row.MachineId,t.row.MachineName)},[(0,l.Lk)("span",{class:(0,B.C4)({gateway:n.forward.list[t.row.MachineId]>0})},"端口转发("+(0,B.v_)(n.forward.list[t.row.MachineId]>99?"99+":n.forward.list[t.row.MachineId])+")",3)],10,wa)]),(0,l.Lk)("div",null,[(0,l.Lk)("a",{href:"javascript:;",title:"管理自己的内网穿透",class:(0,B.C4)({green:n.sforward.list[t.row.MachineId]>0}),onClick:e=>n.handleSEdit(t.row.MachineId,t.row.MachineName)},[(0,l.Lk)("span",{class:(0,B.C4)({gateway:n.sforward.list[t.row.MachineId]>0})},"内网穿透("+(0,B.v_)(n.sforward.list[t.row.MachineId]>99?"99+":n.sforward.list[t.row.MachineId])+")",3)],10,ba)])],64)):(0,l.Q3)("",!0)],64)):(0,l.Q3)("",!0)])),_:1})}var Fa=a(743);const La=Symbol(),Ea=()=>{const e=(0,u.B)(),t=((0,l.EW)((()=>e.value.config.Client.Id)),(0,d.KR)({timer:0,showEdit:!1,showCopy:!1,list:{},testTimer:0,hashcode:0,machineid:"",machineName:""}));(0,l.Gt)(La,t);const a=()=>{(0,Fa.a9)()},n=()=>{(0,Fa.gz)(t.value.hashcode.toString()).then((e=>{t.value.hashcode=e.HashCode,e.List&&(t.value.list=e.List),t.value.timer=setTimeout(n,1020)})).catch((()=>{t.value.timer=setTimeout(n,1020)}))},o=e=>{t.value.machineid=e[0],t.value.machineName=e[1],t.value.showEdit=!0},r=()=>{clearTimeout(t.value.timer),clearTimeout(t.value.testTimer)};return{sforward:t,_getSForwardCountInfo:n,handleSForwardEdit:o,clearSForwardTimeout:r,handleSForwardRefresh:a}},_a=()=>(0,l.WQ)(La);var Va={emits:["edit","sedit"],components:{ConnectionShow:Rt.A},setup(e,{emit:t}){const a=v(),n=_a(),o=(0,u.B)(),r=(0,l.EW)((()=>o.value.config.Client.Id)),s=(0,l.EW)((()=>o.value.hasAccess("ForwardShowSelf"))),d=(0,l.EW)((()=>o.value.hasAccess("ForwardShowOther"))),i=(0,l.EW)((()=>o.value.hasAccess("ForwardSelf"))),c=(0,l.EW)((()=>o.value.hasAccess("ForwardOther"))),h=(0,Wt.mx)(),m=(e,a)=>{if(r.value===e){if(!i.value)return}else if(!c.value)return;t("edit",[e,a])},p=(e,a)=>{if(r.value===e){if(!i.value)return}else if(!c.value)return;t("sedit",[e,a])},g=()=>{t("refresh")};return{forward:a,sforward:n,hasForwardShowSelf:s,hasForwardShowOther:d,connections:h,handleEdit:m,handleSEdit:p,handleForwardRefresh:g}}};const Ia=(0,F.A)(Va,[["render",Ca],["__scopeId","data-v-6e9936ec"]]);var ya=Ia;const Sa={class:"t-c head"},Pa=["title"],Ta={class:"t-c"},Ma={class:"page-wrap"},Aa=["title"];function Wa(e,t,a,n,o,r){const s=(0,l.g2)("el-button"),u=(0,l.g2)("el-input"),d=(0,l.g2)("el-table-column"),i=(0,l.g2)("el-option"),c=(0,l.g2)("el-select"),h=(0,l.g2)("WarnTriangleFilled"),m=(0,l.g2)("el-icon"),p=(0,l.g2)("el-pagination"),v=(0,l.g2)("el-switch"),g=(0,l.g2)("Delete"),k=(0,l.g2)("el-popconfirm"),f=(0,l.g2)("el-table"),w=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(w,{modelValue:n.state.show,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.show=e),onOpen:n.handleOnShowList,"append-to":".app-wrap",title:`【${n.state.machineName}】的端口转发`,top:"1vh",width:"780"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.Lk)("div",Sa,[(0,l.bF)(s,{type:"success",size:"small",onClick:n.handleAdd},{default:(0,l.k6)((()=>[(0,l.eW)("添加")])),_:1},8,["onClick"])]),(0,l.bF)(f,{data:n.state.data,size:"small",border:"",height:"500",onCellDblclick:n.handleCellClick},{default:(0,l.k6)((()=>[(0,l.bF)(d,{property:"Name",label:"名称",width:"100"},{default:(0,l.k6)((e=>[e.row.NameEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(u,{key:0,autofocus:"",size:"small",modelValue:e.row.Name,"onUpdate:modelValue":t=>e.row.Name=t,onBlur:t=>n.handleEditBlur(e.row,"Name")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.eW)((0,B.v_)(e.row.Name),1)],64))])),_:1}),(0,l.bF)(d,{prop:"BufferSize",label:"缓冲区",width:"80"},{default:(0,l.k6)((e=>[e.row.BufferSizeEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(c,{key:0,modelValue:e.row.BufferSize,"onUpdate:modelValue":t=>e.row.BufferSize=t,placeholder:"Select",size:"small",disabled:e.row.Started,onChange:t=>n.handleEditBlur(e.row,"BufferSize")},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.bufferSize,((e,t)=>((0,l.uX)(),(0,l.Wv)(i,{key:t,label:e,value:t},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.eW)((0,B.v_)(n.state.bufferSize[e.row.BufferSize]),1)],64))])),_:1}),(0,l.bF)(d,{property:"BindIPAddress",label:"监听IP",width:"140"},{default:(0,l.k6)((e=>[e.row.BindIPAddressEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(c,{key:0,modelValue:e.row.BindIPAddress,"onUpdate:modelValue":t=>e.row.BindIPAddress=t,size:"small",disabled:e.row.Started,onChange:t=>n.handleEditBlur(e.row,"BindIPAddress")},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.ips,(e=>((0,l.uX)(),(0,l.Wv)(i,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.eW)((0,B.v_)(e.row.BindIPAddress),1)],64))])),_:1}),(0,l.bF)(d,{property:"Port",label:"监听端口",width:"80"},{default:(0,l.k6)((e=>[e.row.PortEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(u,{key:0,type:"number",autofocus:"",size:"small",modelValue:e.row.Port,"onUpdate:modelValue":t=>e.row.Port=t,onBlur:t=>n.handleEditBlur(e.row,"Port")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[e.row.Msg?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"error red",title:e.row.Msg},[(0,l.Lk)("span",null,(0,B.v_)(e.row.Port),1),(0,l.bF)(m,{size:"20"},{default:(0,l.k6)((()=>[(0,l.bF)(h)])),_:1})],8,Pa)):((0,l.uX)(),(0,l.CE)("span",{key:1,class:(0,B.C4)({green:e.row.Started})},(0,B.v_)(e.row.Port),3))],64))])),_:1}),(0,l.bF)(d,{property:"MachineId",label:"目标"},{default:(0,l.k6)((e=>[e.row.MachineIdEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(c,{key:0,modelValue:e.row.MachineId,"onUpdate:modelValue":t=>e.row.MachineId=t,onChange:t=>n.handleEditBlur(e.row,"MachineId"),filterable:"",remote:"",loading:n.state.loading,"remote-method":n.handleSearch},{header:(0,l.k6)((()=>[(0,l.Lk)("div",Ta,[(0,l.Lk)("div",Ma,[(0,l.bF)(p,{small:"",background:"",layout:"prev, pager, next","page-size":n.state.machineIds.Request.Size,total:n.state.machineIds.Count,"pager-count":5,"current-page":n.state.machineIds.Request.Page,onCurrentChange:n.handlePageChange},null,8,["page-size","total","current-page","onCurrentChange"])])])])),default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.machineIds.List,((e,t)=>((0,l.uX)(),(0,l.Wv)(i,{key:t,label:e.MachineName,value:e.MachineId},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange","loading","remote-method"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.eW)((0,B.v_)(e.row.MachineName),1)],64))])),_:1}),(0,l.bF)(d,{property:"TargetEP",label:"目标服务",width:"140"},{default:(0,l.k6)((e=>[e.row.TargetEPEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(u,{key:0,autofocus:"",size:"small",modelValue:e.row.TargetEP,"onUpdate:modelValue":t=>e.row.TargetEP=t,onBlur:t=>n.handleEditBlur(e.row,"TargetEP")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[e.row.TargetMsg?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"error red",title:e.row.TargetMsg},[(0,l.Lk)("span",null,(0,B.v_)(e.row.TargetEP),1),(0,l.bF)(m,{size:"20"},{default:(0,l.k6)((()=>[(0,l.bF)(h)])),_:1})],8,Aa)):((0,l.uX)(),(0,l.CE)("span",{key:1,class:(0,B.C4)({green:e.row.Started})},(0,B.v_)(e.row.TargetEP),3))],64))])),_:1}),(0,l.bF)(d,{property:"Started",label:"状态",width:"60"},{default:(0,l.k6)((e=>[(0,l.bF)(v,{modelValue:e.row.Started,"onUpdate:modelValue":t=>e.row.Started=t,onChange:t=>n.handleStartChange(e.row),"inline-prompt":"","active-text":"开","inactive-text":"关"},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,l.bF)(d,{label:"操作",width:"54"},{default:(0,l.k6)((e=>[(0,l.bF)(k,{"confirm-button-text":"确认","cancel-button-text":"取消",title:"删除不可逆，是否确认?",onConfirm:t=>n.handleDel(e.row.Id)},{reference:(0,l.k6)((()=>[(0,l.bF)(s,{type:"danger",size:"small"},{default:(0,l.k6)((()=>[(0,l.bF)(m,null,{default:(0,l.k6)((()=>[(0,l.bF)(g)])),_:1})])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data","onCellDblclick"])])])),_:1},8,["modelValue","onOpen","title"])}var Ra={props:["data","modelValue"],emits:["update:modelValue"],components:{WarnTriangleFilled:T.DtC,Delete:T.epd},setup(e,{emit:t}){const a=(0,u.B)(),n=v(),o=(0,d.Kh)({show:!0,machineId:n.value.machineId,machineName:n.value.machineName,data:[],ips:[],bufferSize:a.value.bufferSize,loading:!1,machineIds:{Request:{Page:1,Size:10,Name:""},Count:0,List:[]},timer:0,timer1:0,editing:!1});(0,l.wB)((()=>o.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const r=()=>{clearTimeout(o.timer),(0,h.lE)(n.value.machineId).then((e=>{o.timer=setTimeout(r,1e3)})).catch((()=>{o.timer=setTimeout(r,1e3)}))},s=()=>{(0,h.xD)().then((e=>{e.splice(0,0,"127.0.0.1"),e.splice(0,0,"0.0.0.0"),o.ips=e})).catch((()=>{}))},c=()=>{clearTimeout(o.timer1),0==o.editing?(0,h.Oy)(o.machineId).then((e=>{o.data=e,o.timer1=setTimeout(c,1e3)})).catch((()=>{o.timer1=setTimeout(c,1e3)})):o.timer1=setTimeout(c,1e3)},m=e=>{o.machineIds.Request.Name=e,p()},p=()=>{o.loading=!0,(0,S.BS)(o.machineIds.Request).then((e=>{o.loading=!1,o.machineIds.Request=e.Request,o.machineIds.Count=e.Count,o.machineIds.List=e.List})).catch((e=>{o.loading=!1}))},g=e=>{o.machineIds.Request.Page=e,p()},k=()=>{p()},f=(e,t)=>{b(e,t.property)},w=()=>{E({ID:0,Name:"",Port:0,TargetEP:"127.0.0.1:80",machineId:""})},b=(e,t)=>{e.Started?i.nk.error("请先停止"):(o.data.forEach((e=>{e["NameEditing"]=!1,e["PortEditing"]=!1,e["TargetEPEditing"]=!1,e["BindIPAddressEditing"]=!1,e["BufferSizeEditing"]=!1,e["MachineIdEditing"]=!1})),e[`${t}Editing`]=!0,o.editing=!0)},C=(e,t)=>{if(e.Started)return void i.nk.error("请先停止");e[`${t}Editing`]=!1,o.editing=!1;const a=o.machineIds.List.find((t=>t.MachineId==e.MachineId));a&&(e.MachineName=a.MachineName),E(e)},F=e=>{(0,h.we)({machineId:o.machineId,Id:e}).then((()=>{c()}))},L=e=>{E(e)},E=e=>{e.Port=parseInt(e.Port),(0,h.nH)({machineId:o.machineId,data:e}).then((()=>{c()})).catch((e=>{i.nk.error(e)}))};return(0,l.sV)((()=>{c(),s(),r()})),(0,l.hi)((()=>{clearTimeout(o.timer),clearTimeout(o.timer1)})),{state:o,handleOnShowList:k,handleCellClick:f,handleAdd:w,handleEdit:b,handleEditBlur:C,handleDel:F,handleStartChange:L,handleSearch:m,handlePageChange:g}}};const Xa=(0,F.A)(Ra,[["render",Wa],["__scopeId","data-v-bb70309e"]]);var Na=Xa;const Ba={class:"t-c head"},za=["title"],xa=["title"];function Ua(e,t,a,n,o,r){const s=(0,l.g2)("el-button"),u=(0,l.g2)("el-input"),d=(0,l.g2)("el-table-column"),i=(0,l.g2)("WarnTriangleFilled"),c=(0,l.g2)("el-icon"),h=(0,l.g2)("el-switch"),m=(0,l.g2)("Delete"),p=(0,l.g2)("el-popconfirm"),v=(0,l.g2)("el-table"),g=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(g,{modelValue:n.state.show,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.show=e),onOpen:n.handleOnShowList,"append-to":".app-wrap",title:`【${n.machineName}】的内网穿透`,top:"1vh",width:"700"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.Lk)("div",Ba,[(0,l.bF)(s,{type:"success",size:"small",onClick:n.handleAdd},{default:(0,l.k6)((()=>[(0,l.eW)("添加")])),_:1},8,["onClick"]),(0,l.bF)(s,{size:"small",onClick:n.handleRefresh},{default:(0,l.k6)((()=>[(0,l.eW)("刷新")])),_:1},8,["onClick"])]),(0,l.bF)(v,{data:n.state.data,size:"small",border:"",height:"500",onCellDblclick:n.handleCellClick},{default:(0,l.k6)((()=>[(0,l.bF)(d,{property:"Name",label:"名称"},{default:(0,l.k6)((e=>[e.row.NameEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(u,{key:0,autofocus:"",size:"small",modelValue:e.row.Name,"onUpdate:modelValue":t=>e.row.Name=t,onBlur:t=>n.handleEditBlur(e.row,"Name")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.eW)((0,B.v_)(e.row.Name),1)],64))])),_:1}),(0,l.bF)(d,{prop:"BufferSize",label:"缓冲区",width:"100"},{default:(0,l.k6)((e=>[(0,l.Lk)("span",null,(0,B.v_)(1<<e.row.BufferSize)+"KB",1)])),_:1}),(0,l.bF)(d,{property:"Temp",label:"远程端口/域名",width:"160"},{default:(0,l.k6)((e=>[e.row.TempEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(u,{key:0,autofocus:"",size:"small",modelValue:e.row.Temp,"onUpdate:modelValue":t=>e.row.Temp=t,onBlur:t=>n.handleEditBlur(e.row,"Temp")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[e.row.Msg?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"error red",title:e.row.Msg},[(0,l.Lk)("span",null,(0,B.v_)(e.row.Temp),1),(0,l.bF)(c,{size:"20"},{default:(0,l.k6)((()=>[(0,l.bF)(i)])),_:1})],8,za)):((0,l.uX)(),(0,l.CE)("span",{key:1,class:(0,B.C4)({green:e.row.Started})},(0,B.v_)(e.row.Temp),3))],64))])),_:1}),(0,l.bF)(d,{property:"LocalEP",label:"本机服务",width:"140"},{default:(0,l.k6)((e=>[e.row.LocalEPEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(u,{key:0,autofocus:"",size:"small",modelValue:e.row.LocalEP,"onUpdate:modelValue":t=>e.row.LocalEP=t,onBlur:t=>n.handleEditBlur(e.row,"LocalEP")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[e.row.LocalMsg?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"error red",title:e.row.LocalMsg},[(0,l.Lk)("span",null,(0,B.v_)(e.row.LocalEP),1),(0,l.bF)(c,{size:"20"},{default:(0,l.k6)((()=>[(0,l.bF)(i)])),_:1})],8,xa)):((0,l.uX)(),(0,l.CE)("span",{key:1,class:(0,B.C4)({green:e.row.Started})},(0,B.v_)(e.row.LocalEP),3))],64))])),_:1}),(0,l.bF)(d,{property:"Started",label:"状态",width:"60"},{default:(0,l.k6)((e=>[(0,l.bF)(h,{modelValue:e.row.Started,"onUpdate:modelValue":t=>e.row.Started=t,onChange:t=>n.handleStartChange(e.row),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,l.bF)(d,{label:"操作",width:"54"},{default:(0,l.k6)((e=>[(0,l.bF)(p,{"confirm-button-text":"确认","cancel-button-text":"取消",title:"删除不可逆，是否确认?",onConfirm:t=>n.handleDel(e.row.Id)},{reference:(0,l.k6)((()=>[(0,l.bF)(s,{type:"danger",size:"small"},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.bF)(m)])),_:1})])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data","onCellDblclick"])])])),_:1},8,["modelValue","onOpen","title"])}var Da={props:["data","modelValue"],emits:["update:modelValue"],components:{WarnTriangleFilled:T.DtC,Delete:T.epd},setup(e,{emit:t}){const a=(0,u.B)(),n=_a(),o=(0,d.Kh)({bufferSize:a.value.bufferSize,show:!0,data:[],timer:0,timer1:0,editing:!1});(0,l.wB)((()=>o.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const r=()=>{clearTimeout(o.timer),(0,Fa.eX)(n.value.machineid).then((e=>{o.timer=setTimeout(r,1e3)})).catch((()=>{o.timer=setTimeout(r,1e3)}))},s=()=>{clearTimeout(o.timer1),0==o.editing?(0,Fa.pY)(n.value.machineid).then((e=>{e.forEach((e=>{e.Temp=(e.Domain||e.RemotePort).toString(),e.RemotePort=0,e.Domain=""})),o.data=e,o.timer1=setTimeout(s,1e3)})).catch((()=>{o.timer1=setTimeout(s,1e3)})):o.timer1=setTimeout(s,1e3)},c=()=>{s()},h=(e,t)=>{v(e,t.property)},m=()=>{s(),i.nk.success("已刷新")},p=()=>{const e={Id:0,Name:"",RemotePort:0,LocalEP:"127.0.0.1:80",Domain:"",Temp:""};(0,Fa.Qs)({machineid:n.value.machineid,data:e}).then((()=>{setTimeout((()=>{s()}),100)})).catch((e=>{i.nk.error(e)}))},v=(e,t)=>{e.Started?i.nk.error("请先停止运行"):(o.data.forEach((e=>{e["NameEditing"]=!1,e["RemotePortEditing"]=!1,e["LocalEPEditing"]=!1,e["DomainEditing"]=!1,e["TempEditing"]=!1})),e[`${t}Editing`]=!0,o.editing=!0)},g=(e,t)=>{e.Started?i.nk.error("请先停止运行"):(e[`${t}Editing`]=!1,o.editing=!1,w(e))},k=e=>{(0,Fa.DY)({machineid:n.value.machineid,id:e}).then((()=>{s()}))},f=e=>{w(e)},w=e=>{e.Temp&&(/^\d+$/.test(e.Temp)?e.RemotePort=parseInt(e.Temp):e.Domain=e.Temp,(0,Fa.Qs)({machineid:n.value.machineid,data:e}).then((e=>{0==e&&i.nk.error("操作失败，可能存在相同值"),s()})).catch((e=>{i.nk.error(e)})))};return(0,l.sV)((()=>{s(),r()})),(0,l.hi)((()=>{clearTimeout(o.timer),clearTimeout(o.timer1)})),{state:o,machineName:n.value.machineName,handleOnShowList:c,handleCellClick:h,handleRefresh:m,handleAdd:p,handleEdit:v,handleEditBlur:g,handleDel:k,handleStartChange:f}}};const Ka=(0,F.A)(Da,[["render",Ua],["__scopeId","data-v-9f4ae946"]]);var $a=Ka;const Ga=["onClick"],Qa={key:0},Oa={key:1},ja={key:0},qa={key:1},Ha={key:0},Ja={key:1};function Ya(e,t,a,n,o,r){const s=(0,l.g2)("el-table-column"),u=(0,l.g2)("Delete"),d=(0,l.g2)("el-icon"),i=(0,l.g2)("el-button"),c=(0,l.g2)("el-popconfirm"),h=(0,l.g2)("el-table"),m=(0,l.g2)("el-dialog"),p=(0,l.g2)("el-switch");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(m,{modelValue:n.state.show,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.show=e),"append-to":".app-wrap",title:`与[${n.state.machineName}]的链接`,top:"1vh",width:"780"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(h,{data:n.state.data,size:"small",border:"",height:"500"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{property:"RemoteMachineId",label:"目标/服务器"},{default:(0,l.k6)((e=>[(0,l.Lk)("div",{class:(0,B.C4)({green:e.row.Connected})},[(0,l.Lk)("p",null,(0,B.v_)(e.row.IPEndPoint),1),(0,l.Lk)("p",null,"ssl : "+(0,B.v_)(e.row.SSL),1)],2)])),_:1}),(0,l.bF)(s,{property:"TransactionId",label:"事务",width:"80"},{default:(0,l.k6)((e=>[(0,l.Lk)("span",null,(0,B.v_)(n.state.transactions[e.row.TransactionId]),1)])),_:1}),(0,l.bF)(s,{property:"TransportName",label:"协议"},{default:(0,l.k6)((e=>[(0,l.Lk)("div",null,[(0,l.Lk)("p",null,(0,B.v_)(e.row.TransportName)+"("+(0,B.v_)(n.state.protocolTypes[e.row.ProtocolType])+")",1),(0,l.Lk)("p",null,(0,B.v_)(n.state.types[e.row.Type])+" - "+(0,B.v_)(1<<e.row.BufferSize)+"KB",1)])])),_:1}),(0,l.bF)(s,{property:"Delay",label:"延迟",width:"60"},{default:(0,l.k6)((e=>[(0,l.Lk)("span",null,(0,B.v_)(e.row.Delay)+"ms",1)])),_:1}),(0,l.bF)(s,{property:"Bytes",label:"通信"},{default:(0,l.k6)((e=>[(0,l.Lk)("div",null,[(0,l.Lk)("p",null,"up : "+(0,B.v_)(e.row.SendBytesText),1),(0,l.Lk)("p",null,"down : "+(0,B.v_)(e.row.ReceiveBytesText),1)])])),_:1}),(0,l.bF)(s,{property:"relay",label:"中继节点"},{default:(0,l.k6)((e=>[(0,l.Lk)("div",null,[(0,l.Lk)("a",{href:"javascript:;",class:"a-line",onClick:t=>n.handleNode(e.row)},(0,B.v_)(n.state.nodesDic[e.row.NodeId]||"选择节点"),9,Ga)])])),_:1}),(0,l.bF)(s,{label:"操作",width:"54"},{default:(0,l.k6)((e=>[(0,l.Lk)("div",null,[n.hasTunnelRemove?((0,l.uX)(),(0,l.Wv)(c,{key:0,"confirm-button-text":"确认","cancel-button-text":"取消",title:"确定关闭此连接?",onConfirm:t=>n.handleDel(e.row)},{reference:(0,l.k6)((()=>[(0,l.bF)(i,{type:"danger",size:"small"},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(u)])),_:1})])),_:1})])),_:2},1032,["onConfirm"])):(0,l.Q3)("",!0)])])),_:1})])),_:1},8,["data"])])])),_:1},8,["modelValue","title"]),(0,l.bF)(m,{modelValue:n.state.showNodes,"onUpdate:modelValue":t[1]||(t[1]=e=>n.state.showNodes=e),title:e.$t("server.relayTitle"),width:"760",top:"2vh"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(h,{data:n.state.nodes,size:"small",border:"",height:"600"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{property:"Name",label:e.$t("server.relayName")},null,8,["label"]),(0,l.bF)(s,{property:"MaxGbTotal",label:e.$t("server.relayFlow"),width:"160"},{default:(0,l.k6)((e=>[0==e.row.MaxGbTotal?((0,l.uX)(),(0,l.CE)("span",Qa,"--")):((0,l.uX)(),(0,l.CE)("span",Oa,(0,B.v_)((e.row.MaxGbTotalLastBytes/1024/1024/1024).toFixed(2))+"GB / "+(0,B.v_)(e.row.MaxGbTotal)+"GB ",1))])),_:1},8,["label"]),(0,l.bF)(s,{property:"MaxBandwidth",label:e.$t("server.relaySpeed"),width:"80"},{default:(0,l.k6)((e=>[0==e.row.MaxBandwidth?((0,l.uX)(),(0,l.CE)("span",ja,"--")):((0,l.uX)(),(0,l.CE)("span",qa,(0,B.v_)(e.row.MaxBandwidth)+"Mbps",1))])),_:1},8,["label"]),(0,l.bF)(s,{property:"MaxBandwidthTotal",label:e.$t("server.relaySpeed1"),width:"80"},{default:(0,l.k6)((e=>[0==e.row.MaxBandwidthTotal?((0,l.uX)(),(0,l.CE)("span",Ha,"无限制")):((0,l.uX)(),(0,l.CE)("span",Ja,(0,B.v_)(e.row.MaxBandwidthTotal)+"Mbps",1))])),_:1},8,["label"]),(0,l.bF)(s,{property:"BandwidthRatio",label:e.$t("server.relaySpeed2"),width:"66"},{default:(0,l.k6)((e=>[(0,l.Lk)("span",null,(0,B.v_)((100*e.row.BandwidthRatio).toFixed(2))+"%",1)])),_:1},8,["label"]),(0,l.bF)(s,{property:"ConnectionRatio",label:e.$t("server.relayConnection"),width:"60"},{default:(0,l.k6)((e=>[(0,l.Lk)("span",null,(0,B.v_)((100*e.row.ConnectionRatio).toFixed(2))+"%",1)])),_:1},8,["label"]),(0,l.bF)(s,{property:"Delay",label:e.$t("server.relayDelay"),width:"60"},{default:(0,l.k6)((e=>[(0,l.Lk)("span",null,(0,B.v_)(e.row.Delay)+"ms",1)])),_:1},8,["label"]),(0,l.bF)(s,{property:"Public",label:e.$t("server.relayPublic"),width:"60"},{default:(0,l.k6)((e=>[(0,l.bF)(p,{disabled:"",modelValue:e.row.Public,"onUpdate:modelValue":t=>e.row.Public=t,size:"small"},null,8,["modelValue","onUpdate:modelValue"])])),_:1},8,["label"]),(0,l.bF)(s,{property:"Oper",label:e.$t("server.relayOper"),width:"65"},{default:(0,l.k6)((t=>[(0,l.bF)(i,{type:"success",size:"small",onClick:e=>n.handleConnect(t.row.Id)},{default:(0,l.k6)((()=>[(0,l.eW)((0,B.v_)(e.$t("server.relayUse")),1)])),_:2},1032,["onClick"])])),_:1},8,["label"])])),_:1},8,["data"])])])),_:1},8,["modelValue","title"])],64)}var Za=a(9232),el=a(5931),tl={props:["modelValue"],emits:["change","update:modelValue"],components:{Delete:T.epd},setup(e,{emit:t}){const{t:a}=(0,el.s9)(),n=(0,u.B)(),o=(0,l.EW)((()=>n.value.hasAccess("TunnelRemove"))),r=(0,Wt.ZY)(),s=(0,Wt.mx)(),c=(0,Wt.FG)(),h=(0,Wt.bB)(),m=(0,d.Kh)({show:!0,protocolTypes:{1:"tcp",2:"udp",4:"msquic"},types:{0:"打洞",1:"中继",2:"节点"},transactions:{forward:"端口转发",tuntap:"虚拟网卡",socks5:"代理转发"},machineName:r.value.currentName,currentRow:{},data:(0,l.EW)((()=>[s.value.list[r.value.current],c.value.list[r.value.current],h.value.list[r.value.current]].filter((e=>!!e)))),showNodes:!1,nodes:[],nodesDic:{},timer:0});(0,l.wB)((()=>m.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e),t("change")}),300)}));const p=e=>{o.value&&e.removeFunc(e.RemoteMachineId).then((()=>{i.nk.success(a("common.oper"))})).catch((()=>{}))},v=()=>{(0,Za.W4)().then((e=>{m.nodes=e,m.nodesDic=e.reduce(((e,t)=>(e[t.Id]=t.Name,e)),{}),m.timer=setTimeout(v,1e3)})).catch((()=>{m.timer=setTimeout(v,1e3)}))},g=e=>{m.currentRow=e,m.showNodes=!0},k=e=>{const t={FromMachineId:n.value.config.Client.Id,TransactionId:m.currentRow.TransactionId,ToMachineId:m.currentRow.RemoteMachineId,NodeId:e};t.NodeId!=m.currentRow.NodeId&&((0,Za.uQ)(t).then((()=>{})).catch((()=>{})),m.showNodes=!1)};return(0,l.sV)((()=>{r.value.updateRealTime(!0),v()})),(0,l.hi)((()=>{r.value.updateRealTime(!1),clearTimeout(m.timer)})),{state:m,handleDel:p,hasTunnelRemove:o,handleNode:g,handleConnect:k}}};const al=(0,F.A)(tl,[["render",Ya],["__scopeId","data-v-32318a6a"]]);var ll=al,nl=a(9383);const ol={class:"updater-wrap t-c"},rl={style:{"margin-top":"1rem"}},sl={class:"t-c"};function ul(e,t,a,n,o,r){const s=(0,l.g2)("el-option"),u=(0,l.g2)("el-select"),d=(0,l.g2)("el-button"),i=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(i,{class:"options-center",title:"更新","destroy-on-close":"",modelValue:n.state.show,"onUpdate:modelValue":t[2]||(t[2]=e=>n.state.show=e),width:"24rem",top:"2vh"},{footer:(0,l.k6)((()=>[(0,l.Lk)("div",sl,[(0,l.bF)(d,{type:"success",onClick:n.handleUpdate,plain:""},{default:(0,l.k6)((()=>[(0,l.eW)("确 定")])),_:1},8,["onClick"])])])),default:(0,l.k6)((()=>[(0,l.Lk)("div",ol,[(0,l.Lk)("div",null,[(0,l.bF)(u,{modelValue:n.state.type,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.type=e),size:"large"},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.types,(e=>((0,l.uX)(),(0,l.Wv)(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),(0,l.Lk)("div",rl,[(0,l.bF)(u,{modelValue:n.state.version,"onUpdate:modelValue":t[1]||(t[1]=e=>n.state.version=e),size:"large",filterable:"","allow-create":"","default-first-option":""},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.versions,(e=>((0,l.uX)(),(0,l.Wv)(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])])),_:1},8,["modelValue"])}var dl={props:["modelValue"],emits:["update:modelValue"],setup(e,{emit:t}){const a=(0,u.B)(),n=((0,l.EW)((()=>a.value.hasAccess("UpdateSelf"))),(0,l.EW)((()=>a.value.hasAccess("UpdateOther")))),o=(0,nl.T)(),r=(0,l.EW)((()=>a.value.signin.Version)),s=(0,l.EW)((()=>o.value.current.Version)),i=[{label:`仅【${o.value.device.MachineName}】`,value:o.value.device.MachineId},n.value?{label:"本组所有",value:"g-all"}:{},n.value?{label:"本服务器所有",value:"s-all"}:{}].filter((e=>e.value)),c=[{label:`${s.value}【最新版本】`,value:s.value},{label:`${r.value}【服务器版本】`,value:s.value}].filter((e=>e.value)),h=(0,d.Kh)({show:!0,type:i[0]||"",version:c[0]||"",types:i,versions:c});(0,l.wB)((()=>h.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const m=()=>{const e={MachineId:o.value.device.MachineId,Version:h.version.value||h.version,GroupAll:"g-all"==h.type,All:"s-all"==h.type};(e.All||e.GroupAll)&&(e.MachineId=""),(0,P.lJ)(e).then((()=>{})).catch((()=>{})),h.show=!1};return{state:h,updater:o,handleUpdate:m}}};const il=(0,F.A)(dl,[["render",ul]]);var cl=il,hl={components:{Sort:E,Oper:N,Device:Z,DeviceEdit:oe,AccessEdit:ce,Tunnel:ua,TunnelEdit:ga,ConnectionsEdit:ll,Tuntap:ke,TuntapEdit:tt,TuntapLease:Ft,Socks5:Ut,Socks5Edit:Jt,Forward:ya,ForwardEdit:Na,SForwardEdit:$a,UpdaterConfirm:cl},setup(e){const t=(0,u.B)(),a=(0,d.Kh)({height:(0,l.EW)((()=>t.value.height-90))}),{devices:n,machineId:o,_getSignList:r,_getSignList1:s,handleDeviceEdit:c,handleAccessEdit:h,handlePageChange:m,handlePageSizeChange:v,handleDel:g,clearDevicesTimeout:k,setSort:w}=(0,re.r)(),{tuntap:C,_getTuntapInfo:F,handleTuntapEdit:L,handleTuntapRefresh:E,clearTuntapTimeout:_,getTuntapMachines:V,sortTuntapIP:I}=(0,b.O)(),{socks5:y,_getSocks5Info:S,handleSocks5Edit:P,handleSocks5Refresh:T,clearSocks5Timeout:M,getSocks5Machines:W,sortSocks5:R}=f(),{tunnel:X,_getTunnelInfo:N,handleTunnelEdit:B,handleTunnelRefresh:z,clearTunnelTimeout:x,sortTunnel:U}=na(),{forward:D,_getForwardCountInfo:K,handleForwardEdit:$,clearForwardTimeout:G,handleForwardRefresh:Q}=p(),{sforward:O,_getSForwardCountInfo:j,handleSForwardEdit:q,clearSForwardTimeout:H,handleSForwardRefresh:J}=Ea(),{connections:Y,forwardConnections:Z,_getForwardConnections:ee,tuntapConnections:te,_getTuntapConnections:ae,socks5Connections:le,_getSocks5Connections:ne,handleTunnelConnections:oe,clearConnectionsTimeout:se}=(0,Wt.L2)(),{updater:ue,_getUpdater:de,_subscribeUpdater:ie,clearUpdaterTimeout:ce}=(0,nl.d)(),{_getAccessInfo:he,clearAccessTimeout:me,handleAccesssRefresh:pe}=(0,A.Y)(),ve=e=>{n.page.Request.Prop=e.prop,n.page.Request.Asc="ascending"==e.order;let t=new Promise(((e,t)=>{e()}));if("tunnel"==e.prop){const e=U(n.page.Request.Asc);e.length>0&&(t=w(e))}else if("tuntap"==e.prop){const e=I(n.page.Request.Asc);e.length>0&&(t=w(e))}else if("socks5"==e.prop){const e=R(n.page.Request.Asc);e.length>0&&(t=w(e))}t.then((()=>{m()})).catch((()=>{}))},ge=e=>{n.page.Request.Name=e||"",n.page.Request.Name?n.page.Request.Ids=V(n.page.Request.Name).concat(W(n.page.Request.Name)).reduce(((e,t)=>(-1==e.indexOf(t)&&e.push(t),e)),[]):n.page.Request.Ids=[],m(),z(),E(),T(),Q(),J(),pe(),i.nk.success({message:"刷新成功",grouping:!0})},ke=()=>{m(),z(),E(),T(),pe(),i.nk.success({message:"刷新成功",grouping:!0})};return(0,l.sV)((()=>{m(),z(),E(),T(),Q(),J(),pe(),r(),s(),F(),S(),N(),ee(),ae(),ne(),K(),j(),de(),ie(),he()})),(0,l.hi)((()=>{k(),se(),_(),M(),x(),G(),H(),ce(),me()})),{state:a,devices:n,machineId:o,handleSortChange:ve,handleDeviceEdit:c,handleAccessEdit:h,handlePageRefresh:ge,handlePageSearch:ke,handlePageChange:m,handlePageSizeChange:v,handleDel:g,tuntap:C,handleTuntapEdit:L,handleTuntapRefresh:E,socks5:y,handleSocks5Edit:P,handleSocks5Refresh:T,tunnel:X,connections:Y,handleTunnelEdit:B,handleTunnelRefresh:z,handleTunnelConnections:oe,forward:D,handleForwardEdit:$,sforward:O,handleSForwardEdit:q,updater:ue}}};const ml=(0,F.A)(hl,[["render",s],["__scopeId","data-v-524833e4"]]);var pl=ml},4001:function(e,t,a){a.d(t,{A:function(){return b}});var l=a(6768),n=a(4232);const o=["title"],r={key:0,class:"progress"},s={key:1,class:"progress"};function u(e,t,a,u,d,i){const c=(0,l.g2)("Loading"),h=(0,l.g2)("el-icon"),m=(0,l.g2)("Download"),p=(0,l.g2)("CircleCheck"),v=(0,l.g2)("Refresh");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("a",{href:"javascript:;",class:(0,n.C4)(["download",u.updaterColor]),onClick:t[0]||(t[0]=e=>u.handleUpdate()),title:u.updaterText},[(0,l.Lk)("span",null,[(0,l.Lk)("span",null,(0,n.v_)(u.item.Version),1),u.updater.list[u.item.MachineId]?((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[1==u.updater.list[u.item.MachineId].Status?((0,l.uX)(),(0,l.Wv)(h,{key:0,size:"14",class:"loading"},{default:(0,l.k6)((()=>[(0,l.bF)(c)])),_:1})):2==u.updater.list[u.item.MachineId].Status?((0,l.uX)(),(0,l.Wv)(h,{key:1,size:"14"},{default:(0,l.k6)((()=>[(0,l.bF)(m)])),_:1})):3==u.updater.list[u.item.MachineId].Status||5==u.updater.list[u.item.MachineId].Status?((0,l.uX)(),(0,l.CE)(l.FK,{key:2},[(0,l.bF)(h,{size:"14",class:"loading"},{default:(0,l.k6)((()=>[(0,l.bF)(c)])),_:1}),0==u.updater.list[u.item.MachineId].Length?((0,l.uX)(),(0,l.CE)("span",r,"0%")):((0,l.uX)(),(0,l.CE)("span",s,(0,n.v_)(parseInt(u.updater.list[u.item.MachineId].Current/u.updater.list[u.item.MachineId].Length*100))+"%",1))],64)):6==u.updater.list[u.item.MachineId].Status?((0,l.uX)(),(0,l.Wv)(h,{key:3,size:"14",class:"yellow"},{default:(0,l.k6)((()=>[(0,l.bF)(p)])),_:1})):(0,l.Q3)("",!0)],64)):((0,l.uX)(),(0,l.Wv)(h,{key:1,size:"14"},{default:(0,l.k6)((()=>[(0,l.bF)(m)])),_:1}))])],10,o),(0,l.Lk)("a",{href:"javascript:;",class:"download",title:"检查更新",onClick:t[1]||(t[1]=(...e)=>u.handleCheck&&u.handleCheck(...e))},[(0,l.bF)(h,null,{default:(0,l.k6)((()=>[(0,l.bF)(v)])),_:1})])],64)}var d=a(3830),i=a(144),c=a(1219),h=a(2933),m=a(2248),p=a(920),v=a(7477),g=a(9383),k={props:["item","config"],components:{Download:v.f5X,Loading:v.Rhj,CircleCheck:v.rW7,Refresh:v.C42},setup(e){const t=(0,d.B)(),a=(0,l.EW)((()=>t.value.hasAccess("UpdateSelf"))),n=((0,l.EW)((()=>t.value.hasAccess("UpdateOther"))),(0,g.T)()),o=(0,l.EW)((()=>t.value.signin.Version)),r=(0,l.EW)((()=>n.value.current.Version)),s=(0,l.EW)((()=>`${r.value}->${n.value.current.DateTime}\n${n.value.current.Msg.map(((e,t)=>`${t+1}、${e}`)).join("\n")}`)),u=(0,l.EW)((()=>n.value.list[e.item.MachineId]?n.value.list[e.item.MachineId].Status<=2?e.item.Version!=o.value?`与服务器版本(${o.value})不一致，建议更新`:r.value!=e.item.Version?`不是最新版本(${r.value})，建议更新\n${s.value}`:`是最新版本，但我无法阻止你喜欢更新\n${s.value}`:{3:"正在下载",4:"已下载",5:"正在解压",6:"已解压，请重启"}[n.value.list[e.item.MachineId].Status]:"未检测到更新")),v=(0,l.EW)((()=>e.item.Version!=o.value?"red":n.value.list[e.item.MachineId]&&r.value!=e.item.Version?"yellow":"green")),k=()=>{if(n.value.device=e.item,!e.config)return;if(!a.value)return;const t=n.value.list[e.item.MachineId];t?[0,1,3,5].indexOf(t.Status)>=0?c.nk.error("操作中，请稍后!"):6!=t.Status?n.value.show=2==t.Status:h.s.confirm("确定关闭程序吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{exit(e.item.MachineId)})).catch((()=>{})):c.nk.error("未检测到更新")},f=()=>{const t=(0,i.KR)(e.item.MachineId),a=[(0,l.h)(m.P9,{label:`仅检查[${e.item.MachineName}]`,value:e.item.MachineId}),(0,l.h)(m.P9,{label:"仅检查[本组所有]",value:"g-all"})];(0,h.s)({title:"选择检查对象",message:()=>(0,l.h)(m.AV,{modelValue:t.value,placeholder:"请选择",style:"width:20rem;","onUpdate:modelValue":e=>{t.value=e}},a),confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{(0,p.Ce)(t.value==e.item.MachineId?t.value:"")})).catch((()=>{}))};return{item:(0,l.EW)((()=>e.item)),updater:n,updaterText:u,updaterColor:v,handleUpdate:k,handleCheck:f}}},f=a(1241);const w=(0,f.A)(k,[["render",u],["__scopeId","data-v-90c5041c"]]);var b=w}}]);