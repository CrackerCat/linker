"use strict";(self["webpackChunklinker_web"]=self["webpackChunklinker_web"]||[]).push([[445],{8835:function(e,a,t){t.d(a,{a:function(){return o},z:function(){return l}});var n=t(4);const l=()=>(0,n.zG)("configclient/get"),o=e=>(0,n.zG)("configclient/install",e)},445:function(e,a,t){t.d(a,{A:function(){return N}});var n=t(6768),l=t(4232);const o=e=>((0,n.Qi)("data-v-1c2e083d"),e=e(),(0,n.jt)(),e),s={class:"status-wrap flex"},u={class:"copy"},i=o((()=>(0,n.Lk)("a",{href:"https://github.com/snltty/linker",target:"_blank"},"snltty©linker",-1))),r=["title"],c={key:0,class:"progress"},d={key:1,class:"progress"},v=o((()=>(0,n.Lk)("div",{class:"flex-1"},null,-1))),p={class:"api"},g={class:"server"};function f(e,a,t,o,f,h){const m=(0,n.g2)("Loading"),k=(0,n.g2)("el-icon"),C=(0,n.g2)("Download"),w=(0,n.g2)("CircleCheck"),V=(0,n.g2)("Api"),S=(0,n.g2)("Server");return(0,n.uX)(),(0,n.CE)("div",s,[(0,n.Lk)("div",u,[i,(0,n.Lk)("a",{href:"javascript:;",class:(0,l.C4)(["download",o.updateColor]),onClick:a[0]||(a[0]=e=>o.handleUpdate()),title:o.updateText},[(0,n.Lk)("span",null,[(0,n.Lk)("span",null,(0,l.v_)(o.self.Version),1),o.updater.Version?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[1==o.updater.Status?((0,n.uX)(),(0,n.Wv)(k,{key:0,size:"14",class:"loading"},{default:(0,n.k6)((()=>[(0,n.bF)(m)])),_:1})):2==o.updater.Status?((0,n.uX)(),(0,n.Wv)(k,{key:1,size:"14"},{default:(0,n.k6)((()=>[(0,n.bF)(C)])),_:1})):3==o.updater.Status||5==o.updater.Status?((0,n.uX)(),(0,n.CE)(n.FK,{key:2},[(0,n.bF)(k,{size:"14",class:"loading"},{default:(0,n.k6)((()=>[(0,n.bF)(m)])),_:1}),0==o.updater.Length?((0,n.uX)(),(0,n.CE)("span",c,"0%")):((0,n.uX)(),(0,n.CE)("span",d,(0,l.v_)(parseInt(o.updater.Current/o.updater.Length*100))+"%",1))],64)):6==o.updater.Status?((0,n.uX)(),(0,n.Wv)(k,{key:3,size:"14",class:"yellow"},{default:(0,n.k6)((()=>[(0,n.bF)(w)])),_:1})):(0,n.Q3)("",!0)],64)):((0,n.uX)(),(0,n.Wv)(k,{key:1,size:"14"},{default:(0,n.k6)((()=>[(0,n.bF)(C)])),_:1}))])],10,r)]),v,(0,n.Lk)("div",p,[(0,n.bF)(V,{config:o.config},null,8,["config"])]),(0,n.Lk)("div",g,[(0,n.bF)(S,{config:o.config},null,8,["config"])])])}t(4114);var h=t(144);const m={href:"javascript:;",title:"此设备的管理接口"},k={class:"port-wrap t-c"},C={class:"pdt-10"};function w(e,a,t,o,s,u){const i=(0,n.g2)("Tools"),r=(0,n.g2)("el-icon"),c=(0,n.g2)("el-popconfirm"),d=(0,n.g2)("el-input"),v=(0,n.g2)("el-button"),p=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.CE)("div",{class:(0,l.C4)(["status-api-wrap",{connected:o.connected}])},[o.config?((0,n.uX)(),(0,n.Wv)(c,{key:0,"confirm-button-text":"清除","cancel-button-text":"更改",title:"确定你的操作？",onCancel:o.handleShow,onConfirm:o.handleResetConnect},{reference:(0,n.k6)((()=>[(0,n.Lk)("a",m,[(0,n.bF)(r,{size:"16"},{default:(0,n.k6)((()=>[(0,n.bF)(i)])),_:1}),(0,n.eW)(" 管理接口 ")])])),_:1},8,["onCancel","onConfirm"])):(0,n.Q3)("",!0),(0,n.bF)(p,{class:"options-center",title:"管理接口","destroy-on-close":"",modelValue:o.showPort,"onUpdate:modelValue":a[2]||(a[2]=e=>o.showPort=e),center:"","show-close":!1,"close-on-click-modal":!1,"align-center":"",width:"200"},{footer:(0,n.k6)((()=>[(0,n.bF)(v,{type:"success",onClick:o.handleConnect1,plain:""},{default:(0,n.k6)((()=>[(0,n.eW)("确 定")])),_:1},8,["onClick"])])),default:(0,n.k6)((()=>[(0,n.Lk)("div",k,[(0,n.Lk)("div",null,[(0,n.eW)(" 接口 : "),(0,n.bF)(d,{modelValue:o.state.api,"onUpdate:modelValue":a[0]||(a[0]=e=>o.state.api=e),style:{width:"70%"}},null,8,["modelValue"])]),(0,n.Lk)("div",C,[(0,n.eW)(" 秘钥 : "),(0,n.bF)(d,{type:"password",modelValue:o.state.psd,"onUpdate:modelValue":a[1]||(a[1]=e=>o.state.psd=e),style:{width:"70%"}},null,8,["modelValue"])])])])),_:1},8,["modelValue"])],2)}var V=t(1387),S=t(3830),b=t(4),y=t(9299),F=t(8835),_=t(7477),L={components:{Tools:_.S0q},props:["config"],setup(e){const a=(0,S.B)(),t=(0,n.EW)((()=>a.value.api.connected)),l=(0,V.rd)(),o=(0,V.lq)(),s={api:`${window.location.hostname}:1803`,psd:"snltty"},u=JSON.parse(localStorage.getItem("api-cache")||JSON.stringify(s)),i=(0,h.Kh)({api:u.api,psd:u.psd,showPort:!1}),r=(0,n.EW)((()=>0==a.value.api.connected&&i.showPort)),c=()=>{localStorage.setItem("api-cache",""),l.push({name:o.name}),window.location.reload()},d=()=>{u.api=i.api,u.psd=i.psd,localStorage.setItem("api-cache",JSON.stringify(u)),(0,b.e3)(),(0,b.a1)(`ws://${i.api}`,i.psd)},v=()=>{d(),window.location.reload()},p=()=>{(0,b.e3)(),(0,b.a1)(`ws://${window.location.hostname}:12345`,i.psd)},g=()=>{(0,F.z)().then((e=>{a.value.config.Common=e.Common,a.value.config.Client=e.Client,a.value.config.Server=e.Server,a.value.config.Running=e.Running,a.value.config.configed=!0,setTimeout((()=>{g()}),1e3)})).catch((e=>{setTimeout((()=>{g()}),1e3)}))},f=()=>{(0,y.SZ)().then((e=>{a.value.signin.Connected=e.Connected,a.value.signin.Connecting=e.Connecting,a.value.signin.Version=e.Version,setTimeout((()=>{f()}),1e3)})).catch((e=>{setTimeout((()=>{f()}),1e3)}))};return(0,n.sV)((()=>{setTimeout((()=>{i.showPort=!0}),500),(0,b.jH)((e=>{e&&(g(),f())})),l.isReady().then((()=>{i.api=o.query.api?`${window.location.hostname}:${o.query.api}`:i.api,i.psd=o.query.psd||i.psd,d()}))})),{config:e.config,state:i,showPort:r,handleConnect1:v,connected:t,handleShow:p,handleResetConnect:c}}},W=t(1241);const $=(0,W.A)(L,[["render",w],["__scopeId","data-v-86c4bd96"]]);var T=$;const E=["title"],X={key:0,class:"progress"},x={key:1,class:"progress"},z={class:"dialog-footer t-c"};function I(e,a,t,o,s,u){const i=(0,n.g2)("Promotion"),r=(0,n.g2)("el-icon"),c=(0,n.g2)("Loading"),d=(0,n.g2)("Download"),v=(0,n.g2)("CircleCheck"),p=(0,n.g2)("el-input"),g=(0,n.g2)("el-form-item"),f=(0,n.g2)("el-form"),h=(0,n.g2)("el-button"),m=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.Lk)("div",{class:(0,l.C4)(["status-server-wrap",{connected:o.state.connected}])},[(0,n.Lk)("a",{href:"javascript:;",title:"更改你的连接设置",onClick:a[0]||(a[0]=(...e)=>o.handleConfig&&o.handleConfig(...e))},[(0,n.bF)(r,{size:"16"},{default:(0,n.k6)((()=>[(0,n.bF)(i)])),_:1}),(0,n.eW)(" 信标服务器")]),(0,n.Lk)("a",{href:"javascript:;",title:"服务端的程序版本",onClick:a[1]||(a[1]=(...e)=>o.handleUpdate&&o.handleUpdate(...e)),class:(0,l.C4)(["download",o.updateColor()])},[(0,n.Lk)("span",null,(0,l.v_)(o.state.version),1),o.updaterCurrent.Version?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[1==o.updaterCurrent.Status?((0,n.uX)(),(0,n.Wv)(r,{key:0,size:"14",class:"loading"},{default:(0,n.k6)((()=>[(0,n.bF)(c)])),_:1})):2==o.updaterServer.Status?((0,n.uX)(),(0,n.Wv)(r,{key:1,size:"14"},{default:(0,n.k6)((()=>[(0,n.bF)(d)])),_:1})):3==o.updaterServer.Status||5==o.updaterServer.Status?((0,n.uX)(),(0,n.CE)(n.FK,{key:2},[(0,n.bF)(r,{size:"14",class:"loading"},{default:(0,n.k6)((()=>[(0,n.bF)(c)])),_:1}),0==o.updaterServer.Length?((0,n.uX)(),(0,n.CE)("span",X,"0%")):((0,n.uX)(),(0,n.CE)("span",x,(0,l.v_)(parseInt(o.updaterServer.Current/o.updaterServer.Length*100))+"%",1))],64)):6==o.updaterServer.Status?((0,n.uX)(),(0,n.Wv)(r,{key:3,size:"14",class:"yellow"},{default:(0,n.k6)((()=>[(0,n.bF)(v)])),_:1})):(0,n.Q3)("",!0)],64)):((0,n.uX)(),(0,n.Wv)(r,{key:1,size:"14"},{default:(0,n.k6)((()=>[(0,n.bF)(d)])),_:1}))],10,E)],2),(0,n.bF)(m,{modelValue:o.state.show,"onUpdate:modelValue":a[5]||(a[5]=e=>o.state.show=e),title:"连接设置",width:"300"},{footer:(0,n.k6)((()=>[(0,n.Lk)("div",z,[(0,n.bF)(h,{onClick:a[4]||(a[4]=e=>o.state.show=!1),loading:o.state.loading},{default:(0,n.k6)((()=>[(0,n.eW)("取消")])),_:1},8,["loading"]),(0,n.bF)(h,{type:"primary",onClick:o.handleSave,loading:o.state.loading},{default:(0,n.k6)((()=>[(0,n.eW)("确定保存")])),_:1},8,["onClick","loading"])])])),default:(0,n.k6)((()=>[(0,n.Lk)("div",null,[(0,n.bF)(f,{model:o.state.form,rules:o.state.rules,"label-width":"6rem"},{default:(0,n.k6)((()=>[(0,n.bF)(g,{label:"机器名",prop:"name"},{default:(0,n.k6)((()=>[(0,n.bF)(p,{modelValue:o.state.form.name,"onUpdate:modelValue":a[2]||(a[2]=e=>o.state.form.name=e),maxlength:"12","show-word-limit":""},null,8,["modelValue"])])),_:1}),(0,n.bF)(g,{label:"分组名",prop:"groupid"},{default:(0,n.k6)((()=>[(0,n.bF)(p,{modelValue:o.state.form.groupid,"onUpdate:modelValue":a[3]||(a[3]=e=>o.state.form.groupid=e),type:"password","show-password":"",maxlength:"36","show-word-limit":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue"])],64)}var P=t(1219),B=t(2933),U=t(920),j={components:{Promotion:_.Yk4,Download:_.f5X,Loading:_.Rhj,CircleCheck:_.rW7},props:["config"],setup(e){const a=(0,S.B)(),t=(0,h.KR)({Version:"",Msg:[],DateTime:"",Status:0,Length:0,Current:0}),l=(0,h.KR)({Version:"",Status:0,Length:0,Current:0}),o=(0,n.EW)((()=>`${t.value.Version}->${t.value.DateTime}\n${t.value.Msg.map(((e,a)=>`${a+1}、${e}`)).join("\n")}`)),s=(0,h.Kh)({show:!1,loading:!1,connected:(0,n.EW)((()=>a.value.signin.Connected)),version:(0,n.EW)((()=>a.value.signin.Version)),form:{name:a.value.config.Client.Name,groupid:a.value.config.Client.GroupId},rules:{}}),u=()=>{(0,U.Vk)().then((e=>{t.value.DateTime=e.DateTime,t.value.Version=e.Version,t.value.Status=e.Status,t.value.Length=e.Length,t.value.Current=e.Current,t.value.Msg=e.Msg,setTimeout((()=>{u()}),1e3)})).catch((()=>{setTimeout((()=>{u()}),1e3)}))},i=()=>{(0,U.BJ)().then((e=>{l.value.Version=e.Version,l.value.Status=e.Status,l.value.Length=e.Length,l.value.Current=e.Current,l.value.Status>2&&l.value.Status<6&&setTimeout((()=>{i()}),1e3)})).catch((()=>{setTimeout((()=>{i()}),1e3)}))},r=()=>t.value.Version?l.value.Status<=2?s.version!=t.value.Version?`不是最新版本(${t.value.Version})，建议更新\n${o.value}`:`是最新版本，但我无法阻止你喜欢更新\n${o.value}`:{3:"正在下载",4:"已下载",5:"正在解压",6:"已解压，请重启"}[l.value.Status]:"未检测到更新",c=()=>s.version!=t.value.Version?"yellow":"green",d=()=>{e.config&&(t.value.Version?[0,1,3,5].indexOf(l.value.Status)>=0?P.nk.error("操作中，请稍后!"):6!=l.value.Status?2==t.value.Status&&B.s.confirm("确定更新服务端吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,U.y2)(t.value.Version).then((()=>{setTimeout((()=>{i()}),1e3)}))})).catch((()=>{})):B.s.confirm("确定关闭服务端吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,U.aP)()})).catch((()=>{})):P.nk.error("未检测到更新"))},v=()=>{e.config&&(s.form.name=a.value.config.Client.Name,s.form.groupid=a.value.config.Client.GroupId,s.show=!0)},p=()=>{s.loading=!0,(0,y.rd)(s.form).then((()=>{s.loading=!1,s.show=!1,P.nk.success("已操作")})).catch((e=>{s.loading=!1,P.nk.success("操作失败!")}))};return(0,n.sV)((()=>{(0,b.jH)((e=>{e&&(u(),i())}))})),{config:e.config,state:s,handleConfig:v,handleSave:p,updaterCurrent:t,updaterServer:l,handleUpdate:d,updateText:r,updateColor:c}}};const M=(0,W.A)(j,[["render",I],["__scopeId","data-v-d4c02b68"]]);var K=M,R=t(2248),A={components:{Api:T,Server:K,Download:_.f5X,Loading:_.Rhj,CircleCheck:_.rW7},props:["config"],setup(e){const a=(0,S.B)(),t=(0,n.EW)((()=>a.value.updater)),l=(0,n.EW)((()=>t.value.Version)),o=(0,n.EW)((()=>a.value.self)),s=(0,n.EW)((()=>a.value.signin.Version)),u=(0,n.EW)((()=>`${t.value.Version}->${t.value.DateTime}\n${t.value.Msg.map(((e,a)=>`${a+1}、${e}`)).join("\n")}`)),i=(0,n.EW)((()=>t.value.Version&&o.value.Version?t.value<=2?t.value.Version!=s.value?`与服务器版本(${s.value})不一致，建议更新`:o.value.Version!=t.value.Version?`不是最新版本(${o.value.Version})，建议更新\n${u.value}`:`是最新版本，但我无法阻止你喜欢更新\n${u.value}`:{3:"正在下载",4:"已下载",5:"正在解压",6:"已解压，请重启"}[t.value.Status]:"未检测到更新")),r=(0,n.EW)((()=>t.value.Version!=s.value?"red":o.value.Version!=t.value.Version?"yellow":"green")),c=()=>{if(t.value.Version)if([0,1,3,5].indexOf(t.value.Status)>=0)P.nk.error("操作中，请稍后!");else if(6!=t.value.Status){if(2==t.value.Status){const a=(0,h.KR)(l.value),t=[(0,n.h)(R.P9,{label:`仅[${o.value.MachineName}] -> ${l.value}(最新版本)`,value:l.value})];e.config&&t.push((0,n.h)(R.P9,{label:`[所有] -> ${l.value}(最新版本)`,value:`all->${l.value}`})),o.value.Version!=s.value&&l.value!=s.value&&(t.push((0,n.h)(R.P9,{label:`仅[${o.value.MachineName}] -> ${s.value}(服务器版本)`,value:s.value})),e.config&&t.push((0,n.h)(R.P9,{label:`[所有] -> ${s.value}(服务器版本)`,value:`all->${s.value}`}))),(0,B.s)({title:"选择版本",message:()=>(0,n.h)(R.AV,{modelValue:a.value,placeholder:"请选择",style:"width:20rem;","onUpdate:modelValue":e=>{a.value=e}},t),confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{const e={MachineId:o.value.MachineId,Version:a.value.replace("all->",""),All:a.value.indexOf("all->")>=0};e.All&&(e.MachineId=""),(0,U.lJ)(e)})).catch((()=>{}))}}else B.s.confirm("确定关闭程序吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,U.NS)(o.value.MachineId)})).catch((()=>{}));else P.nk.error("未检测到更新")};return{config:e.config,self:o,updater:t,updateText:i,updateColor:r,handleUpdate:c}}};const D=(0,W.A)(A,[["render",f],["__scopeId","data-v-1c2e083d"]]);var N=D}}]);