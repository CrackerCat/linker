"use strict";(self["webpackChunklinker_web"]=self["webpackChunklinker_web"]||[]).push([[0],{743:function(e,t,a){a.d(t,{$U:function(){return s},Ap:function(){return n},Co:function(){return o},DY:function(){return u},Qs:function(){return d},eX:function(){return i},pY:function(){return r}});var l=a(4);const n=()=>(0,l.zG)("sforwardclient/GetSecretKey"),o=e=>(0,l.zG)("sforwardclient/SetSecretKey",e),r=(e="0")=>(0,l.zG)("sforwardclient/get",e),s=e=>(0,l.zG)("sforwardclient/getremote",e),u=e=>(0,l.zG)("sforwardclient/remove",e),d=e=>(0,l.zG)("sforwardclient/add",e),i=()=>(0,l.zG)("sforwardclient/TestLocal")},83:function(e,t,a){a.d(t,{$M:function(){return d},KW:function(){return u},S3:function(){return c},Vn:function(){return i},b0:function(){return o},gM:function(){return s},ix:function(){return n},r7:function(){return r}});var l=a(4);const n=()=>(0,l.zG)("tunnel/gettypes"),o=e=>(0,l.zG)("tunnel/SetServers",e),r=(e="0")=>(0,l.zG)("tunnel/get",e),s=()=>(0,l.zG)("tunnel/refresh"),u=e=>(0,l.zG)("tunnel/SetRouteLevel",e),d=e=>(0,l.zG)("tunnel/SetTransports",e),i=()=>(0,l.zG)("tunnel/GeInterfaces"),c=e=>(0,l.zG)("tunnel/SetInterface",e)},920:function(e,t,a){a.d(t,{BJ:function(){return i},NS:function(){return r},UB:function(){return m},Vk:function(){return d},aP:function(){return h},ir:function(){return u},lJ:function(){return o},mK:function(){return n},y2:function(){return c},yN:function(){return s}});var l=a(4);const n=(e="0")=>(0,l.zG)("updaterclient/get",e),o=e=>(0,l.zG)("updaterclient/confirm",e),r=e=>(0,l.zG)("updaterclient/exit",e),s=()=>(0,l.zG)("updaterclient/GetSecretKey"),u=e=>(0,l.zG)("updaterclient/SetSecretKey",e),d=()=>(0,l.zG)("updaterclient/getcurrent"),i=()=>(0,l.zG)("updaterclient/getserver"),c=e=>(0,l.zG)("updaterclient/confirmserver",e),h=()=>(0,l.zG)("updaterclient/exitserver"),m=()=>(0,l.zG)("updaterclient/Subscribe")},5962:function(e,t,a){a.d(t,{Y:function(){return s},q:function(){return u}});var l=a(8835),n=a(144),o=a(6768);const r=Symbol(),s=()=>{const e=(0,n.KR)({list:{},timer:0,hashcode:0});(0,o.Gt)(r,e);const t=()=>{(0,l.QI)(e.value.hashcode.toString()).then((a=>{e.value.hashcode=a.HashCode,a.List&&(e.value.list=a.List),e.value.timer=setTimeout(t,1e3)})).catch((()=>{e.value.timer=setTimeout(t,1e3)}))},a=()=>{clearTimeout(e.value.timer)};return{access:e,_getAccessInfo:t,clearAccessTimeout:a}},u=()=>(0,o.WQ)(r)},9383:function(e,t,a){a.d(t,{T:function(){return d},d:function(){return u}});var l=a(920),n=a(3830),o=a(144),r=a(6768);const s=Symbol(),u=()=>{const e=(0,n.B)(),t=(0,o.KR)({timer:0,list:{},hashcode:0,current:{Version:"",Msg:[],DateTime:"",Status:0,Length:0,Current:0},subscribeTimer:0});(0,r.Gt)(s,t);const a=()=>{(0,l.mK)(t.value.hashcode.toString()).then((l=>{if(t.value.hashcode=l.HashCode,l.List){const a=Object.values(l.List).filter((e=>!!e.Version))[0];a&&(Object.assign(t.value.current,{DateTime:a.DateTime,Version:a.Version,Status:a.Status,Length:a.Length,Current:a.Current,Msg:a.Msg}),e.value.updater=t.value.current),t.value.list=l.List}t.value.timer=setTimeout(a,800)})).catch((()=>{t.value.timer=setTimeout(a,800)}))},u=()=>{(0,l.UB)().then((()=>{t.value.subscribeTimer=setTimeout(u,5e3)})).catch((()=>{t.value.subscribeTimer=setTimeout(u,5e3)}))},d=()=>{clearTimeout(t.value.timer),clearTimeout(t.value.subscribeTimer)};return{updater:t,_getUpdater:a,_subscribeUpdater:u,clearUpdaterTimeout:d}},d=()=>(0,r.WQ)(s)},6611:function(e,t,a){a.d(t,{A:function(){return c}});var l=a(6768);function n(e,t,a,n,o,r){const s=(0,l.g2)("el-checkbox"),u=(0,l.g2)("el-col"),d=(0,l.g2)("el-row"),i=(0,l.g2)("el-checkbox-group");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(u,{span:8},{default:(0,l.k6)((()=>[(0,l.bF)(s,{modelValue:n.state.checkAll,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.checkAll=e),onChange:n.handleCheckAllChange,label:"全选",indeterminate:n.state.isIndeterminate},null,8,["modelValue","onChange","indeterminate"])])),_:1})])),_:1}),(0,l.bF)(i,{modelValue:n.state.checkList,"onUpdate:modelValue":t[1]||(t[1]=e=>n.state.checkList=e),onChange:n.handleCheckedChange},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.access,((e,t)=>((0,l.uX)(),(0,l.Wv)(u,{key:t,span:8},{default:(0,l.k6)((()=>[(0,l.bF)(s,{value:e.Value,label:e.Text},null,8,["value","label"])])),_:2},1024)))),128))])),_:1})])),_:1},8,["modelValue","onChange"])],64)}a(4114);var o=a(144),r=a(3830),s=a(5962),u={props:["machineid"],setup(e){const t=(0,r.B)(),a=(0,s.q)(),n=(0,l.EW)((()=>{const e=t.value.config.Client.Accesss;return Object.keys(e).reduce(((a,l,n)=>{if(t.value.hasAccess(l)){const t=e[l];t.Key=l,a.push(t)}return a}),[])})),u=(0,o.Kh)({checkList:[t.value.config.Client.Accesss.Api.Value,t.value.config.Client.Accesss.Web.Value,t.value.config.Client.Accesss.NetManager.Value,t.value.config.Client.Accesss.FullManager.Value,t.value.config.Client.Accesss.Transport.Value,t.value.config.Client.Accesss.Action.Value],checkAll:!1,isIndeterminate:!1}),d=()=>u.checkList.reduce(((e,t)=>(e|t)>>>0),0),i=e=>{const t=e.length;u.checkAll=t===n.value.length,u.isIndeterminate=t>0&&t<n.value.length},c=e=>{u.checkAll=e,u.checkList=e?n.value.map((e=>e.Value)):[],u.isIndeterminate=!1};return(0,l.sV)((()=>{if(a&&a.value.list[e.machineid]){const t=a.value.list[e.machineid];u.checkList=n.value.reduce(((e,a)=>((t&a.Value)>>>0==a.Value&&e.push(a.Value),e)),[])}i(u.checkList)})),{state:u,access:n,getValue:d,handleCheckAllChange:c,handleCheckedChange:i}}},d=a(1241);const i=(0,d.A)(u,[["render",n],["__scopeId","data-v-bdd023b0"]]);var c=i},8976:function(e,t,a){a.r(t),a.d(t,{default:function(){return ia}});var l=a(6768);const n={class:"home-list-wrap absolute"},o={class:"page t-c"},r={class:"page-wrap"};function s(e,t,a,s,u,d){const i=(0,l.g2)("el-table-column"),c=(0,l.g2)("el-table"),h=(0,l.g2)("Device"),m=(0,l.g2)("Tunnel"),p=(0,l.g2)("Tuntap"),g=(0,l.g2)("Forward"),v=(0,l.g2)("Oper"),f=(0,l.g2)("el-pagination"),w=(0,l.g2)("DeviceEdit"),k=(0,l.g2)("AccessEdit"),b=(0,l.g2)("TunnelEdit"),F=(0,l.g2)("ConnectionsEdit"),C=(0,l.g2)("TuntapEdit"),T=(0,l.g2)("ForwardEdit"),L=(0,l.g2)("ForwardCopy"),V=(0,l.g2)("SForwardEdit"),_=(0,l.g2)("SForwardCopy");return(0,l.uX)(),(0,l.CE)("div",n,[(0,l.bF)(c,{border:"",style:{width:"100%"},height:"32px",size:"small",onSortChange:s.handleSortChange,class:"table-sort"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{prop:"MachineId",label:"设备名",width:"120",sortable:"custom"}),(0,l.bF)(i,{prop:"Version",label:"版本",width:"120",sortable:"custom"}),(0,l.bF)(i,{prop:"tunnel",label:"网关",width:"90",sortable:"custom"}),(0,l.bF)(i,{prop:"tuntap",label:"网卡IP",width:"160",sortable:"custom"}),(0,l.bF)(i,{prop:"forward",label:""}),(0,l.bF)(i,{label:"",width:"74",fixed:"right"})])),_:1},8,["onSortChange"]),(0,l.bF)(c,{data:s.devices.page.List,stripe:"",border:"",style:{width:"100%"},height:`${s.state.height}px`,size:"small"},{default:(0,l.k6)((()=>[(0,l.bF)(h,{onEdit:s.handleDeviceEdit,onRefresh:s.handlePageRefresh},null,8,["onEdit","onRefresh"]),(0,l.bF)(m,{onEdit:s.handleTunnelEdit,onRefresh:s.handleTunnelRefresh,onConnections:s.handleTunnelConnections},null,8,["onEdit","onRefresh","onConnections"]),(0,l.bF)(p,{onEdit:s.handleTuntapEdit,onRefresh:s.handleTuntapRefresh},null,8,["onEdit","onRefresh"]),(0,l.bF)(g,{onEdit:s._handleForwardEdit,onSedit:s.handleSForwardEdit},null,8,["onEdit","onSedit"]),(0,l.bF)(v,{onRefresh:s.handlePageRefresh,onAccess:s.handleAccessEdit},null,8,["onRefresh","onAccess"])])),_:1},8,["data","height"]),(0,l.Lk)("div",o,[(0,l.Lk)("div",r,[(0,l.bF)(f,{small:"",background:"",layout:"total,sizes,prev,pager, next",total:s.devices.page.Count,"page-size":s.devices.page.Request.Size,"current-page":s.devices.page.Request.Page,onCurrentChange:s.handlePageChange,onSizeChange:s.handlePageSizeChange,"page-sizes":[10,20,50,100,255]},null,8,["total","page-size","current-page","onCurrentChange","onSizeChange"])])]),s.devices.showDeviceEdit?((0,l.uX)(),(0,l.Wv)(w,{key:0,modelValue:s.devices.showDeviceEdit,"onUpdate:modelValue":t[0]||(t[0]=e=>s.devices.showDeviceEdit=e),onChange:s.handlePageChange,data:s.devices.deviceInfo},null,8,["modelValue","onChange","data"])):(0,l.Q3)("",!0),s.devices.showAccessEdit?((0,l.uX)(),(0,l.Wv)(k,{key:1,modelValue:s.devices.showAccessEdit,"onUpdate:modelValue":t[1]||(t[1]=e=>s.devices.showAccessEdit=e),onChange:s.handlePageChange,data:s.devices.deviceInfo},null,8,["modelValue","onChange","data"])):(0,l.Q3)("",!0),s.tunnel.showEdit?((0,l.uX)(),(0,l.Wv)(b,{key:2,modelValue:s.tunnel.showEdit,"onUpdate:modelValue":t[2]||(t[2]=e=>s.tunnel.showEdit=e),onChange:s.handleTunnelRefresh},null,8,["modelValue","onChange"])):(0,l.Q3)("",!0),s.connections.showEdit?((0,l.uX)(),(0,l.Wv)(F,{key:3,modelValue:s.connections.showEdit,"onUpdate:modelValue":t[3]||(t[3]=e=>s.connections.showEdit=e)},null,8,["modelValue"])):(0,l.Q3)("",!0),s.tuntap.showEdit?((0,l.uX)(),(0,l.Wv)(C,{key:4,modelValue:s.tuntap.showEdit,"onUpdate:modelValue":t[4]||(t[4]=e=>s.tuntap.showEdit=e),onChange:s.handleTuntapRefresh},null,8,["modelValue","onChange"])):(0,l.Q3)("",!0),s.forward.showEdit?((0,l.uX)(),(0,l.Wv)(T,{key:5,modelValue:s.forward.showEdit,"onUpdate:modelValue":t[5]||(t[5]=e=>s.forward.showEdit=e)},null,8,["modelValue"])):(0,l.Q3)("",!0),s.forward.showCopy?((0,l.uX)(),(0,l.Wv)(L,{key:6,modelValue:s.forward.showCopy,"onUpdate:modelValue":t[6]||(t[6]=e=>s.forward.showCopy=e)},null,8,["modelValue"])):(0,l.Q3)("",!0),s.sforward.showEdit?((0,l.uX)(),(0,l.Wv)(V,{key:7,modelValue:s.sforward.showEdit,"onUpdate:modelValue":t[7]||(t[7]=e=>s.sforward.showEdit=e)},null,8,["modelValue"])):(0,l.Q3)("",!0),s.sforward.showCopy?((0,l.uX)(),(0,l.Wv)(_,{key:8,modelValue:s.sforward.showCopy,"onUpdate:modelValue":t[8]||(t[8]=e=>s.sforward.showCopy=e)},null,8,["modelValue"])):(0,l.Q3)("",!0)])}a(4114);var u=a(3830),d=a(144);const i=e=>((0,l.Qi)("data-v-1e7a30d3"),e=e(),(0,l.jt)(),e),c={class:"dropdown"},h=i((()=>(0,l.Lk)("span",null,"操作",-1)));function m(e,t,a,n,o,r){const s=(0,l.g2)("ArrowDown"),u=(0,l.g2)("el-icon"),d=(0,l.g2)("SwitchButton"),i=(0,l.g2)("el-dropdown-item"),m=(0,l.g2)("Delete"),p=(0,l.g2)("Flag"),g=(0,l.g2)("el-dropdown-menu"),v=(0,l.g2)("el-dropdown"),f=(0,l.g2)("el-table-column");return(0,l.uX)(),(0,l.Wv)(f,{label:"操作",width:"74",fixed:"right"},{default:(0,l.k6)((e=>[(0,l.bF)(v,{size:"small"},{dropdown:(0,l.k6)((()=>[(0,l.bF)(g,null,{default:(0,l.k6)((()=>[e.row.showReboot&&n.hasReboot?((0,l.uX)(),(0,l.Wv)(i,{key:0,onClick:t=>n.handleExit(e.row.MachineId,e.row.MachineName)},{default:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(d)])),_:1}),(0,l.eW)(" 重启")])),_:2},1032,["onClick"])):(0,l.Q3)("",!0),e.row.showDel&&n.hasRemove?((0,l.uX)(),(0,l.Wv)(i,{key:1,onClick:t=>n.handleDel(e.row.MachineId,e.row.MachineName)},{default:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(m)])),_:1}),(0,l.eW)(" 删除")])),_:2},1032,["onClick"])):(0,l.Q3)("",!0),n.handleShowAccess(e.row,n.accessList[e.row.MachineId]||0)?((0,l.uX)(),(0,l.Wv)(i,{key:2,onClick:t=>n.handleAccess(e.row)},{default:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(p)])),_:1}),(0,l.eW)(" 权限")])),_:2},1032,["onClick"])):(0,l.Q3)("",!0)])),_:2},1024)])),default:(0,l.k6)((()=>[(0,l.Lk)("div",c,[h,(0,l.bF)(u,{class:"el-icon--right"},{default:(0,l.k6)((()=>[(0,l.bF)(s)])),_:1})])])),_:2},1024)])),_:1})}var p=a(9299),g=a(920),v=a(7477),f=a(2933),w=a(5962),k={emits:["refresh","access"],components:{Delete:v.epd,SwitchButton:v.L$q,ArrowDown:v.yd$,Flag:v.lNU},setup(e,{emit:t}){const a=(0,u.B)(),n=(0,w.q)(),o=(0,l.EW)((()=>a.value.config.Client.Access)),r=(0,l.EW)((()=>a.value.hasAccess("Access"))),s=(0,l.EW)((()=>n.value.list)),d=(0,l.EW)((()=>a.value.hasAccess("Reboot"))),i=(0,l.EW)((()=>a.value.hasAccess("Remove"))),c=(e,a)=>{f.s.confirm(`确认删除[${a}]?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,p.Se)(e).then((()=>{t("refresh")}))})).catch((()=>{}))},h=(e,a)=>{f.s.confirm(`确认关闭[${a}]?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,g.NS)(e).then((()=>{t("refresh")}))})).catch((()=>{}))},m=(e,t)=>e.showAccess&&r.value&&t>=0&&(~o.value&t)>>>0==0,v=e=>{t("access",e)};return{accessList:s,handleDel:c,handleExit:h,hasReboot:d,hasRemove:i,hasAccess:r,handleShowAccess:m,handleAccess:v}}},b=a(1241);const F=(0,b.A)(k,[["render",m],["__scopeId","data-v-1e7a30d3"]]);var C=F,T=a(4232);const L=e=>((0,l.Qi)("data-v-358fba0e"),e=e(),(0,l.jt)(),e),V={class:"flex"},_=L((()=>(0,l.Lk)("span",{class:"flex-1"},"设备",-1))),E={class:"flex"},y=["onClick"],I=["onClick"],S=L((()=>(0,l.Lk)("span",null,"😴㊙.㊙.㊙.㊙",-1))),P=[S],M=L((()=>(0,l.Lk)("span",{class:"flex-1"},null,-1)));function R(e,t,a,n,o,r){const s=(0,l.g2)("el-input"),u=(0,l.g2)("Search"),d=(0,l.g2)("el-icon"),i=(0,l.g2)("el-button"),c=(0,l.g2)("DeviceName"),h=(0,l.g2)("UpdaterBtn"),m=(0,l.g2)("el-table-column");return(0,l.uX)(),(0,l.Wv)(m,{prop:"MachineId",label:"设备",width:"240"},{header:(0,l.k6)((()=>[(0,l.Lk)("div",V,[_,(0,l.Lk)("span",null,[(0,l.bF)(s,{size:"small",modelValue:n.name,"onUpdate:modelValue":t[0]||(t[0]=e=>n.name=e),clearable:"",onInput:n.handleRefresh,placeholder:"设备/虚拟网卡/端口转发"},null,8,["modelValue","onInput"])]),(0,l.Lk)("span",null,[(0,l.bF)(i,{size:"small",onClick:n.handleRefresh},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(u)])),_:1})])),_:1},8,["onClick"])])])])),default:(0,l.k6)((e=>[(0,l.Lk)("div",null,[(0,l.Lk)("p",null,[(0,l.bF)(c,{onEdit:n.handleEdit,config:!0,item:e.row},null,8,["onEdit","item"])]),(0,l.Lk)("p",E,[e.row.showip?((0,l.uX)(),(0,l.CE)("span",{key:0,title:"此设备的外网IP",class:"ipaddress",onClick:t=>n.handleExternal(e.row)},[(0,l.Lk)("span",null,"😀"+(0,T.v_)(e.row.IP),1)],8,y)):((0,l.uX)(),(0,l.CE)("span",{key:1,title:"此设备的外网IP",class:"ipaddress",onClick:t=>n.handleExternal(e.row)},P,8,I)),M,(0,l.bF)(h,{config:!0,item:e.row},null,8,["item"])])])])),_:1})}var W=a(2126),A=a(886),B={emits:["edit","refresh"],components:{Search:v.vji,UpdaterBtn:W.A,DeviceName:A.A},setup(e,{emit:t}){const a=(0,u.B)(),n=(0,l.EW)((()=>a.value.hasAccess("ExternalShow"))),o=(0,d.KR)(sessionStorage.getItem("search-name")||""),r=e=>{n.value&&(e.showip=!e.showip)},s=e=>{t("edit",e)},i=()=>{sessionStorage.setItem("search-name",o.value),t("refresh",o.value)};return{handleEdit:s,handleRefresh:i,name:o,handleExternal:r}}};const z=(0,b.A)(B,[["render",R],["__scopeId","data-v-358fba0e"]]);var N=z;const U=(0,l.Lk)("div",null,"修改后最好能重启一次客户端",-1),X={class:"t-c w-100"};function x(e,t,a,n,o,r){const s=(0,l.g2)("el-form-item"),u=(0,l.g2)("el-input"),d=(0,l.g2)("el-button"),i=(0,l.g2)("el-form"),c=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(c,{modelValue:n.state.show,"onUpdate:modelValue":t[2]||(t[2]=e=>n.state.show=e),"close-on-click-modal":!1,"append-to":".app-wrap",title:`设置[${n.state.ruleForm.MachineName}]设备`,width:"300"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(i,{ref:"ruleFormRef",model:n.state.ruleForm,rules:n.state.rules,"label-width":"auto"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{label:""},{default:(0,l.k6)((()=>[U])),_:1}),(0,l.bF)(s,{label:"设备名",prop:"MachineName"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{maxlength:"12","show-word-limit":"",modelValue:n.state.ruleForm.MachineName,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.ruleForm.MachineName=e)},null,8,["modelValue"])])),_:1}),(0,l.bF)(s,{label:"",prop:"Btns"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",X,[(0,l.bF)(d,{onClick:t[1]||(t[1]=e=>n.state.show=!1)},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1}),(0,l.bF)(d,{type:"primary",onClick:n.handleSave},{default:(0,l.k6)((()=>[(0,l.eW)("确认")])),_:1},8,["onClick"])])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])}var D=a(1219),K={props:["data","modelValue"],emits:["change","update:modelValue"],setup(e,{emit:t}){const a=(0,d.KR)(null),n=(0,d.Kh)({show:!0,ruleForm:{MachineName1:e.data.MachineName,MachineName:e.data.MachineName},rules:{}});(0,l.wB)((()=>n.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const o=()=>{e.data.MachineName!=n.ruleForm.MachineName&&(0,p.gC)({Id:e.data.MachineId,newName:n.ruleForm.MachineName}).then((()=>{n.show=!1,D.nk.success("已操作！"),t("change")})).catch((()=>{D.nk.error("操作失败！")}))};return{state:n,ruleFormRef:a,handleSave:o}}};const G=(0,b.A)(K,[["render",x]]);var O=G;function $(e,t,a,n,o,r){const s=(0,l.g2)("Access"),u=(0,l.g2)("el-button"),d=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(d,{modelValue:n.state.show,"onUpdate:modelValue":t[1]||(t[1]=e=>n.state.show=e),"close-on-click-modal":!1,center:"","append-to":".app-wrap",title:`设置[${n.machineName}]的权限`,width:"580",top:"1vh"},{footer:(0,l.k6)((()=>[(0,l.bF)(u,{plain:"",onClick:t[0]||(t[0]=e=>n.state.show=!1),loading:n.state.loading},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1},8,["loading"]),(0,l.bF)(u,{type:"success",plain:"",onClick:n.handleSave,loading:n.state.loading},{default:(0,l.k6)((()=>[(0,l.eW)("确定保存")])),_:1},8,["onClick","loading"])])),default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(s,{machineid:n.machineid,ref:"accessDom"},null,8,["machineid"])])])),_:1},8,["modelValue","title"])}var Q=a(8835),q=a(6611),j={props:["data","modelValue"],emits:["change","update:modelValue"],components:{Access:q.A},setup(e,{emit:t}){const a=(0,d.Kh)({show:!0,loading:!1});(0,l.wB)((()=>a.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const n=(0,d.KR)(null),o=()=>{a.loading=!0,(0,Q.ZK)({ToMachineId:e.data.MachineId,Access:n.value.getValue()}).then((()=>{a.loading=!1,a.show=!1,D.nk.success("已操作！"),t("change")})).catch((()=>{a.loading=!1,D.nk.error("操作失败！")}))};return{machineName:e.data.MachineName,machineid:e.data.MachineId,state:a,accessDom:n,handleSave:o}}};const H=(0,b.A)(j,[["render",$]]);var J=H;const Y={key:0};function Z(e,t,a,n,o,r){const s=(0,l.g2)("TuntapShow"),u=(0,l.g2)("el-table-column");return(0,l.uX)(),(0,l.Wv)(u,{prop:"tuntap",label:"虚拟网卡",width:"160"},{default:(0,l.k6)((e=>[n.tuntap.list[e.row.MachineId]?((0,l.uX)(),(0,l.CE)("div",Y,[(0,l.bF)(s,{config:!0,item:e.row,onEdit:n.handleTuntapIP,onRefresh:n.handleTuntapRefresh},null,8,["item","onEdit","onRefresh"])])):(0,l.Q3)("",!0)])),_:1})}var ee=a(8104),te=a(1198),ae={emits:["edit","refresh"],components:{TuntapShow:te.A},setup(e,{emit:t}){const a=(0,ee.W)(),l=e=>{t("edit",e)},n=()=>{t("refresh")};return{tuntap:a,handleTuntapIP:l,handleTuntapRefresh:n}}};const le=(0,b.A)(ae,[["render",Z]]);var ne=le;const oe=e=>((0,l.Qi)("data-v-7c827302"),e=e(),(0,l.jt)(),e),re=oe((()=>(0,l.Lk)("span",null,"/",-1))),se=oe((()=>(0,l.Lk)("span",{style:{width:"2rem"}},null,-1))),ue={key:0,class:"upgrade-wrap"},de=oe((()=>(0,l.Lk)("span",{class:"yellow"},"此设备能使用NAT转发，只需局域网IP，剩下的交给NAT(linux、macos、win10+)",-1))),ie={class:"flex-1"},ce=oe((()=>(0,l.Lk)("span",null,"/",-1))),he={class:"pdl-10"},me=oe((()=>(0,l.Lk)("span",{class:"yellow"},"此设备无法使用NAT转发，或只想使用端口转发",-1))),pe={class:"flex-1"},ge={class:"pdl-10"};function ve(e,t,a,n,o,r){const s=(0,l.g2)("el-form-item"),u=(0,l.g2)("el-input"),d=(0,l.g2)("el-checkbox"),i=(0,l.g2)("Delete"),c=(0,l.g2)("el-icon"),h=(0,l.g2)("el-button"),m=(0,l.g2)("Plus"),p=(0,l.g2)("el-form"),g=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(g,{modelValue:n.state.show,"onUpdate:modelValue":t[6]||(t[6]=e=>n.state.show=e),"close-on-click-modal":!1,"append-to":".app-wrap",title:`设置[${n.state.machineName}]组网`,top:"1vh",width:"700"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(p,{ref:"ruleFormRef",model:n.state.ruleForm,rules:n.state.rules,"label-width":"140"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{prop:"gateway",style:{"margin-bottom":"0"}},{default:(0,l.k6)((()=>[(0,l.eW)(" 赐予此设备IP，其它设备可通过此IP访问 ")])),_:1}),(0,l.bF)(s,{label:"此设备的虚拟网卡IP",prop:"IP"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:n.state.ruleForm.IP,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.ruleForm.IP=e),style:{width:"14rem"}},null,8,["modelValue"]),re,(0,l.bF)(u,{onChange:n.handlePrefixLengthChange,modelValue:n.state.ruleForm.PrefixLength,"onUpdate:modelValue":t[1]||(t[1]=e=>n.state.ruleForm.PrefixLength=e),style:{width:"4rem"}},null,8,["onChange","modelValue"]),se,(0,l.bF)(d,{modelValue:n.state.ruleForm.ShowDelay,"onUpdate:modelValue":t[2]||(t[2]=e=>n.state.ruleForm.ShowDelay=e),label:"显示延迟",size:"large"},null,8,["modelValue"]),(0,l.bF)(d,{modelValue:n.state.ruleForm.AutoConnect,"onUpdate:modelValue":t[3]||(t[3]=e=>n.state.ruleForm.AutoConnect=e),label:"自动连接",size:"large"},null,8,["modelValue"])])),_:1}),(0,l.bF)(s,{prop:"upgrade",style:{"margin-bottom":"0"}},{default:(0,l.k6)((()=>[(0,l.bF)(d,{modelValue:n.state.ruleForm.Upgrade,"onUpdate:modelValue":t[4]||(t[4]=e=>n.state.ruleForm.Upgrade=e),label:"我很懂，我要使用高级功能(点对网和网对网)",size:"large"},null,8,["modelValue"])])),_:1}),n.state.ruleForm.Upgrade?((0,l.uX)(),(0,l.CE)("div",ue,[(0,l.bF)(s,{prop:"nat",style:{"margin-bottom":"0"}},{default:(0,l.k6)((()=>[de])),_:1}),(0,l.bF)(s,{label:"此设备局域网IP",prop:"LanIP",style:{"border-bottom":"1px solid #ddd","margin-bottom":"0"}},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.ruleForm.LanIPs,((e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:t,class:"flex",style:{"margin-bottom":".6rem"}},[(0,l.Lk)("div",ie,[(0,l.bF)(u,{modelValue:n.state.ruleForm.LanIPs[t],"onUpdate:modelValue":e=>n.state.ruleForm.LanIPs[t]=e,style:{width:"14rem"}},null,8,["modelValue","onUpdate:modelValue"]),ce,(0,l.bF)(u,{onChange:e=>n.handleMaskChange(t),modelValue:n.state.ruleForm.Masks[t],"onUpdate:modelValue":e=>n.state.ruleForm.Masks[t]=e,style:{width:"4rem"}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),(0,l.Lk)("div",he,[(0,l.bF)(h,{type:"danger",onClick:e=>n.handleDel(t)},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.bF)(i)])),_:1})])),_:2},1032,["onClick"]),(0,l.bF)(h,{type:"primary",onClick:e=>n.handleAdd(t)},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.bF)(m)])),_:1})])),_:2},1032,["onClick"])])])))),128))])),_:1}),(0,l.bF)(s,{prop:"forward",style:{"margin-bottom":"0"}},{default:(0,l.k6)((()=>[me])),_:1}),(0,l.bF)(s,{label:"端口转发",prop:"forwards"},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.ruleForm.Forwards,((e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:t,class:"flex",style:{"margin-bottom":".6rem"}},[(0,l.Lk)("div",pe,[(0,l.bF)(u,{modelValue:e.ListenAddr,"onUpdate:modelValue":t=>e.ListenAddr=t,style:{width:"7rem"},readonly:""},null,8,["modelValue","onUpdate:modelValue"]),(0,l.eW)(" : "),(0,l.bF)(u,{onChange:e=>n.handleForwardChange(t),modelValue:e.ListenPort,"onUpdate:modelValue":t=>e.ListenPort=t,style:{width:"6rem"}},null,8,["onChange","modelValue","onUpdate:modelValue"]),(0,l.eW)(" -> "),(0,l.bF)(u,{modelValue:e.ConnectAddr,"onUpdate:modelValue":t=>e.ConnectAddr=t,style:{width:"14rem"}},null,8,["modelValue","onUpdate:modelValue"]),(0,l.eW)(" : "),(0,l.bF)(u,{onChange:e=>n.handleForwardChange(t),modelValue:e.ConnectPort,"onUpdate:modelValue":t=>e.ConnectPort=t,style:{width:"6rem"}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),(0,l.Lk)("div",ge,[(0,l.bF)(h,{type:"danger",onClick:e=>n.handleDelForward(t)},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.bF)(i)])),_:1})])),_:2},1032,["onClick"]),(0,l.bF)(h,{type:"primary",onClick:e=>n.handleAddForward(t)},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.bF)(m)])),_:1})])),_:2},1032,["onClick"])])])))),128))])),_:1})])):(0,l.Q3)("",!0),(0,l.bF)(s,{label:"",prop:"Btns"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(h,{onClick:t[5]||(t[5]=e=>n.state.show=!1)},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1}),(0,l.bF)(h,{type:"primary",onClick:n.handleSave},{default:(0,l.k6)((()=>[(0,l.eW)("确认")])),_:1},8,["onClick"])])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])}var fe=a(5241),we={props:["modelValue"],emits:["change","update:modelValue"],components:{Delete:v.epd,Plus:v.FWt},setup(e,{emit:t}){const a=(0,u.B)(),n=(0,ee.W)(),o=(0,d.KR)(null),r=(0,d.Kh)({show:!0,machineName:n.value.current.device.MachineName,bufferSize:a.value.bufferSize,ruleForm:{IP:n.value.current.IP,LanIPs:n.value.current.LanIPs.slice(0),Masks:n.value.current.Masks.slice(0),PrefixLength:n.value.current.PrefixLength||24,Gateway:n.value.current.Gateway,ShowDelay:n.value.current.ShowDelay,AutoConnect:n.value.current.AutoConnect,Upgrade:n.value.current.Upgrade,Multicast:n.value.current.Multicast,Forwards:0==n.value.current.Forwards.length?[{ListenAddr:"0.0.0.0",ListenPort:0,ConnectAddr:"0.0.0.0",ConnectPort:0}]:n.value.current.Forwards.slice(0)},rules:{}});0==r.ruleForm.LanIPs.length&&(r.ruleForm.LanIPs.push(""),r.ruleForm.Masks.push(24)),(0,l.wB)((()=>r.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const s=()=>{var e=+r.ruleForm.PrefixLength;(e>32||e<16||isNaN(e))&&(e=24),r.ruleForm.PrefixLength=e},i=e=>{var t=+r.ruleForm.Masks[e];(t>32||t<16||isNaN(t))&&(t=24),r.ruleForm.Masks[e]=t},c=e=>{r.ruleForm.LanIPs.splice(e,1),r.ruleForm.Masks.splice(e,1),0==r.ruleForm.LanIPs.length&&h(0)},h=e=>{r.ruleForm.LanIPs.splice(e+1,0,""),r.ruleForm.Masks.splice(e+1,0,24)},m=()=>{const e=JSON.parse(JSON.stringify(n.value.current));e.IP=r.ruleForm.IP||"0.0.0.0";const{lanips:a,masks:l}=r.ruleForm.LanIPs.reduce(((e,t,a)=>(t&&r.ruleForm.Masks[a]&&(e.lanips.push(t),e.masks.push(r.ruleForm.Masks[a])),e)),{lanips:[],masks:[]});e.LanIPs=a,e.Masks=l,e.PrefixLength=+r.ruleForm.PrefixLength,e.Gateway=r.ruleForm.Gateway,e.ShowDelay=r.ruleForm.ShowDelay,e.AutoConnect=r.ruleForm.AutoConnect,e.Upgrade=r.ruleForm.Upgrade,e.Multicast=r.ruleForm.Multicast,e.Forwards=r.ruleForm.Forwards,e.Forwards.forEach((e=>{e.ListenPort=+e.ListenPort,e.ConnectPort=+e.ConnectPort})),(0,fe.ac)(e).then((()=>{r.show=!1,D.nk.success("已操作！"),t("change")})).catch((()=>{D.nk.error("操作失败！")}))},p=e=>{r.ruleForm.Forwards.splice(e,1),0==r.ruleForm.Forwards.length&&g(0)},g=e=>{r.ruleForm.Forwards.splice(e+1,0,{ListenAddr:"0.0.0.0",ListenPort:0,ConnectAddr:"0.0.0.0",ConnectPort:0})},v=()=>{};return{state:r,ruleFormRef:o,handlePrefixLengthChange:s,handleMaskChange:i,handleDel:c,handleAdd:h,handleSave:m,handleForwardChange:v,handleDelForward:p,handleAddForward:g}}};const ke=(0,b.A)(we,[["render",ve],["__scopeId","data-v-7c827302"]]);var be=ke;const Fe={key:0},Ce=["title","onClick"],Te=["onClick"];function Le(e,t,a,n,o,r){const s=(0,l.g2)("el-table-column");return(0,l.uX)(),(0,l.Wv)(s,{prop:"tunnel",label:"隧道",width:"90"},{default:(0,l.k6)((e=>[n.tunnel.list[e.row.MachineId]?((0,l.uX)(),(0,l.CE)("div",Fe,[(0,l.Lk)("a",{href:"javascript:;",class:(0,T.C4)(["a-line",{yellow:n.tunnel.list[e.row.MachineId].NeedReboot}]),title:n.tunnel.list[e.row.MachineId].NeedReboot?"需要重启":"调整网关层级有助于打洞成功",onClick:t=>n.handleTunnel(n.tunnel.list[e.row.MachineId],e.row)},[(0,l.Lk)("span",null,"网关 : "+(0,T.v_)(n.tunnel.list[e.row.MachineId].RouteLevel)+" + "+(0,T.v_)(n.tunnel.list[e.row.MachineId].RouteLevelPlus),1)],10,Ce)])):(0,l.Q3)("",!0),(0,l.Lk)("div",null,[(0,l.Lk)("a",{href:"javascript:;",title:"与此设备的隧道连接",class:(0,T.C4)(["a-line",{green:n.connectionCount(e.row.MachineId)>0}]),onClick:t=>n.handleConnections(e.row)},[(0,l.eW)(" 连接数 : "),(0,l.Lk)("span",null,(0,T.v_)(n.connectionCount(e.row.MachineId)),1)],10,Te)])])),_:1})}var Ve=a(83);const _e=Symbol(),Ee=()=>{(0,u.B)();const e=(0,d.KR)({timer:0,showEdit:!1,current:null,list:{},hashcode:0});(0,l.Gt)(_e,e);const t=()=>{(0,Ve.r7)(e.value.hashcode.toString()).then((a=>{e.value.hashcode=a.HashCode,a.List&&(e.value.list=a.List),e.value.timer=setTimeout(t,1060)})).catch((()=>{e.value.timer=setTimeout(t,1060)}))},a=t=>{e.value.current=t,e.value.showEdit=!0},n=()=>{(0,Ve.gM)(),D.nk.success({message:"刷新成功",grouping:!0})},o=()=>{clearTimeout(e.value.timer)},r=t=>Object.values(e.value.list).sort(((e,t)=>e.RouteLevel+e.RouteLevelPlus-t.RouteLevel+t.RouteLevelPlus)).map((e=>e.MachineId));return{tunnel:e,_getTunnelInfo:t,handleTunnelEdit:a,handleTunnelRefresh:n,clearTunnelTimeout:o,sortTunnel:r}},ye=()=>(0,l.WQ)(_e);var Ie=a(4);const Se=(e="0")=>(0,Ie.zG)("forwardclient/connections",e),Pe=e=>(0,Ie.zG)("forwardclient/removeconnection",e),Me=(e="0")=>(0,Ie.zG)("forwardclient/get",e),Re=e=>(0,Ie.zG)("forwardclient/getremote",e),We=()=>(0,Ie.zG)("forwardclient/bindips"),Ae=e=>(0,Ie.zG)("forwardclient/remove",e),Be=e=>(0,Ie.zG)("forwardclient/add",e),ze=e=>(0,Ie.zG)("forwardclient/TestTarget",e),Ne=Symbol(),Ue=Symbol(),Xe=Symbol(),xe=()=>{const e=(0,d.KR)({showEdit:!1,speedCache:{},current:"",currentName:"",hashcode:0,hashcode1:0,_updateRealTime:!1,updateRealTime:t=>{e.value.hashcode=0,e.value.hashcode1=0,e.value._updateRealTime=t}});(0,l.Gt)(Ne,e);const t=(0,d.KR)({timer:0,list:{}});(0,l.Gt)(Ue,t);const a=()=>{Se(e.value.hashcode.toString()).then((l=>{0==e.value._updateRealTime&&(e.value.hashcode=l.HashCode),l.List&&(r(l.List,Pe),t.value.list=l.List),t.value.timer=setTimeout(a,1e3)})).catch((e=>{t.value.timer=setTimeout(a,1e3)}))},n=(0,d.KR)({timer:0,list:{}});(0,l.Gt)(Xe,n);const o=()=>{(0,fe.kl)(e.value.hashcode1.toString()).then((t=>{0==e.value._updateRealTime&&(e.value.hashcode1=t.HashCode),t.List&&(r(t.List,fe.vB),n.value.list=t.List),n.value.timer=setTimeout(o,1e3)})).catch((e=>{n.value.timer=setTimeout(o,1e3)}))},r=(t,a)=>{const l=e.value.speedCache;for(let e in t){const n=t[e];n.removeFunc=a;const o=`${n.RemoteMachineId}-${n.TransactionId}`,r=l[o]||{SendBytes:0,ReceiveBytes:0};n.SendBytesText=s(n.SendBytes-r.SendBytes),n.ReceiveBytesText=s(n.ReceiveBytes-r.ReceiveBytes),r.SendBytes=n.SendBytes,r.ReceiveBytes=n.ReceiveBytes,l[o]=r}},s=e=>{let t=0;while(e>=1024)e/=1024,t++;return`${e.toFixed(2)}${["B/s","KB/s","MB/s","GB/s","TB/s"][t]}`},u=t=>{e.value.current=t.MachineId,e.value.currentName=t.MachineName,e.value.showEdit=!0},i=()=>{clearTimeout(t.value.timer),clearTimeout(n.value.timer)};return{connections:e,forwardConnections:t,_getForwardConnections:a,tuntapConnections:n,_getTuntapConnections:o,handleTunnelConnections:u,clearConnectionsTimeout:i}},De=()=>(0,l.WQ)(Ne),Ke=()=>(0,l.WQ)(Ue),Ge=()=>(0,l.WQ)(Xe);var Oe={emits:["edit","refresh"],setup(e,{emit:t}){const a=(0,u.B)(),n=(0,l.EW)((()=>a.value.config.Client.Id)),o=(0,l.EW)((()=>a.value.hasAccess("TunnelChangeSelf"))),r=(0,l.EW)((()=>a.value.hasAccess("TunnelChangeOther"))),s=ye(),d=(De(),Ke()),i=Ge(),c=e=>[d.value.list[e],i.value.list[e]].filter((e=>!!e&&e.Connected)).length,h=(e,a)=>{if(n.value===e.MachineId){if(!o.value)return}else if(!r.value)return;e.device=a,t("edit",e)},m=()=>{t("refresh")},p=e=>{t("connections",e)};return{tunnel:s,handleTunnel:h,handleTunnelRefresh:m,connectionCount:c,handleConnections:p}}};const $e=(0,b.A)(Oe,[["render",Le],["__scopeId","data-v-56597dfc"]]);var Qe=$e;const qe=e=>((0,l.Qi)("data-v-1f7f67a4"),e=e(),(0,l.jt)(),e),je=qe((()=>(0,l.Lk)("div",null,"网关层级为你的设备与外网的距离，你可以手动调整数值",-1))),He=qe((()=>(0,l.Lk)("div",null,"光猫映射了端口后，可以直接连接，把TcpPortMap调到第一",-1))),Je={class:"t-c w-100"};function Ye(e,t,a,n,o,r){const s=(0,l.g2)("el-form-item"),u=(0,l.g2)("el-input"),d=(0,l.g2)("el-col"),i=(0,l.g2)("el-input-number"),c=(0,l.g2)("el-row"),h=(0,l.g2)("el-button"),m=(0,l.g2)("el-form"),p=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(p,{modelValue:n.state.show,"onUpdate:modelValue":t[5]||(t[5]=e=>n.state.show=e),"close-on-click-modal":!1,"append-to":".app-wrap",title:`设置[${n.state.machineName}]网关`,width:"400"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(m,{ref:"ruleFormRef",model:n.state.ruleForm,rules:n.state.rules,"label-width":"auto"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{label:"",prop:"alert"},{default:(0,l.k6)((()=>[je])),_:1}),(0,l.bF)(s,{label:""},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.bF)(d,{span:12},{default:(0,l.k6)((()=>[(0,l.bF)(s,{label:"网关层级",prop:"RouteLevel"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{readonly:"",modelValue:n.state.ruleForm.RouteLevel,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.ruleForm.RouteLevel=e)},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.bF)(d,{span:12},{default:(0,l.k6)((()=>[(0,l.bF)(s,{label:"调整层级",prop:"RouteLevelPlus"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:n.state.ruleForm.RouteLevelPlus,"onUpdate:modelValue":t[1]||(t[1]=e=>n.state.ruleForm.RouteLevelPlus=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,l.bF)(s,{label:"",prop:"alert"},{default:(0,l.k6)((()=>[He])),_:1}),(0,l.bF)(s,{label:""},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.bF)(d,{span:12},{default:(0,l.k6)((()=>[(0,l.bF)(s,{label:"外网端口",prop:"PortMapWan"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:n.state.ruleForm.PortMapWan,"onUpdate:modelValue":t[2]||(t[2]=e=>n.state.ruleForm.PortMapWan=e)},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.bF)(d,{span:12},{default:(0,l.k6)((()=>[(0,l.bF)(s,{label:"内网端口",prop:"PortMapLan"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:n.state.ruleForm.PortMapLan,"onUpdate:modelValue":t[3]||(t[3]=e=>n.state.ruleForm.PortMapLan=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,l.bF)(s,{label:"",prop:"Btns"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",Je,[(0,l.bF)(h,{onClick:t[4]||(t[4]=e=>n.state.show=!1)},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1}),(0,l.bF)(h,{type:"primary",onClick:n.handleSave},{default:(0,l.k6)((()=>[(0,l.eW)("确认")])),_:1},8,["onClick"])])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])}var Ze={props:["modelValue"],emits:["change","update:modelValue"],setup(e,{emit:t}){const a=ye(),n=(0,d.KR)(null),o=(0,d.Kh)({show:!0,machineName:a.value.current.device.MachineName,ruleForm:{RouteLevel:a.value.current.RouteLevel,RouteLevelPlus:a.value.current.RouteLevelPlus,PortMapWan:a.value.current.PortMapWan,PortMapLan:a.value.current.PortMapLan},rules:{}});(0,l.wB)((()=>o.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const r=()=>{const e=JSON.parse(JSON.stringify(a.value.current));e.RouteLevel=+o.ruleForm.RouteLevel,e.RouteLevelPlus=+o.ruleForm.RouteLevelPlus,e.PortMapWan=+o.ruleForm.PortMapWan,e.PortMapLan=+o.ruleForm.PortMapLan,(0,Ve.KW)(e).then((()=>{o.show=!1,D.nk.success("已操作！"),t("change")})).catch((()=>{D.nk.error("操作失败！")}))};return{state:o,ruleFormRef:n,handleSave:r}}};const et=(0,b.A)(Ze,[["render",Ye],["__scopeId","data-v-1f7f67a4"]]);var tt=et;const at={key:0},lt={class:"list forward"},nt=["onClick"],ot={key:1},rt=["onClick"],st={key:0},ut={class:"list sforward"},dt={key:1};function it(e,t,a,n,o,r){const s=(0,l.g2)("el-table-column");return(0,l.uX)(),(0,l.Wv)(s,{prop:"forward",label:"端口转发"},{default:(0,l.k6)((e=>[e.row.isSelf?((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[n.hasForwardShowSelf?((0,l.uX)(),(0,l.CE)("div",st,[(0,l.Lk)("ul",ut,[n.sforward.list&&n.sforward.list.length>0?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:0},(0,l.pI)(n.sforward.list.slice(0,5),((e,a)=>((0,l.uX)(),(0,l.CE)("li",{key:a,class:(0,T.C4)({red:!!e.Msg})},[(0,l.Lk)("a",{href:"javascript:;",onClick:t[0]||(t[0]=e=>n.handleSEdit()),class:(0,T.C4)({green:e.Started})},[(0,l.Lk)("span",null,[(0,l.Lk)("span",{class:(0,T.C4)({red:!!e.Msg})},(0,T.v_)(e.Domain||e.RemotePort),3),(0,l.eW)(" -> "),(0,l.Lk)("span",{class:(0,T.C4)({red:!!e.LocalMsg})},(0,T.v_)(e.LocalEP),3)])],2),(0,l.Lk)("span",null," ("+(0,T.v_)(1<<e.BufferSize)+"KB)",1)],2)))),128)):((0,l.uX)(),(0,l.CE)("li",dt,[(0,l.Lk)("a",{href:"javascript:;",title:"管理你的服务器穿透",onClick:t[1]||(t[1]=e=>n.handleSEdit())},"暂无配置")]))])])):(0,l.Q3)("",!0)],64)):((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[n.hasForwardShowOther?((0,l.uX)(),(0,l.CE)("div",at,[(0,l.Lk)("ul",lt,[n.forward.list[e.row.MachineId]&&n.forward.list[e.row.MachineId].length>0?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:0},(0,l.pI)(n.forward.list[e.row.MachineId],((t,a)=>((0,l.uX)(),(0,l.CE)("li",{key:a},[(0,l.Lk)("a",{href:"javascript:;",onClick:t=>n.handleEdit(e.row.MachineId),class:(0,T.C4)({green:t.Started})},[(0,l.Lk)("span",null,[(0,l.Lk)("span",{class:(0,T.C4)({red:!!t.Msg})},(0,T.v_)(t.Port),3),(0,l.eW)(" -> "),(0,l.Lk)("span",{class:(0,T.C4)({red:!!t.TargetMsg})},(0,T.v_)(t.TargetEP),3)])],10,nt),(0,l.Lk)("span",null," ("+(0,T.v_)(1<<t.BufferSize)+"KB)",1)])))),128)):((0,l.uX)(),(0,l.CE)("li",ot,[(0,l.Lk)("a",{href:"javascript:;",title:"管理你的端口转发",onClick:t=>n.handleEdit(e.row.MachineId)},"暂无配置",8,rt)]))])])):(0,l.Q3)("",!0)],64))])),_:1})}const ct=Symbol(),ht=()=>{(0,u.B)();const e=(0,d.KR)({timer:0,showEdit:!1,showCopy:!1,current:null,list:{},testTimer:0,testTargetTimer:0,hashcode:0,hashcode1:0});(0,l.Gt)(ct,e);const t=()=>{Me(e.value.hashcode.toString()).then((a=>{e.value.hashcode=a.HashCode,a.List&&(e.value.list=a.List),e.value.timer=setTimeout(t,1020)})).catch((()=>{e.value.timer=setTimeout(t,1020)}))},a=(t,a)=>{e.value.current=t,e.value.machineName=a,e.value.showEdit=!0},n=()=>{clearTimeout(e.value.testTargetTimer),ze(e.value.current).then((t=>{e.value.testTargetTimer=setTimeout(n,5e3)})).catch((()=>{e.value.testTargetTimer=setTimeout(n,5e3)}))},o=()=>{clearTimeout(e.value.timer),clearTimeout(e.value.testTimer),clearTimeout(e.value.testTargetTimer)},r=t=>Object.values(e.value.list).reduce(((e,t)=>(e=e.concat(t),e)),[]).filter((e=>(e.Name||"").indexOf(t)>=0||(e.BindIPAddress||"").indexOf(t)>=0||e.Port.toString().indexOf(t)>=0||(e.TargetEP||"").indexOf(t)>=0)).map((e=>e.MachineId));return{forward:e,_getForwardInfo:t,handleForwardEdit:a,_testTargetForwardInfo:n,clearForwardTimeout:o,getForwardMachines:r}},mt=()=>(0,l.WQ)(ct);var pt=a(743);const gt=Symbol(),vt=()=>{const e=(0,u.B)(),t=(0,l.EW)((()=>e.value.config.Client.Id)),a=(0,d.KR)({timer:0,showEdit:!1,showCopy:!1,list:[],testTimer:0,hashcode:0});(0,l.Gt)(gt,a);const n=()=>{(0,pt.pY)(a.value.hashcode.toString()).then((e=>{a.value.hashcode=e.HashCode,e.List&&(a.value.list=e.List),a.value.timer=setTimeout(n,1040)})).catch((()=>{a.value.timer=setTimeout(n,1040)}))},o=()=>{a.value.showEdit=!0},r=()=>{clearTimeout(a.value.testTimer),(0,pt.eX)().then((e=>{a.value.testTimer=setTimeout(r,5e3)})).catch((()=>{a.value.testTimer=setTimeout(r,5e3)}))},s=()=>{clearTimeout(a.value.timer),clearTimeout(a.value.testTimer)},i=e=>{const l=a.value.list.filter((t=>(t.Name||"").indexOf(e)>=0||(t.Domain||"").indexOf(e)>=0||t.RemotePort.toString().indexOf(e)>=0||t.LocalEP.indexOf(e)>=0));return l.length>0?[t.value]:[]};return{sforward:a,_getSForwardInfo:n,handleSForwardEdit:o,_testLocalSForwardInfo:r,clearSForwardTimeout:s,getSForwardMachines:i}},ft=()=>(0,l.WQ)(gt);var wt={emits:["edit","sedit"],setup(e,{emit:t}){const a=mt(),n=ft(),o=(0,u.B)(),r=(0,l.EW)((()=>o.value.config.Client.Id)),s=(0,l.EW)((()=>o.value.hasAccess("ForwardShowSelf"))),d=(0,l.EW)((()=>o.value.hasAccess("ForwardShowOther"))),i=(0,l.EW)((()=>o.value.hasAccess("ForwardSelf"))),c=(0,l.EW)((()=>o.value.hasAccess("ForwardOther"))),h=e=>{if(r.value===e){if(!i.value)return}else if(!c.value)return;t("edit",e)},m=()=>{i.value&&t("sedit")},p=()=>{t("refresh")};return{forward:a,sforward:n,hasForwardShowSelf:s,hasForwardShowOther:d,handleEdit:h,handleSEdit:m,handleForwardRefresh:p}}};const kt=(0,b.A)(wt,[["render",it],["__scopeId","data-v-19db1f43"]]);var bt=kt;const Ft={class:"t-c head"},Ct={class:"error red"},Tt={class:"error red"};function Lt(e,t,a,n,o,r){const s=(0,l.g2)("el-button"),u=(0,l.g2)("el-input"),d=(0,l.g2)("el-table-column"),i=(0,l.g2)("el-option"),c=(0,l.g2)("el-select"),h=(0,l.g2)("WarnTriangleFilled"),m=(0,l.g2)("el-icon"),p=(0,l.g2)("el-popover"),g=(0,l.g2)("el-switch"),v=(0,l.g2)("Delete"),f=(0,l.g2)("el-popconfirm"),w=(0,l.g2)("el-table"),k=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(k,{modelValue:n.state.show,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.show=e),onOpen:n.handleOnShowList,"append-to":".app-wrap",title:`端口转发到【${n.state.machineName}】`,top:"1vh",width:"700"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.Lk)("div",Ft,[(0,l.bF)(s,{type:"success",size:"small",onClick:n.handleAdd},{default:(0,l.k6)((()=>[(0,l.eW)("添加")])),_:1},8,["onClick"]),(0,l.bF)(s,{size:"small",onClick:n.handleRefresh},{default:(0,l.k6)((()=>[(0,l.eW)("刷新")])),_:1},8,["onClick"]),(0,l.bF)(s,{size:"small",onClick:n.handleCopy},{default:(0,l.k6)((()=>[(0,l.eW)("复制转发配置")])),_:1},8,["onClick"])]),(0,l.bF)(w,{data:n.state.data,size:"small",border:"",height:"500",onCellDblclick:n.handleCellClick},{default:(0,l.k6)((()=>[(0,l.bF)(d,{property:"Name",label:"名称"},{default:(0,l.k6)((e=>[e.row.NameEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(u,{key:0,autofocus:"",size:"small",modelValue:e.row.Name,"onUpdate:modelValue":t=>e.row.Name=t,onBlur:t=>n.handleEditBlur(e.row,"Name")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.eW)((0,T.v_)(e.row.Name),1)],64))])),_:1}),(0,l.bF)(d,{prop:"BufferSize",label:"缓冲区",width:"100"},{default:(0,l.k6)((e=>[(0,l.bF)(c,{modelValue:e.row.BufferSize,"onUpdate:modelValue":t=>e.row.BufferSize=t,placeholder:"Select",size:"small",disabled:e.row.Started,onChange:t=>n.handleEditBlur(e.row,"BufferSize")},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.bufferSize,((e,t)=>((0,l.uX)(),(0,l.Wv)(i,{key:t,label:e,value:t},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"])])),_:1}),(0,l.bF)(d,{property:"BindIPAddress",label:"监听IP",width:"140"},{default:(0,l.k6)((e=>[(0,l.bF)(c,{modelValue:e.row.BindIPAddress,"onUpdate:modelValue":t=>e.row.BindIPAddress=t,size:"small",disabled:e.row.Started},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.ips,(e=>((0,l.uX)(),(0,l.Wv)(i,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])])),_:1}),(0,l.bF)(d,{property:"Port",label:"监听端口",width:"80"},{default:(0,l.k6)((e=>[e.row.PortEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(u,{key:0,type:"number",autofocus:"",size:"small",modelValue:e.row.Port,"onUpdate:modelValue":t=>e.row.Port=t,onBlur:t=>n.handleEditBlur(e.row,"Port")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[e.row.Msg?((0,l.uX)(),(0,l.Wv)(p,{key:0,placement:"top",title:"提示",width:"20rem",trigger:"hover",content:e.row.Msg},{reference:(0,l.k6)((()=>[(0,l.Lk)("div",Ct,[(0,l.Lk)("span",null,(0,T.v_)(e.row.Port),1),(0,l.bF)(m,{size:"20"},{default:(0,l.k6)((()=>[(0,l.bF)(h)])),_:1})])])),_:2},1032,["content"])):((0,l.uX)(),(0,l.CE)("span",{key:1,class:(0,T.C4)({green:e.row.Started})},(0,T.v_)(e.row.Port),3))],64))])),_:1}),(0,l.bF)(d,{property:"TargetEP",label:"目标服务",width:"140"},{default:(0,l.k6)((e=>[e.row.TargetEPEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(u,{key:0,autofocus:"",size:"small",modelValue:e.row.TargetEP,"onUpdate:modelValue":t=>e.row.TargetEP=t,onBlur:t=>n.handleEditBlur(e.row,"TargetEP")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[e.row.TargetMsg?((0,l.uX)(),(0,l.Wv)(p,{key:0,placement:"top",title:"提示",width:"20rem",trigger:"hover",content:e.row.TargetMsg},{reference:(0,l.k6)((()=>[(0,l.Lk)("span",Tt,(0,T.v_)(e.row.TargetEP),1),(0,l.bF)(m,{size:"20"},{default:(0,l.k6)((()=>[(0,l.bF)(h)])),_:1})])),_:2},1032,["content"])):((0,l.uX)(),(0,l.CE)("span",{key:1,class:(0,T.C4)({green:e.row.Started})},(0,T.v_)(e.row.TargetEP),3))],64))])),_:1}),(0,l.bF)(d,{property:"Started",label:"状态",width:"60"},{default:(0,l.k6)((e=>[(0,l.bF)(g,{modelValue:e.row.Started,"onUpdate:modelValue":t=>e.row.Started=t,onChange:t=>n.handleStartChange(e.row),"inline-prompt":"","active-text":"开","inactive-text":"关"},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,l.bF)(d,{label:"操作",width:"54"},{default:(0,l.k6)((e=>[(0,l.bF)(f,{"confirm-button-text":"确认","cancel-button-text":"取消",title:"删除不可逆，是否确认?",onConfirm:t=>n.handleDel(e.row.Id)},{reference:(0,l.k6)((()=>[(0,l.bF)(s,{type:"danger",size:"small"},{default:(0,l.k6)((()=>[(0,l.bF)(m,null,{default:(0,l.k6)((()=>[(0,l.bF)(v)])),_:1})])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data","onCellDblclick"])])])),_:1},8,["modelValue","onOpen","title"])}var Vt={props:["data","modelValue"],emits:["update:modelValue"],components:{WarnTriangleFilled:v.DtC,Delete:v.epd},setup(e,{emit:t}){const a=(0,u.B)(),n=mt(),o=(0,d.Kh)({show:!0,machineId:n.value.current,machineName:n.value.machineName,data:[],ips:[],timerTestTarget:0,timerTestListen:0,bufferSize:a.value.bufferSize});(0,l.wB)((()=>o.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const r=()=>{We().then((e=>{e.splice(0,0,"127.0.0.1"),e.splice(0,0,"0.0.0.0"),o.ips=e})).catch((()=>{}))},s=()=>{ze(n.value.current).then((e=>{o.timerTestTarget=setTimeout(s,1e3)})).catch((()=>{o.timerTestTarget=setTimeout(s,1e3)}))},i=()=>{Me().then((e=>{e.List&&(o.data=e.List[o.machineId]||[])})).catch((()=>{}))},c=()=>{i()},h=(e,t)=>{g(e,t.property)},m=()=>{i(),D.nk.success("已刷新")},p=()=>{k({ID:0,Name:"",Port:0,TargetEP:"127.0.0.1:80",machineId:o.machineId})},g=(e,t)=>{e.Started?D.nk.error("请先停止"):(o.data.forEach((e=>{e["NameEditing"]=!1,e["PortEditing"]=!1,e["TargetEPEditing"]=!1,e["BindIPAddressEditing"]=!1})),e[`${t}Editing`]=!0)},v=(e,t)=>{e.Started?D.nk.error("请先停止"):(e[`${t}Editing`]=!1,k(e))},f=e=>{Ae(e).then((()=>{i()}))},w=e=>{k(e)},k=e=>{e.Port=parseInt(e.Port),Be(e).then((()=>{i()})).catch((e=>{D.nk.error(e)}))},b=()=>{n.value.showCopy=!0};return(0,l.sV)((()=>{i(),r(),s()})),(0,l.hi)((()=>{clearTimeout(o.timerTestTarget),clearTimeout(o.timerTestListen)})),{state:o,handleOnShowList:c,handleCellClick:h,handleRefresh:m,handleAdd:p,handleEdit:g,handleEditBlur:v,handleDel:f,handleStartChange:w,handleCopy:b}}};const _t=(0,b.A)(Vt,[["render",Lt],["__scopeId","data-v-7b79db4a"]]);var Et=_t;const yt=e=>((0,l.Qi)("data-v-3a13c86f"),e=e(),(0,l.jt)(),e),It={class:"t-c head"},St=yt((()=>(0,l.Lk)("span",null,"复制",-1))),Pt={class:"t-c"},Mt={class:"page-wrap"},Rt={class:"foot t-c"};function Wt(e,t,a,n,o,r){const s=(0,l.g2)("el-pagination"),u=(0,l.g2)("el-option"),d=(0,l.g2)("el-select"),i=(0,l.g2)("el-table-column"),c=(0,l.g2)("el-checkbox"),h=(0,l.g2)("el-table"),m=(0,l.g2)("el-button"),p=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(p,{modelValue:n.state.show,"onUpdate:modelValue":t[1]||(t[1]=e=>n.state.show=e),onOpen:n.handleOnShowList,"append-to":".app-wrap",title:"复制端口转发",top:"1vh",width:"500"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.Lk)("div",It,[St,(0,l.bF)(d,{modelValue:n.state.machineId,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.machineId=e),onChange:n.handleMachineChange,filterable:"",remote:"",loading:n.state.loading,"remote-method":n.handleSearch},{header:(0,l.k6)((()=>[(0,l.Lk)("div",Pt,[(0,l.Lk)("div",Mt,[(0,l.bF)(s,{small:"",background:"",layout:"prev, pager, next","page-size":n.state.machineIds.Request.Size,total:n.state.machineIds.Count,"pager-count":5,"current-page":n.state.machineIds.Request.Page,onCurrentChange:n.handlePageChange},null,8,["page-size","total","current-page","onCurrentChange"])])])])),default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.machineIds.List,((e,t)=>((0,l.uX)(),(0,l.Wv)(u,{key:t,label:e.MachineName,value:e.MachineId},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange","loading","remote-method"]),(0,l.Lk)("span",null,"到【"+(0,T.v_)(n.state.toMachineName)+"】的端口转发记录",1)]),(0,l.bF)(h,{data:n.state.forwards,size:"small",border:""},{default:(0,l.k6)((()=>[(0,l.bF)(i,{property:"Name",label:"名称"}),(0,l.bF)(i,{prop:"BufferSize",label:"缓冲区",width:"60"},{default:(0,l.k6)((e=>[(0,l.eW)((0,T.v_)(1<<e.row.BufferSize)+"KB ",1)])),_:1}),(0,l.bF)(i,{property:"Port",label:"监听端口",width:"80"}),(0,l.bF)(i,{property:"TargetEP",label:"目标服务",width:"140"}),(0,l.bF)(i,{label:"操作",width:"80"},{default:(0,l.k6)((e=>[(0,l.bF)(c,{modelValue:e.row.use,"onUpdate:modelValue":t=>e.row.use=t},{default:(0,l.k6)((()=>[(0,l.eW)("使用")])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"]),(0,l.Lk)("div",Rt,[(0,l.bF)(m,{type:"primary",onClick:n.handleConfirm},{default:(0,l.k6)((()=>[(0,l.eW)("确定复制")])),_:1},8,["onClick"])])])])),_:1},8,["modelValue","onOpen"])}var At={props:["modelValue"],emits:["update:modelValue"],components:{WarnTriangleFilled:v.DtC},setup(e,{emit:t}){(0,u.B)();const a=mt(),n=(0,d.Kh)({show:!0,loading:!1,machineId:"",toMachineId:a.value.current,toMachineName:a.value.machineName,machineIds:{Request:{Page:1,Size:10,Name:""},Count:0,List:[]},forwards:[]});(0,l.wB)((()=>n.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const o=()=>{r()},r=()=>{n.loading=!0,(0,p.BS)(n.machineIds.Request).then((e=>{n.loading=!1,n.machineIds.Request=e.Request,n.machineIds.Count=e.Count,n.machineIds.List=e.List,!n.machineId&&n.machineIds.List.length>0&&(n.machineId=n.machineIds.List[0].MachineId,c())})).catch((e=>{n.loading=!1}))},s=e=>{n.machineIds.Request.Page=e,r()},i=e=>{n.machineIds.Request.Name=e,r()},c=()=>{Re({MachineId:n.machineId,ToMachineId:n.toMachineId}).then((e=>{e.forEach((e=>{e.use=!0})),n.forwards=e})).catch((e=>{console.log(e)}))},h=()=>{c()},m=()=>{const e=n.forwards.filter((e=>e.use)).map((e=>Be({Name:e.Name,Port:e.Port,TargetEP:e.TargetEP,BufferSize:e.BufferSize,MachineId:n.toMachineId})));Promise.all(e).then((()=>{D.nk.success("已操作!"),n.show=!1})).catch((()=>{D.nk.success("操作失败!")}))};return(0,l.sV)((()=>{r()})),(0,l.hi)((()=>{})),{state:n,handleSearch:i,handleOnShowList:o,handleMachineChange:h,handleConfirm:m,handlePageChange:s}}};const Bt=(0,b.A)(At,[["render",Wt],["__scopeId","data-v-3a13c86f"]]);var zt=Bt;const Nt={class:"t-c head"},Ut={class:"error red"},Xt={class:"error red"};function xt(e,t,a,n,o,r){const s=(0,l.g2)("el-button"),u=(0,l.g2)("el-input"),d=(0,l.g2)("el-table-column"),i=(0,l.g2)("WarnTriangleFilled"),c=(0,l.g2)("el-icon"),h=(0,l.g2)("el-popover"),m=(0,l.g2)("el-switch"),p=(0,l.g2)("Delete"),g=(0,l.g2)("el-popconfirm"),v=(0,l.g2)("el-table"),f=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(f,{modelValue:n.state.show,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.show=e),onOpen:n.handleOnShowList,"append-to":".app-wrap",title:"服务器代理穿透",top:"1vh",width:"700"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.Lk)("div",Nt,[(0,l.bF)(s,{type:"success",size:"small",onClick:n.handleAdd},{default:(0,l.k6)((()=>[(0,l.eW)("添加")])),_:1},8,["onClick"]),(0,l.bF)(s,{size:"small",onClick:n.handleRefresh},{default:(0,l.k6)((()=>[(0,l.eW)("刷新")])),_:1},8,["onClick"]),(0,l.bF)(s,{size:"small",onClick:n.handleCopy},{default:(0,l.k6)((()=>[(0,l.eW)("复制穿透配置")])),_:1},8,["onClick"])]),(0,l.bF)(v,{data:n.state.data,size:"small",border:"",height:"500",onCellDblclick:n.handleCellClick},{default:(0,l.k6)((()=>[(0,l.bF)(d,{property:"Name",label:"名称"},{default:(0,l.k6)((e=>[e.row.NameEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(u,{key:0,autofocus:"",size:"small",modelValue:e.row.Name,"onUpdate:modelValue":t=>e.row.Name=t,onBlur:t=>n.handleEditBlur(e.row,"Name")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.eW)((0,T.v_)(e.row.Name),1)],64))])),_:1}),(0,l.bF)(d,{prop:"BufferSize",label:"缓冲区",width:"100"},{default:(0,l.k6)((e=>[(0,l.Lk)("span",null,(0,T.v_)(1<<e.row.BufferSize)+"KB",1)])),_:1}),(0,l.bF)(d,{property:"Temp",label:"远程端口/域名",width:"160"},{default:(0,l.k6)((e=>[e.row.TempEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(u,{key:0,autofocus:"",size:"small",modelValue:e.row.Temp,"onUpdate:modelValue":t=>e.row.Temp=t,onBlur:t=>n.handleEditBlur(e.row,"Temp")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[e.row.Msg?((0,l.uX)(),(0,l.Wv)(h,{key:0,placement:"top",title:"提示",width:"20rem",trigger:"hover",content:e.row.Msg},{reference:(0,l.k6)((()=>[(0,l.Lk)("div",Ut,[(0,l.Lk)("span",null,(0,T.v_)(e.row.Temp),1),(0,l.bF)(c,{size:"20"},{default:(0,l.k6)((()=>[(0,l.bF)(i)])),_:1})])])),_:2},1032,["content"])):((0,l.uX)(),(0,l.CE)("span",{key:1,class:(0,T.C4)({green:e.row.Started})},(0,T.v_)(e.row.Temp),3))],64))])),_:1}),(0,l.bF)(d,{property:"LocalEP",label:"本机服务",width:"140"},{default:(0,l.k6)((e=>[e.row.LocalEPEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(u,{key:0,autofocus:"",size:"small",modelValue:e.row.LocalEP,"onUpdate:modelValue":t=>e.row.LocalEP=t,onBlur:t=>n.handleEditBlur(e.row,"LocalEP")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[e.row.LocalMsg?((0,l.uX)(),(0,l.Wv)(h,{key:0,placement:"top",title:"提示",width:"20rem",trigger:"hover",content:e.row.LocalMsg},{reference:(0,l.k6)((()=>[(0,l.Lk)("span",Xt,(0,T.v_)(e.row.LocalEP),1),(0,l.bF)(c,{size:"20"},{default:(0,l.k6)((()=>[(0,l.bF)(i)])),_:1})])),_:2},1032,["content"])):((0,l.uX)(),(0,l.CE)("span",{key:1,class:(0,T.C4)({green:e.row.Started})},(0,T.v_)(e.row.LocalEP),3))],64))])),_:1}),(0,l.bF)(d,{property:"Started",label:"状态",width:"60"},{default:(0,l.k6)((e=>[(0,l.bF)(m,{modelValue:e.row.Started,"onUpdate:modelValue":t=>e.row.Started=t,onChange:t=>n.handleStartChange(e.row),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,l.bF)(d,{label:"操作",width:"54"},{default:(0,l.k6)((e=>[(0,l.bF)(g,{"confirm-button-text":"确认","cancel-button-text":"取消",title:"删除不可逆，是否确认?",onConfirm:t=>n.handleDel(e.row.Id)},{reference:(0,l.k6)((()=>[(0,l.bF)(s,{type:"danger",size:"small"},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.bF)(p)])),_:1})])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data","onCellDblclick"])])])),_:1},8,["modelValue","onOpen"])}var Dt={props:["data","modelValue"],emits:["update:modelValue"],components:{WarnTriangleFilled:v.DtC,Delete:v.epd},setup(e,{emit:t}){const a=(0,u.B)(),n=ft(),o=(0,d.Kh)({bufferSize:a.value.bufferSize,show:!0,data:[],timerTestLocal:0});(0,l.wB)((()=>o.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const r=()=>{(0,pt.eX)().then((e=>{o.timerTestLocal=setTimeout(r,1e3)})).catch((()=>{o.timerTestLocal=setTimeout(r,1e3)}))},s=()=>{(0,pt.pY)().then((e=>{let t=e.List||[];t.forEach((e=>{e.Temp=(e.Domain||e.RemotePort).toString(),e.RemotePort=0,e.Domain=""})),o.data=t})).catch((()=>{}))},i=()=>{s()},c=(e,t)=>{p(e,t.property)},h=()=>{s(),D.nk.success("已刷新")},m=()=>{(0,pt.Qs)({Id:0,Name:"",RemotePort:0,LocalEP:"127.0.0.1:80",Domain:"",Temp:""}).then((()=>{setTimeout((()=>{s()}),100)})).catch((e=>{D.nk.error(e)}))},p=(e,t)=>{e.Started?D.nk.error("请先停止运行"):(o.data.forEach((e=>{e["NameEditing"]=!1,e["RemotePortEditing"]=!1,e["LocalEPEditing"]=!1,e["DomainEditing"]=!1,e["TempEditing"]=!1})),e[`${t}Editing`]=!0)},g=(e,t)=>{e.Started?D.nk.error("请先停止运行"):(e[`${t}Editing`]=!1,w(e))},v=e=>{(0,pt.DY)(e).then((()=>{s()}))},f=e=>{w(e)},w=e=>{e.Temp&&(/^\d+$/.test(e.Temp)?e.RemotePort=parseInt(e.Temp):e.Domain=e.Temp,(0,pt.Qs)(e).then((()=>{setTimeout((()=>{s()}),100)})).catch((e=>{D.nk.error(e)})))},k=()=>{n.value.showCopy=!0},b=()=>{const e=(t=1e4)=>{if(t>2e4)return;const a={Name:`s-${t}`,RemotePort:t,LocalEP:"127.0.0.1:80",Started:!0};(0,pt.Qs)(a).then((a=>{setTimeout((()=>{e(++t)}),50)})).catch((a=>{console.log(a),D.nk.error(a),setTimeout((()=>{e(++t)}),100)}))};e()};return(0,l.sV)((()=>{s(),r()})),(0,l.hi)((()=>{clearTimeout(o.timerTestLocal)})),{state:o,handleOnShowList:i,handleCellClick:c,handleRefresh:h,handleAdd:m,handleEdit:p,handleEditBlur:g,handleDel:v,handleStartChange:f,handleCopy:k,handle10000:b}}};const Kt=(0,b.A)(Dt,[["render",xt],["__scopeId","data-v-48a6af94"]]);var Gt=Kt;const Ot=e=>((0,l.Qi)("data-v-5512121a"),e=e(),(0,l.jt)(),e),$t={class:"t-c head"},Qt=Ot((()=>(0,l.Lk)("span",null,"复制",-1))),qt={class:"t-c"},jt={class:"page-wrap"},Ht=Ot((()=>(0,l.Lk)("span",null,"的服务器代理穿透记录",-1))),Jt={class:"foot t-c"};function Yt(e,t,a,n,o,r){const s=(0,l.g2)("el-pagination"),u=(0,l.g2)("el-option"),d=(0,l.g2)("el-select"),i=(0,l.g2)("el-table-column"),c=(0,l.g2)("el-checkbox"),h=(0,l.g2)("el-table"),m=(0,l.g2)("el-button"),p=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(p,{modelValue:n.state.show,"onUpdate:modelValue":t[1]||(t[1]=e=>n.state.show=e),onOpen:n.handleOnShowList,"append-to":".app-wrap",title:"复制服务器代理穿透",top:"1vh",width:"500"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.Lk)("div",$t,[Qt,(0,l.bF)(d,{modelValue:n.state.machineId,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.machineId=e),onChange:n.handleMachineChange,filterable:"",remote:"",loading:n.state.loading,"remote-method":n.handleSearch},{header:(0,l.k6)((()=>[(0,l.Lk)("div",qt,[(0,l.Lk)("div",jt,[(0,l.bF)(s,{small:"",background:"",layout:"prev, pager, next","page-size":n.state.machineIds.Request.Size,total:n.state.machineIds.Count,"pager-count":5,"current-page":n.state.machineIds.Request.Page,onCurrentChange:n.handlePageChange},null,8,["page-size","total","current-page","onCurrentChange"])])])])),default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.machineIds.List,((e,t)=>((0,l.uX)(),(0,l.Wv)(u,{key:t,label:e.MachineName,value:e.MachineId},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange","loading","remote-method"]),Ht]),(0,l.bF)(h,{data:n.state.forwards,size:"small",border:""},{default:(0,l.k6)((()=>[(0,l.bF)(i,{property:"Name",label:"名称"}),(0,l.bF)(i,{property:"Domain",label:"域名/端口"},{default:(0,l.k6)((e=>[(0,l.Lk)("span",null,(0,T.v_)(e.row.Domain||e.row.RemotePort),1)])),_:1}),(0,l.bF)(i,{property:"LocalEP",label:"本机服务",width:"140"}),(0,l.bF)(i,{label:"操作",width:"80"},{default:(0,l.k6)((e=>[(0,l.bF)(c,{modelValue:e.row.use,"onUpdate:modelValue":t=>e.row.use=t},{default:(0,l.k6)((()=>[(0,l.eW)("使用")])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"]),(0,l.Lk)("div",Jt,[(0,l.bF)(m,{type:"primary",onClick:n.handleConfirm},{default:(0,l.k6)((()=>[(0,l.eW)("确定复制")])),_:1},8,["onClick"])])])])),_:1},8,["modelValue","onOpen"])}var Zt={props:["modelValue"],emits:["update:modelValue"],components:{WarnTriangleFilled:v.DtC},setup(e,{emit:t}){(0,u.B)();const a=(0,d.Kh)({show:!0,loading:!1,machineId:"",machineIds:{Request:{Page:1,Size:10,Name:""},Count:0,List:[]},forwards:[]});(0,l.wB)((()=>a.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const n=()=>{o()},o=()=>{a.loading=!0,(0,p.BS)(a.machineIds.Request).then((e=>{a.loading=!1,a.machineIds.Request=e.Request,a.machineIds.Count=e.Count,a.machineIds.List=e.List,!a.machineId&&a.machineIds.List.length>0&&(a.machineId=a.machineIds.List[0].MachineId,i())})).catch((e=>{a.loading=!1}))},r=e=>{a.machineIds.Request.Page=e,o()},s=e=>{a.machineIds.Request.Name=e,o()},i=()=>{(0,pt.$U)(a.machineId).then((e=>{e.forEach((e=>{e.use=!0})),a.forwards=e})).catch((e=>{console.log(e)}))},c=()=>{i()},h=()=>{const e=a.forwards.filter((e=>e.use)).map((e=>(0,pt.Qs)({Name:e.Name,Domain:e.Domain,RemotePort:e.RemotePort,LocalEP:e.LocalEP})));Promise.all(e).then((()=>{D.nk.success("已操作!"),a.show=!1})).catch((()=>{D.nk.success("操作失败!")}))};return(0,l.sV)((()=>{o()})),(0,l.hi)((()=>{})),{state:a,handleSearch:s,handleOnShowList:n,handleMachineChange:c,handleConfirm:h,handlePageChange:r}}};const ea=(0,b.A)(Zt,[["render",Yt],["__scopeId","data-v-5512121a"]]);var ta=ea;function aa(e,t,a,n,o,r){const s=(0,l.g2)("el-table-column"),u=(0,l.g2)("Delete"),d=(0,l.g2)("el-icon"),i=(0,l.g2)("el-button"),c=(0,l.g2)("el-popconfirm"),h=(0,l.g2)("el-table"),m=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(m,{modelValue:n.state.show,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.show=e),"append-to":".app-wrap",title:`与[${n.state.machineName}]的链接`,top:"1vh",width:"700"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(h,{data:n.state.data,size:"small",border:"",height:"500"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{property:"RemoteMachineId",label:"目标"},{default:(0,l.k6)((e=>[(0,l.Lk)("div",{class:(0,T.C4)({green:e.row.Connected})},[(0,l.Lk)("p",null,(0,T.v_)(e.row.IPEndPoint),1),(0,l.Lk)("p",null,"ssl : "+(0,T.v_)(e.row.SSL),1)],2)])),_:1}),(0,l.bF)(s,{property:"TransactionId",label:"事务",width:"80"},{default:(0,l.k6)((e=>[(0,l.Lk)("span",null,(0,T.v_)(n.state.transactions[e.row.TransactionId]),1)])),_:1}),(0,l.bF)(s,{property:"TransportName",label:"协议"},{default:(0,l.k6)((e=>[(0,l.Lk)("div",null,[(0,l.Lk)("p",null,(0,T.v_)(e.row.TransportName)+"("+(0,T.v_)(n.state.protocolTypes[e.row.ProtocolType])+")",1),(0,l.Lk)("p",null,(0,T.v_)(n.state.types[e.row.Type])+" - "+(0,T.v_)(1<<e.row.BufferSize)+"KB",1)])])),_:1}),(0,l.bF)(s,{property:"Delay",label:"延迟",width:"80"},{default:(0,l.k6)((e=>[(0,l.Lk)("span",null,(0,T.v_)(e.row.Delay)+"ms",1)])),_:1}),(0,l.bF)(s,{property:"Bytes",label:"通信"},{default:(0,l.k6)((e=>[(0,l.Lk)("div",null,[(0,l.Lk)("p",null,"up : "+(0,T.v_)(e.row.SendBytesText),1),(0,l.Lk)("p",null,"down : "+(0,T.v_)(e.row.ReceiveBytesText),1)])])),_:1}),(0,l.bF)(s,{label:"操作",width:"54"},{default:(0,l.k6)((e=>[n.hasTunnelRemove?((0,l.uX)(),(0,l.Wv)(c,{key:0,"confirm-button-text":"确认","cancel-button-text":"取消",title:"确定关闭此连接?",onConfirm:t=>n.handleDel(e.row)},{reference:(0,l.k6)((()=>[(0,l.bF)(i,{type:"danger",size:"small"},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(u)])),_:1})])),_:1})])),_:2},1032,["onConfirm"])):(0,l.Q3)("",!0)])),_:1})])),_:1},8,["data"])])])),_:1},8,["modelValue","title"])}var la={props:["modelValue"],emits:["change","update:modelValue"],components:{Delete:v.epd},setup(e,{emit:t}){const a=(0,u.B)(),n=(0,l.EW)((()=>a.value.hasAccess("TunnelRemove"))),o=De(),r=Ke(),s=Ge(),i=(0,d.Kh)({show:!0,protocolTypes:{1:"tcp",2:"udp",4:"msquic"},types:{0:"打洞",1:"中继"},transactions:{forward:"端口转发",tuntap:"虚拟网卡"},machineName:o.value.currentName,data:(0,l.EW)((()=>[r.value.list[o.value.current],s.value.list[o.value.current]].filter((e=>!!e))))});(0,l.wB)((()=>i.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e),t("change")}),300)}));const c=e=>{n.value&&e.removeFunc(e.RemoteMachineId).then((()=>{D.nk.success("删除成功")})).catch((()=>{}))};return(0,l.sV)((()=>{o.value.updateRealTime(!0)})),(0,l.hi)((()=>{o.value.updateRealTime(!1)})),{state:i,handleDel:c,hasTunnelRemove:n}}};const na=(0,b.A)(la,[["render",aa],["__scopeId","data-v-337b0bab"]]);var oa=na,ra=a(7985),sa=a(9383),ua={components:{Oper:C,Device:N,DeviceEdit:O,AccessEdit:J,Tunnel:Qe,TunnelEdit:tt,ConnectionsEdit:oa,Tuntap:ne,TuntapEdit:be,Forward:bt,ForwardEdit:Et,ForwardCopy:zt,SForwardEdit:Gt,SForwardCopy:ta},setup(e){const t=(0,u.B)(),a=(0,d.Kh)({height:(0,l.EW)((()=>t.value.height-90))}),{devices:n,machineId:o,_getSignList:r,_getSignList1:s,handleDeviceEdit:i,handleAccessEdit:c,handlePageChange:h,handlePageSizeChange:m,handleDel:p,clearDevicesTimeout:g,setSort:v}=(0,ra.r)(),{tuntap:f,_getTuntapInfo:k,handleTuntapEdit:b,handleTuntapRefresh:F,clearTuntapTimeout:C,getTuntapMachines:T,sortTuntapIP:L}=(0,ee.O)(),{tunnel:V,_getTunnelInfo:_,handleTunnelEdit:E,handleTunnelRefresh:y,clearTunnelTimeout:I,sortTunnel:S}=Ee(),{forward:P,_getForwardInfo:M,handleForwardEdit:R,_testTargetForwardInfo:W,clearForwardTimeout:A,getForwardMachines:B}=ht(),{sforward:z,_getSForwardInfo:N,handleSForwardEdit:U,_testLocalSForwardInfo:X,clearSForwardTimeout:x,getSForwardMachines:K}=vt(),{connections:G,forwardConnections:O,_getForwardConnections:$,tuntapConnections:Q,_getTuntapConnections:q,handleTunnelConnections:j,clearConnectionsTimeout:H}=xe(),{_getUpdater:J,_subscribeUpdater:Y,clearUpdaterTimeout:Z}=(0,sa.d)(),{_getAccessInfo:te,clearAccessTimeout:ae}=(0,w.Y)(),le=e=>{n.page.Request.Prop=e.prop,n.page.Request.Asc="ascending"==e.order;let t=new Promise(((e,t)=>{e()}));if("tunnel"==e.prop){const e=S(n.page.Request.Asc);e.length>0&&(t=v(e))}else if("tuntap"==e.prop){const e=L(n.page.Request.Asc);e.length>0&&(t=v(e))}t.then((()=>{h()})).catch((()=>{}))},ne=e=>{R(e,n.page.List.filter((t=>t.MachineId==e))[0].MachineName)},oe=e=>{n.page.Request.Name=e||"",n.page.Request.Name?n.page.Request.Ids=T(n.page.Request.Name).concat(B(n.page.Request.Name)).concat(K(n.page.Request.Name)).reduce(((e,t)=>(-1==e.indexOf(t)&&e.push(t),e)),[]):n.page.Request.Ids=[],h(),y(),F(),D.nk.success({message:"刷新成功",grouping:!0})},re=()=>{h(),y(),F(),D.nk.success({message:"刷新成功",grouping:!0})};return(0,l.sV)((()=>{h(),y(),F(),r(),s(),k(),_(),$(),q(),M(),N(),J(),Y(),te(),W(),X()})),(0,l.hi)((()=>{g(),H(),C(),I(),A(),x(),Z(),ae()})),{state:a,devices:n,machineId:o,handleSortChange:le,handleDeviceEdit:i,handleAccessEdit:c,handlePageRefresh:oe,handlePageSearch:re,handlePageChange:h,handlePageSizeChange:m,handleDel:p,tuntap:f,handleTuntapEdit:b,handleTuntapRefresh:F,tunnel:V,connections:G,handleTunnelEdit:E,handleTunnelRefresh:y,handleTunnelConnections:j,forward:P,_handleForwardEdit:ne,sforward:z,handleSForwardEdit:U}}};const da=(0,b.A)(ua,[["render",s],["__scopeId","data-v-137c2b43"]]);var ia=da},2126:function(e,t,a){a.d(t,{A:function(){return b}});var l=a(6768),n=a(4232);const o=["title"],r={key:0,class:"progress"},s={key:1,class:"progress"};function u(e,t,a,u,d,i){const c=(0,l.g2)("Loading"),h=(0,l.g2)("el-icon"),m=(0,l.g2)("Download"),p=(0,l.g2)("CircleCheck");return(0,l.uX)(),(0,l.CE)("a",{href:"javascript:;",class:(0,n.C4)(["download",u.updaterColor]),onClick:t[0]||(t[0]=e=>u.handleUpdate()),title:u.updaterText},[(0,l.Lk)("span",null,[(0,l.Lk)("span",null,(0,n.v_)(u.item.Version),1),u.updater.list[u.item.MachineId]?((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[1==u.updater.list[u.item.MachineId].Status?((0,l.uX)(),(0,l.Wv)(h,{key:0,size:"14",class:"loading"},{default:(0,l.k6)((()=>[(0,l.bF)(c)])),_:1})):2==u.updater.list[u.item.MachineId].Status?((0,l.uX)(),(0,l.Wv)(h,{key:1,size:"14"},{default:(0,l.k6)((()=>[(0,l.bF)(m)])),_:1})):3==u.updater.list[u.item.MachineId].Status||5==u.updater.list[u.item.MachineId].Status?((0,l.uX)(),(0,l.CE)(l.FK,{key:2},[(0,l.bF)(h,{size:"14",class:"loading"},{default:(0,l.k6)((()=>[(0,l.bF)(c)])),_:1}),0==u.updater.list[u.item.MachineId].Length?((0,l.uX)(),(0,l.CE)("span",r,"0%")):((0,l.uX)(),(0,l.CE)("span",s,(0,n.v_)(parseInt(u.updater.list[u.item.MachineId].Current/u.updater.list[u.item.MachineId].Length*100))+"%",1))],64)):6==u.updater.list[u.item.MachineId].Status?((0,l.uX)(),(0,l.Wv)(h,{key:3,size:"14",class:"yellow"},{default:(0,l.k6)((()=>[(0,l.bF)(p)])),_:1})):(0,l.Q3)("",!0)],64)):((0,l.uX)(),(0,l.Wv)(h,{key:1,size:"14"},{default:(0,l.k6)((()=>[(0,l.bF)(m)])),_:1}))])],10,o)}a(4114);var d=a(3830),i=a(144),c=a(1219),h=a(2933),m=a(2248),p=a(920),g=a(7477),v=a(9383),f={props:["item","config"],components:{Download:g.f5X,Loading:g.Rhj,CircleCheck:g.rW7},setup(e){const t=(0,d.B)(),a=(0,l.EW)((()=>t.value.hasAccess("UpdateSelf"))),n=(0,l.EW)((()=>t.value.hasAccess("UpdateOther"))),o=(0,v.T)(),r=(0,l.EW)((()=>t.value.signin.Version)),s=(0,l.EW)((()=>o.value.current.Version)),u=(0,l.EW)((()=>`${s.value}->${o.value.current.DateTime}\n${o.value.current.Msg.map(((e,t)=>`${t+1}、${e}`)).join("\n")}`)),g=(0,l.EW)((()=>o.value.list[e.item.MachineId]?o.value.list[e.item.MachineId].Status<=2?e.item.Version!=r.value?`与服务器版本(${r.value})不一致，建议更新`:s.value!=e.item.Version?`不是最新版本(${s.value})，建议更新\n${u.value}`:`是最新版本，但我无法阻止你喜欢更新\n${u.value}`:{3:"正在下载",4:"已下载",5:"正在解压",6:"已解压，请重启"}[o.value.list[e.item.MachineId].Status]:"未检测到更新")),f=(0,l.EW)((()=>e.item.Version!=r.value?"red":o.value.list[e.item.MachineId]&&s.value!=e.item.Version?"yellow":"green")),w=()=>{if(!e.config)return;if(!a.value)return;const t=o.value.list[e.item.MachineId];if(t)if([0,1,3,5].indexOf(t.Status)>=0)c.nk.error("操作中，请稍后!");else if(6!=t.Status){if(2==t.Status){const t=(0,i.KR)(s.value),a=[(0,l.h)(m.P9,{label:`仅[${e.item.MachineName}] -> ${s.value}(最新版本)`,value:s.value})];e.config&&n.value&&a.push((0,l.h)(m.P9,{label:`[所有] -> ${s.value}(最新版本)`,value:`all->${s.value}`})),e.item.Version!=r.value&&s.value!=r.value&&(a.push((0,l.h)(m.P9,{label:`仅[${e.item.MachineName}] -> ${r.value}(服务器版本)`,value:r.value})),e.config&&n.value&&a.push((0,l.h)(m.P9,{label:`[所有] -> ${r.value}(服务器版本)`,value:`all->${r.value}`}))),(0,h.s)({title:"选择版本",message:()=>(0,l.h)(m.AV,{modelValue:t.value,placeholder:"请选择",style:"width:20rem;","onUpdate:modelValue":e=>{t.value=e}},a),confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{const a={MachineId:e.item.MachineId,Version:t.value.replace("all->",""),All:t.value.indexOf("all->")>=0};a.All&&(a.MachineId=""),(0,p.lJ)(a)})).catch((()=>{}))}}else h.s.confirm("确定关闭程序吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{exit(e.item.MachineId)})).catch((()=>{}));else c.nk.error("未检测到更新")};return{item:(0,l.EW)((()=>e.item)),updater:o,updaterText:g,updaterColor:f,handleUpdate:w}}},w=a(1241);const k=(0,w.A)(f,[["render",u],["__scopeId","data-v-56d38c60"]]);var b=k}}]);