"use strict";(self["webpackChunklinker_web"]=self["webpackChunklinker_web"]||[]).push([[772],{5241:function(e,t,n){n.d(t,{PR:function(){return r},Yh:function(){return c},ac:function(){return o},en:function(){return u},kl:function(){return i},vB:function(){return l},zi:function(){return s}});var a=n(4);const i=(e="0")=>(0,a.zG)("tuntapclient/connections",e),l=e=>(0,a.zG)("tuntapclient/removeconnection",e),s=(e="0")=>(0,a.zG)("tuntapclient/get",e),u=e=>(0,a.zG)("tuntapclient/run",e),r=e=>(0,a.zG)("tuntapclient/stop",e),o=e=>(0,a.zG)("tuntapclient/update",e),c=()=>(0,a.zG)("tuntapclient/refresh")},7985:function(e,t,n){n.d(t,{r:function(){return r}});n(4114);var a=n(9299),i=n(3830),l=n(6768),s=n(144);const u=[],r=()=>{const e=(0,i.B)(),t=(0,l.EW)((()=>e.value.config.Client.Id)),n=(0,s.Kh)({timer:0,page:{Request:{Page:1,Size:+(localStorage.getItem("ps")||"10"),Name:"",Ids:[],Prop:"",Asc:!0},Count:0,List:[]},showDeviceEdit:!1,deviceInfo:null}),r=()=>{(0,a.nD)(n.page.Request).then((a=>{n.page.Request=a.Request,n.page.Count=a.Count;for(let n in a.List)Object.assign(a.List[n],{showDel:t.value!=a.List[n].MachineId&&0==a.List[n].Connected,showReboot:a.List[n].Connected,isSelf:t.value==a.List[n].MachineId,showip:!1}),a.List[n].isSelf&&(e.value.self=a.List[n]);n.page.List=a.List;for(let e=0;e<n.page.List.length;e++)u.push(n.page.List[e])})).catch((e=>{}))},o=()=>{e.value.api.connected?(0,a.nD)(n.page.Request).then((a=>{for(let i in a.List){const l=n.page.List.filter((e=>e.MachineId==a.List[i].MachineId))[0];l&&(Object.assign(l,{Connected:a.List[i].Connected,Version:a.List[i].Version,LastSignIn:a.List[i].LastSignIn,Args:a.List[i].Args,showDel:t.value!=a.List[i].MachineId&&0==a.List[i].Connected,showReboot:a.List[i].Connected,isSelf:t.value==a.List[i].MachineId}),l.isSelf&&(e.value.self=l))}n.timer=setTimeout(o,5e3)})).catch((e=>{n.timer=setTimeout(o,5e3)})):n.timer=setTimeout(o,5e3)},c=()=>{try{if(0==u.length)return void setTimeout(c,1e3);const e=u.shift();fetch(`http://ip-api.com/json/${e.IP.split(":")[0]}`).then((async t=>{try{const n=await t.json();e.countryFlag=`https://unpkg.com/flag-icons@7.2.3/flags/4x3/${n.countryCode.toLowerCase()}.svg`}catch(n){}setTimeout(c,1e3)})).catch((()=>{setTimeout(c,1e3)}))}catch(e){setTimeout(c,1e3)}};c();const d=e=>{n.deviceInfo=e,n.showDeviceEdit=!0},m=e=>{e&&(n.page.Request.Page=e),r()},h=e=>{e&&(n.page.Request.Size=e,localStorage.setItem("ps",e)),r()},p=e=>{(0,a.Se)(e).then((()=>{r()}))},v=()=>{clearTimeout(n.timer),n.timer=0},g=e=>(0,a.VN)(e);return{devices:n,machineId:t,_getSignList:r,_getSignList1:o,handleDeviceEdit:d,handlePageChange:m,handlePageSizeChange:h,handleDel:p,clearDevicesTimeout:v,setSort:g}}},8104:function(e,t,n){n.d(t,{O:function(){return o},W:function(){return c}});var a=n(3830),i=n(1219),l=n(144),s=n(6768),u=n(5241);const r=Symbol(),o=()=>{const e=(0,a.B)(),t=(0,l.KR)({timer:0,showEdit:!1,current:null,list:{},hashcode:0});(0,s.Gt)(r,t);const n={linux:["debian","ubuntu","alpine","rocky","centos"],windows:["windows"],android:["android"],ios:["ios"]},o=()=>{clearTimeout(t.value.timer),e.value.api.connected?(0,u.zi)(t.value.hashcode.toString()).then((e=>{if(t.value.hashcode=e.HashCode,e.List){for(let t in e.List){let a="system";const i=e.List[t].SystemInfo.toLowerCase();for(let e in n)if(i.indexOf(e)>=0){const t=n[e];if(1==t.length)a=t[0];else for(let e=0;e<t.length;e++)if(i.indexOf(t[e])>=0){a=t[e];break}break}Object.assign(e.List[t],{running:2==e.List[t].Status,loading:1==e.List[t].Status,system:a,systemDocker:i.indexOf("docker")>=0})}t.value.list=e.List}t.value.timer=setTimeout(o,1100)})).catch((e=>{t.value.timer=setTimeout(o,1100)})):t.value.timer=setTimeout(o,50)},c=e=>{console.log(e),t.value.current=e,t.value.showEdit=!0},d=()=>{(0,u.Yh)(),i.nk.success({message:"刷新成功",grouping:!0})},m=()=>{clearTimeout(t.value.timer),t.value.timer=0},h=e=>Object.values(t.value.list).filter((t=>t.IP.indexOf(e)>=0||t.LanIPs.filter((t=>t.indexOf(e)>=0)).length>0)).map((e=>e.MachineId)),p=e=>{const n=Object.values(t.value.list).filter((e=>e.IP)).sort(((e,t)=>{const n=e.IP.split(".").map((e=>Number(e))),a=t.IP.split(".").map((e=>Number(e)));for(let i=0;i<n.length;i++)if(n[i]!=a[i])return n[i]-a[i];return 0}));return n.map((e=>e.MachineId))};return{tuntap:t,_getTuntapInfo:o,handleTuntapEdit:c,handleTuntapRefresh:d,clearTuntapTimeout:m,getTuntapMachines:h,sortTuntapIP:p}},c=()=>(0,s.WQ)(r)},9383:function(e,t,n){n.d(t,{T:function(){return o},d:function(){return r}});var a=n(920),i=n(3830),l=n(144),s=n(6768);const u=Symbol(),r=()=>{const e=(0,i.B)(),t=(0,l.KR)({timer:0,list:{},hashcode:0,current:{Version:"",Msg:[],DateTime:"",Status:0,Length:0,Current:0}});(0,s.Gt)(u,t);const n=()=>{e.value.api.connected?(0,a.mK)(t.value.hashcode.toString()).then((a=>{if(t.value.hashcode=a.HashCode,a.List){const n=Object.values(a.List).filter((e=>!!e.Version))[0];n&&(Object.assign(t.value.current,{DateTime:n.DateTime,Version:n.Version,Status:n.Status,Length:n.Length,Current:n.Current,Msg:n.Msg}),e.value.updater=t.value.current),t.value.list=a.List}t.value.timer=setTimeout(n,800)})).catch((()=>{t.value.timer=setTimeout(n,800)})):t.value.timer=setTimeout(n,800)},r=()=>{clearTimeout(t.value.timer)};return{updater:t,_getUpdater:n,clearUpdaterTimeout:r}},o=()=>(0,s.WQ)(u)},8809:function(e,t,n){n.d(t,{A:function(){return h}});var a=n(6768);const i=(0,a.Lk)("div",null,"修改后最好能重启一次客户端",-1),l={class:"t-c w-100"};function s(e,t,n,s,u,r){const o=(0,a.g2)("el-form-item"),c=(0,a.g2)("el-input"),d=(0,a.g2)("el-button"),m=(0,a.g2)("el-form"),h=(0,a.g2)("el-dialog");return(0,a.uX)(),(0,a.Wv)(h,{modelValue:s.state.show,"onUpdate:modelValue":t[2]||(t[2]=e=>s.state.show=e),"close-on-click-modal":!1,"append-to":".app-wrap",title:"设置设备",width:"300"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",null,[(0,a.bF)(m,{ref:"ruleFormRef",model:s.state.ruleForm,rules:s.state.rules,"label-width":"auto"},{default:(0,a.k6)((()=>[(0,a.bF)(o,{label:""},{default:(0,a.k6)((()=>[i])),_:1}),(0,a.bF)(o,{label:"设备名",prop:"MachineName"},{default:(0,a.k6)((()=>[(0,a.bF)(c,{maxlength:"12","show-word-limit":"",modelValue:s.state.ruleForm.MachineName,"onUpdate:modelValue":t[0]||(t[0]=e=>s.state.ruleForm.MachineName=e)},null,8,["modelValue"])])),_:1}),(0,a.bF)(o,{label:"",prop:"Btns"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",l,[(0,a.bF)(d,{onClick:t[1]||(t[1]=e=>s.state.show=!1)},{default:(0,a.k6)((()=>[(0,a.eW)("取消")])),_:1}),(0,a.bF)(d,{type:"primary",onClick:s.handleSave},{default:(0,a.k6)((()=>[(0,a.eW)("确认")])),_:1},8,["onClick"])])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue"])}var u=n(9299),r=n(1219),o=n(144),c={props:["data","modelValue"],emits:["change","update:modelValue"],setup(e,{emit:t}){const n=(0,o.KR)(null),i=(0,o.Kh)({show:!0,ruleForm:{MachineName:e.data.MachineName},rules:{}});(0,a.wB)((()=>i.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const l=()=>{e.data.MachineName!=i.ruleForm.MachineName&&(0,u.gC)({Id:e.data.MachineId,newName:i.ruleForm.MachineName}).then((()=>{i.show=!1,r.nk.success("已操作！"),t("change")})).catch((()=>{r.nk.error("操作失败！")}))};return{state:i,ruleFormRef:n,handleSave:l}}},d=n(1241);const m=(0,d.A)(c,[["render",s]]);var h=m},5649:function(e,t,n){n.d(t,{A:function(){return f}});var a=n(6768),i=n(4232);const l=["title"],s=["src"],u=["src"],r={key:1,class:"system",src:"/docker.svg"},o={key:1};function c(e,t,n,c,d,m){const h=(0,a.g2)("StarFilled"),p=(0,a.g2)("el-icon");return(0,a.uX)(),(0,a.CE)("div",null,[c.tuntap.list[c.item.MachineId]&&c.tuntap.list[c.item.MachineId].system?((0,a.uX)(),(0,a.CE)("span",{key:0,title:c.tuntap.list[c.item.MachineId].SystemInfo},[c.item.countryFlag?((0,a.uX)(),(0,a.CE)("img",{key:0,class:"system",src:c.item.countryFlag},null,8,s)):(0,a.Q3)("",!0),(0,a.Lk)("img",{class:"system",src:`/${c.tuntap.list[c.item.MachineId].system}.svg`},null,8,u),c.tuntap.list[c.item.MachineId].systemDocker?((0,a.uX)(),(0,a.CE)("img",r)):(0,a.Q3)("",!0)],8,l)):(0,a.Q3)("",!0),(0,a.Lk)("a",{href:"javascript:;",onClick:t[0]||(t[0]=(...e)=>c.handleEdit&&c.handleEdit(...e)),title:"此客户端的设备名",class:(0,i.C4)({green:c.item.Connected})},(0,i.v_)(c.item.MachineName),3),c.item.isSelf?((0,a.uX)(),(0,a.CE)("strong",o,[(0,a.eW)(" - ("),(0,a.bF)(p,null,{default:(0,a.k6)((()=>[(0,a.bF)(h)])),_:1}),(0,a.eW)(" 本机) ")])):(0,a.Q3)("",!0)])}var d=n(3830),m=n(8104),h=n(7477),p={props:["item","config"],emits:["edit","refresh"],components:{StarFilled:h.BQ2},setup(e,{emit:t}){const n=(0,m.W)(),i=(0,d.B)(),l=(0,a.EW)((()=>i.value.config.Client.Id)),s=()=>{(e.config||l.value==e.item.MachineId)&&t("edit",e.item)};return{item:(0,a.EW)((()=>e.item)),tuntap:n,handleEdit:s}}},v=n(1241);const g=(0,v.A)(p,[["render",c],["__scopeId","data-v-43ee8088"]]);var f=g},9120:function(e,t,n){n.d(t,{A:function(){return y}});var a=n(6768),i=n(4232);const l={class:"flex"},s={class:"flex-1"},u=["title"],r={class:"red"},o={key:0},c={class:"yellow"},d={key:1},m={key:0,class:"delay green"},h={class:"delay yellow"};function p(e,t,n,p,v,g){const f=(0,a.g2)("el-popover"),I=(0,a.g2)("Loading"),k=(0,a.g2)("el-icon"),M=(0,a.g2)("el-switch");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.Lk)("div",l,[(0,a.Lk)("div",s,[(0,a.Lk)("a",{href:"javascript:;",class:"a-line",onClick:t[0]||(t[0]=e=>p.handleTuntapIP(p.tuntap.list[p.item.MachineId])),title:p.tuntap.list[p.item.MachineId].Gateway?"我在路由器上，所以略有不同":"此设备的虚拟网卡IP"},[p.tuntap.list[p.item.MachineId].Error?((0,a.uX)(),(0,a.Wv)(f,{key:0,placement:"top",title:"msg",width:"20rem",trigger:"hover",content:p.tuntap.list[p.item.MachineId].Error},{reference:(0,a.k6)((()=>[(0,a.Lk)("strong",r,(0,i.v_)(p.tuntap.list[p.item.MachineId].IP),1)])),_:1},8,["content"])):((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[p.tuntap.list[p.item.MachineId].running?((0,a.uX)(),(0,a.CE)("strong",{key:0,class:(0,i.C4)(["green",{gateway:p.tuntap.list[p.item.MachineId].Gateway}])},(0,i.v_)(p.tuntap.list[p.item.MachineId].IP),3)):((0,a.uX)(),(0,a.CE)("strong",{key:1,class:(0,i.C4)({gateway:p.tuntap.list[p.item.MachineId].Gateway})},(0,i.v_)(p.tuntap.list[p.item.MachineId].IP),3))],64))],8,u)]),p.tuntap.list[p.item.MachineId].loading?((0,a.uX)(),(0,a.CE)("div",o,[(0,a.bF)(k,{size:"14",class:"loading"},{default:(0,a.k6)((()=>[(0,a.bF)(I)])),_:1})])):((0,a.uX)(),(0,a.Wv)(M,{key:1,modelValue:p.tuntap.list[p.item.MachineId].running,"onUpdate:modelValue":t[1]||(t[1]=e=>p.tuntap.list[p.item.MachineId].running=e),loading:p.tuntap.list[p.item.MachineId].loading,disabled:"",onClick:t[2]||(t[2]=e=>p.handleTuntap(p.tuntap.list[p.item.MachineId])),size:"small","inline-prompt":"","active-text":"😀","inactive-text":"😣"},null,8,["modelValue","loading"]))]),(0,a.Lk)("div",null,[p.tuntap.list[p.item.MachineId].Error1?((0,a.uX)(),(0,a.Wv)(f,{key:0,placement:"top",title:"msg",width:"20rem",trigger:"hover",content:p.tuntap.list[p.item.MachineId].Error1},{reference:(0,a.k6)((()=>[(0,a.Lk)("div",c,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(p.tuntap.list[p.item.MachineId].LanIPs,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t},(0,i.v_)(e)+" / "+(0,i.v_)(p.tuntap.list[p.item.MachineId].Masks[t]),1)))),128))])])),_:1},8,["content"])):((0,a.uX)(),(0,a.CE)("div",d,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(p.tuntap.list[p.item.MachineId].LanIPs,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t},(0,i.v_)(e)+" / "+(0,i.v_)(p.tuntap.list[p.item.MachineId].Masks[t]),1)))),128))])),p.showDelay?((0,a.uX)(),(0,a.CE)(a.FK,{key:2},[p.tuntap.list[p.item.MachineId].Delay>=0&&p.tuntap.list[p.item.MachineId].Delay<=100?((0,a.uX)(),(0,a.CE)("div",m,(0,i.v_)(p.tuntap.list[p.item.MachineId].Delay)+"ms",1)):(0,a.Q3)("",!0),(0,a.Lk)("template",null,[(0,a.Lk)("div",h,(0,i.v_)(p.tuntap.list[p.item.MachineId].Delay)+"ms",1)])],64)):(0,a.Q3)("",!0)])])}var v=n(5241),g=n(1219),f=n(8104),I=n(7477),k=n(3830),M={props:["item","config"],emits:["edit","refresh"],components:{Loading:I.Rhj},setup(e,{emit:t}){const n=(0,f.W)(),i=(0,k.B)(),l=(0,a.EW)((()=>i.value.config.Client.Id)),s=(0,a.EW)((()=>2==(2&(i.value.config.Running.Tuntap||{Switch:0}).Switch))),u=t=>{if(!e.config&&l.value!=t.MachineId)return;const n=t.running?(0,v.PR)(t.MachineId):(0,v.en)(t.MachineId);t.loading=!0,n.then((()=>{g.nk.success("操作成功！")})).catch((()=>{g.nk.error("操作失败！")}))},r=n=>{(e.config||l.value==n.MachineId)&&t("edit",n)},o=()=>{t("refresh")};return{item:(0,a.EW)((()=>e.item)),tuntap:n,showDelay:s,handleTuntap:u,handleTuntapIP:r,handleTuntapRefresh:o}}},C=n(1241);const L=(0,C.A)(M,[["render",p],["__scopeId","data-v-4aa9109b"]]);var y=L},3929:function(e,t,n){n.d(t,{A:function(){return M}});var a=n(6768),i=n(4232);const l=["title"],s={key:0,class:"progress"},u={key:1,class:"progress"};function r(e,t,n,r,o,c){const d=(0,a.g2)("Loading"),m=(0,a.g2)("el-icon"),h=(0,a.g2)("Download"),p=(0,a.g2)("CircleCheck");return(0,a.uX)(),(0,a.CE)("a",{href:"javascript:;",class:(0,i.C4)(["download",r.updaterColor]),onClick:t[0]||(t[0]=e=>r.handleUpdate()),title:r.updaterText},[(0,a.Lk)("span",null,[(0,a.Lk)("span",null,(0,i.v_)(r.item.Version),1),r.updater.list[r.item.MachineId]?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[1==r.updater.list[r.item.MachineId].Status?((0,a.uX)(),(0,a.Wv)(m,{key:0,size:"14",class:"loading"},{default:(0,a.k6)((()=>[(0,a.bF)(d)])),_:1})):2==r.updater.list[r.item.MachineId].Status?((0,a.uX)(),(0,a.Wv)(m,{key:1,size:"14"},{default:(0,a.k6)((()=>[(0,a.bF)(h)])),_:1})):3==r.updater.list[r.item.MachineId].Status||5==r.updater.list[r.item.MachineId].Status?((0,a.uX)(),(0,a.CE)(a.FK,{key:2},[(0,a.bF)(m,{size:"14",class:"loading"},{default:(0,a.k6)((()=>[(0,a.bF)(d)])),_:1}),0==r.updater.list[r.item.MachineId].Length?((0,a.uX)(),(0,a.CE)("span",s,"0%")):((0,a.uX)(),(0,a.CE)("span",u,(0,i.v_)(parseInt(r.updater.list[r.item.MachineId].Current/r.updater.list[r.item.MachineId].Length*100))+"%",1))],64)):6==r.updater.list[r.item.MachineId].Status?((0,a.uX)(),(0,a.Wv)(m,{key:3,size:"14",class:"yellow"},{default:(0,a.k6)((()=>[(0,a.bF)(p)])),_:1})):(0,a.Q3)("",!0)],64)):((0,a.uX)(),(0,a.Wv)(m,{key:1,size:"14"},{default:(0,a.k6)((()=>[(0,a.bF)(h)])),_:1}))])],10,l)}n(4114);var o=n(3830),c=n(9383),d=n(144),m=n(1219),h=n(2933),p=n(2248),v=n(920),g=n(7477),f={props:["item","config"],components:{Download:g.f5X,Loading:g.Rhj,CircleCheck:g.rW7},setup(e){const t=(0,o.B)(),n=(0,a.EW)((()=>t.value.config.Client.Id)),i=(0,c.T)(),l=(0,a.EW)((()=>t.value.signin.Version)),s=(0,a.EW)((()=>i.value.current.Version)),u=(0,a.EW)((()=>`${s.value}->${i.value.current.DateTime}\n${i.value.current.Msg.map(((e,t)=>`${t+1}、${e}`)).join("\n")}`)),r=(0,a.EW)((()=>i.value.list[e.item.MachineId]?i.value.list[e.item.MachineId].Status<=2?e.item.Version!=l.value?`与服务器版本(${l.value})不一致，建议更新`:s.value!=e.item.Version?`不是最新版本(${s.value})，建议更新\n${u.value}`:`是最新版本，但我无法阻止你喜欢更新\n${u.value}`:{3:"正在下载",4:"已下载",5:"正在解压",6:"已解压，请重启"}[i.value.list[e.item.MachineId].Status]:"未检测到更新")),g=(0,a.EW)((()=>e.item.Version!=l.value?"red":i.value.list[e.item.MachineId]&&s.value!=e.item.Version?"yellow":"green")),f=()=>{if(!e.config&&n.value!=e.item.MachineId)return;const t=i.value.list[e.item.MachineId];if(t)if([0,1,3,5].indexOf(t.Status)>=0)m.nk.error("操作中，请稍后!");else if(6!=t.Status){if(2==t.Status){const t=(0,d.KR)(s.value),n=[(0,a.h)(p.P9,{label:`仅[${e.item.MachineName}] -> ${s.value}(最新版本)`,value:s.value})];e.config&&n.push((0,a.h)(p.P9,{label:`[所有] -> ${s.value}(最新版本)`,value:`all->${s.value}`})),e.item.Version!=l.value&&s.value!=l.value&&(n.push((0,a.h)(p.P9,{label:`仅[${e.item.MachineName}] -> ${l.value}(服务器版本)`,value:l.value})),e.config&&n.push((0,a.h)(p.P9,{label:`[所有] -> ${l.value}(服务器版本)`,value:`all->${l.value}`}))),(0,h.s)({title:"选择版本",message:()=>(0,a.h)(p.AV,{modelValue:t.value,placeholder:"请选择",style:"width:20rem;","onUpdate:modelValue":e=>{t.value=e}},n),confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{const n={MachineId:e.item.MachineId,Version:t.value.replace("all->",""),All:t.value.indexOf("all->")>=0};n.All&&(n.MachineId=""),(0,v.lJ)(n)})).catch((()=>{}))}}else h.s.confirm("确定关闭程序吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{exit(e.item.MachineId)})).catch((()=>{}));else m.nk.error("未检测到更新")};return{item:(0,a.EW)((()=>e.item)),updater:i,updaterText:r,updaterColor:g,handleUpdate:f}}},I=n(1241);const k=(0,I.A)(f,[["render",r],["__scopeId","data-v-260a68e5"]]);var M=k}}]);