"use strict";(self["webpackChunklinker_web"]=self["webpackChunklinker_web"]||[]).push([[6],{4:function(e,t,a){a.d(t,{a1:function(){return w},e3:function(){return v},jH:function(){return F},zG:function(){return k}});a(4114),a(6573),a(8100),a(7936);var l=a(1219);let n=0,o=null,r="",d=1,s="";const u={},i={connected:!1,connecting:!1},c=()=>{const e=Date.now();for(let t in u){const a=u[t];e-a.time>a.timeout&&(a.reject("超时~"),delete u[t])}setTimeout(c,1e3)};c();const h={subs:{},add:function(e,t){"function"==typeof t&&(this.subs[e]||(this.subs[e]=[]),this.subs[e].push(t))},remove(e,t){let a=this.subs[e]||[];for(let l=a.length-1;l>=0;l--)a[l]==t&&a.splice(l,1)},push(e,t){let a=this.subs[e]||[];for(let l=a.length-1;l>=0;l--)a[l](t)}},m=()=>{i.connected=!0,i.connecting=!1,h.push(b,i.connected)},p=e=>{i.connected=!1,i.connecting=!1,h.push(b,i.connected),setTimeout((()=>{w()}),1e3)},g=e=>{if("string"!=typeof e.data)return void e.data.arrayBuffer().then((t=>{const a=new DataView(t).getInt8(),l=new FileReader;l.readAsText(e.data.slice(4,4+a),"utf8"),l.onload=()=>{let n=JSON.parse(l.result);n.Content={Name:n.Content,Img:e.data.slice(4+a,e.data.length),ArrayBuffer:t},f(n)}}));let t=JSON.parse(e.data);f(t)},f=e=>{let t=u[e.RequestId];t?(0==e.Code?t.resolve(e.Content):1==e.Code?t.reject(e.Content):255==e.Code?(t.reject(e.Content),t.errHandle||l.nk.error(`${t.path}:${e.Content}`)):h.push(e.Path,e.Content),delete u[e.RequestId]):h.push(e.Path,e.Content)},w=(e=r,t=s)=>{if(s=t,r=e,i.connecting||i.connected)return;null!=o&&o.close(),i.connecting=!0;const a=t||"snltty";o=new WebSocket(r,[a]),o.iddd=++d,o.onopen=m,o.onclose=p,o.onmessage=g},v=()=>{o&&o.close()},k=(e,t={},a=!1,l=15e3)=>new Promise(((r,d)=>{let s=++n;try{u[s]={resolve:r,reject:d,errHandle:a,path:e,time:Date.now(),timeout:l};let n=JSON.stringify({Path:e,RequestId:s,Content:"string"==typeof t?t:JSON.stringify(t)});i.connected&&1==o.readyState?o.send(n):d("网络错误~")}catch(c){console.log(c),d("网络错误~"),delete u[s]}})),b=Symbol(),F=e=>{h.add(b,e)}},743:function(e,t,a){a.d(t,{$U:function(){return d},Ap:function(){return n},Co:function(){return o},DY:function(){return s},Qs:function(){return u},eX:function(){return i},pY:function(){return r}});var l=a(4);const n=()=>(0,l.zG)("sforwardclient/GetSecretKey"),o=e=>(0,l.zG)("sforwardclient/SetSecretKey",e),r=(e="0")=>(0,l.zG)("sforwardclient/get",e),d=e=>(0,l.zG)("sforwardclient/getremote",e),s=e=>(0,l.zG)("sforwardclient/remove",e),u=e=>(0,l.zG)("sforwardclient/add",e),i=()=>(0,l.zG)("sforwardclient/TestLocal")},9299:function(e,t,a){a.d(t,{BS:function(){return u},SZ:function(){return r},Se:function(){return i},VN:function(){return d},gC:function(){return c},jU:function(){return o},nD:function(){return s},rd:function(){return n}});var l=a(4);const n=e=>(0,l.zG)("signInclient/set",e),o=e=>(0,l.zG)("signInclient/setservers",e),r=()=>(0,l.zG)("signInclient/info"),d=e=>(0,l.zG)("signInclient/setorder",e),s=e=>(0,l.zG)("signInclient/List",e),u=e=>(0,l.zG)("signInclient/ids",e),i=e=>(0,l.zG)("signInclient/del",e),c=e=>(0,l.zG)("signInclient/setname",e)},83:function(e,t,a){a.d(t,{$M:function(){return u},KW:function(){return s},S3:function(){return h},Vn:function(){return c},b0:function(){return o},gM:function(){return d},ix:function(){return n},r7:function(){return r},xo:function(){return i}});var l=a(4);const n=()=>(0,l.zG)("tunnel/gettypes"),o=e=>(0,l.zG)("tunnel/SetServers",e),r=(e="0")=>(0,l.zG)("tunnel/get",e),d=()=>(0,l.zG)("tunnel/refresh"),s=e=>(0,l.zG)("tunnel/SetRouteLevel",e),u=e=>(0,l.zG)("tunnel/SetTransports",e),i=e=>(0,l.zG)("tunnel/SetExcludeIPs",e),c=()=>(0,l.zG)("tunnel/GeInterfaces"),h=e=>(0,l.zG)("tunnel/SetInterface",e)},920:function(e,t,a){a.d(t,{BJ:function(){return i},NS:function(){return r},Vk:function(){return u},aP:function(){return h},ir:function(){return s},lJ:function(){return o},mK:function(){return n},y2:function(){return c},yN:function(){return d}});var l=a(4);const n=(e="0")=>(0,l.zG)("updaterclient/get",e),o=e=>(0,l.zG)("updaterclient/confirm",e),r=e=>(0,l.zG)("updaterclient/exit",e),d=()=>(0,l.zG)("updaterclient/GetSecretKey"),s=e=>(0,l.zG)("updaterclient/SetSecretKey",e),u=()=>(0,l.zG)("updaterclient/getcurrent"),i=()=>(0,l.zG)("updaterclient/getserver"),c=e=>(0,l.zG)("updaterclient/confirmserver",e),h=()=>(0,l.zG)("updaterclient/exitserver")},3830:function(e,t,a){a.d(t,{B:function(){return s},v:function(){return d}});var l=a(4),n=a(144),o=a(6768);const r=Symbol(),d=()=>{const e=(0,n.KR)({api:{connected:!1},height:0,config:{Common:{},Client:{Servers:[]},Server:{},Running:{Relay:{Servers:[]},Tuntap:{IP:"",PrefixLength:24},Client:{Servers:[]},AutoSyncs:{}},configed:!1},signin:{Connected:!1,Connecting:!1,Version:"v1.0.0.0"},bufferSize:["1KB","2KB","4KB","8KB","16KB","32KB","64KB","128KB","256KB","512KB","1024KB"],updater:{},self:{}});return(0,l.jH)((t=>{e.value.api.connected=t})),(0,o.Gt)(r,e),e},s=()=>(0,o.WQ)(r)},9927:function(e,t,a){a.r(t),a.d(t,{default:function(){return Yt}});var l=a(6768);const n={class:"home-list-wrap absolute"},o={class:"page t-c"},r={class:"page-wrap"};function d(e,t,a,d,s,u){const i=(0,l.g2)("el-table-column"),c=(0,l.g2)("el-table"),h=(0,l.g2)("Device"),m=(0,l.g2)("Tunnel"),p=(0,l.g2)("Tuntap"),g=(0,l.g2)("Forward"),f=(0,l.g2)("Oper"),w=(0,l.g2)("el-pagination"),v=(0,l.g2)("DeviceEdit"),k=(0,l.g2)("TunnelEdit"),b=(0,l.g2)("ConnectionsEdit"),F=(0,l.g2)("TuntapEdit"),C=(0,l.g2)("ForwardEdit"),L=(0,l.g2)("ForwardCopy"),T=(0,l.g2)("SForwardEdit"),y=(0,l.g2)("SForwardCopy");return(0,l.uX)(),(0,l.CE)("div",n,[(0,l.bF)(c,{border:"",style:{width:"100%"},height:"32px",size:"small",onSortChange:d.handleSortChange,class:"table-sort"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{prop:"MachineId",label:"设备名",width:"120",sortable:"custom"}),(0,l.bF)(i,{prop:"Version",label:"版本",width:"120",sortable:"custom"}),(0,l.bF)(i,{prop:"tunnel",label:"网关",width:"90",sortable:"custom"}),(0,l.bF)(i,{prop:"tuntap",label:"网卡IP",width:"150",sortable:"custom"}),(0,l.bF)(i,{prop:"forward",label:""}),(0,l.bF)(i,{label:"",width:"74",fixed:"right"})])),_:1},8,["onSortChange"]),(0,l.bF)(c,{data:d.devices.page.List,stripe:"",border:"",style:{width:"100%"},height:`${d.state.height}px`,size:"small"},{default:(0,l.k6)((()=>[(0,l.bF)(h,{onEdit:d.handleDeviceEdit,onRefresh:d.handlePageRefresh},null,8,["onEdit","onRefresh"]),(0,l.bF)(m,{onEdit:d.handleTunnelEdit,onRefresh:d.handleTunnelRefresh,onConnections:d.handleTunnelConnections},null,8,["onEdit","onRefresh","onConnections"]),(0,l.bF)(p,{onEdit:d.handleTuntapEdit,onRefresh:d.handleTuntapRefresh},null,8,["onEdit","onRefresh"]),(0,l.bF)(g,{onEdit:d._handleForwardEdit,onSedit:d.handleSForwardEdit},null,8,["onEdit","onSedit"]),(0,l.bF)(f,{onRefresh:d.handlePageRefresh},null,8,["onRefresh"])])),_:1},8,["data","height"]),(0,l.Lk)("div",o,[(0,l.Lk)("div",r,[(0,l.bF)(w,{small:"",background:"",layout:"total,sizes,prev,pager, next",total:d.devices.page.Count,"page-size":d.devices.page.Request.Size,"current-page":d.devices.page.Request.Page,onCurrentChange:d.handlePageChange,onSizeChange:d.handlePageSizeChange,"page-sizes":[10,20,50,100,255]},null,8,["total","page-size","current-page","onCurrentChange","onSizeChange"])])]),d.devices.showDeviceEdit?((0,l.uX)(),(0,l.Wv)(v,{key:0,modelValue:d.devices.showDeviceEdit,"onUpdate:modelValue":t[0]||(t[0]=e=>d.devices.showDeviceEdit=e),onChange:d.handlePageChange,data:d.devices.deviceInfo},null,8,["modelValue","onChange","data"])):(0,l.Q3)("",!0),d.tunnel.showEdit?((0,l.uX)(),(0,l.Wv)(k,{key:1,modelValue:d.tunnel.showEdit,"onUpdate:modelValue":t[1]||(t[1]=e=>d.tunnel.showEdit=e),onChange:d.handleTunnelRefresh},null,8,["modelValue","onChange"])):(0,l.Q3)("",!0),d.connections.showEdit?((0,l.uX)(),(0,l.Wv)(b,{key:2,modelValue:d.connections.showEdit,"onUpdate:modelValue":t[2]||(t[2]=e=>d.connections.showEdit=e)},null,8,["modelValue"])):(0,l.Q3)("",!0),d.tuntap.showEdit?((0,l.uX)(),(0,l.Wv)(F,{key:3,modelValue:d.tuntap.showEdit,"onUpdate:modelValue":t[3]||(t[3]=e=>d.tuntap.showEdit=e),onChange:d.handleTuntapRefresh},null,8,["modelValue","onChange"])):(0,l.Q3)("",!0),d.forward.showEdit?((0,l.uX)(),(0,l.Wv)(C,{key:4,modelValue:d.forward.showEdit,"onUpdate:modelValue":t[4]||(t[4]=e=>d.forward.showEdit=e)},null,8,["modelValue"])):(0,l.Q3)("",!0),d.forward.showCopy?((0,l.uX)(),(0,l.Wv)(L,{key:5,modelValue:d.forward.showCopy,"onUpdate:modelValue":t[5]||(t[5]=e=>d.forward.showCopy=e)},null,8,["modelValue"])):(0,l.Q3)("",!0),d.sforward.showEdit?((0,l.uX)(),(0,l.Wv)(T,{key:6,modelValue:d.sforward.showEdit,"onUpdate:modelValue":t[6]||(t[6]=e=>d.sforward.showEdit=e)},null,8,["modelValue"])):(0,l.Q3)("",!0),d.sforward.showCopy?((0,l.uX)(),(0,l.Wv)(y,{key:7,modelValue:d.sforward.showCopy,"onUpdate:modelValue":t[7]||(t[7]=e=>d.sforward.showCopy=e)},null,8,["modelValue"])):(0,l.Q3)("",!0)])}a(4114);var s=a(4),u=a(3830),i=a(144);const c=e=>((0,l.Qi)("data-v-435a8a16"),e=e(),(0,l.jt)(),e),h={class:"dropdown"},m=c((()=>(0,l.Lk)("span",null,"操作",-1)));function p(e,t,a,n,o,r){const d=(0,l.g2)("ArrowDown"),s=(0,l.g2)("el-icon"),u=(0,l.g2)("SwitchButton"),i=(0,l.g2)("el-dropdown-item"),c=(0,l.g2)("Delete"),p=(0,l.g2)("el-dropdown-menu"),g=(0,l.g2)("el-dropdown"),f=(0,l.g2)("el-table-column");return(0,l.uX)(),(0,l.Wv)(f,{label:"操作",width:"74",fixed:"right"},{default:(0,l.k6)((e=>[(0,l.bF)(g,{size:"small"},{dropdown:(0,l.k6)((()=>[(0,l.bF)(p,null,{default:(0,l.k6)((()=>[e.row.showReboot?((0,l.uX)(),(0,l.Wv)(i,{key:0,onClick:t=>n.handleExit(e.row.MachineId,e.row.MachineName)},{default:(0,l.k6)((()=>[(0,l.bF)(s,null,{default:(0,l.k6)((()=>[(0,l.bF)(u)])),_:1}),(0,l.eW)(" 重启")])),_:2},1032,["onClick"])):(0,l.Q3)("",!0),e.row.showDel?((0,l.uX)(),(0,l.Wv)(i,{key:1,onClick:t=>n.handleDel(e.row.MachineId,e.row.MachineName)},{default:(0,l.k6)((()=>[(0,l.bF)(s,null,{default:(0,l.k6)((()=>[(0,l.bF)(c)])),_:1}),(0,l.eW)(" 删除")])),_:2},1032,["onClick"])):(0,l.Q3)("",!0)])),_:2},1024)])),default:(0,l.k6)((()=>[(0,l.Lk)("div",h,[m,(0,l.bF)(s,{class:"el-icon--right"},{default:(0,l.k6)((()=>[(0,l.bF)(d)])),_:1})])])),_:2},1024)])),_:1})}var g=a(9299),f=a(920),w=a(7477),v=a(2933),k={emits:["refresh"],components:{Delete:w.epd,SwitchButton:w.L$q,ArrowDown:w.yd$},setup(e,{emit:t}){const a=(e,a)=>{v.s.confirm(`确认删除[${a}]?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,g.Se)(e).then((()=>{t("refresh")}))})).catch((()=>{}))},l=(e,a)=>{v.s.confirm(`确认关闭[${a}]?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,f.NS)(e).then((()=>{t("refresh")}))})).catch((()=>{}))};return{handleDel:a,handleExit:l}}},b=a(1241);const F=(0,b.A)(k,[["render",p],["__scopeId","data-v-435a8a16"]]);var C=F,L=a(4232);const T=e=>((0,l.Qi)("data-v-e7fa483e"),e=e(),(0,l.jt)(),e),y={class:"flex"},_=T((()=>(0,l.Lk)("span",{class:"flex-1"},"设备",-1))),V={class:"flex"},I=["onClick"],S=["onClick"],E=T((()=>(0,l.Lk)("span",null,"😴㊙.㊙.㊙.㊙",-1))),P=[E],R=T((()=>(0,l.Lk)("span",{class:"flex-1"},null,-1)));function z(e,t,a,n,o,r){const d=(0,l.g2)("el-input"),s=(0,l.g2)("Search"),u=(0,l.g2)("el-icon"),i=(0,l.g2)("el-button"),c=(0,l.g2)("DeviceName"),h=(0,l.g2)("UpdaterBtn"),m=(0,l.g2)("el-table-column");return(0,l.uX)(),(0,l.Wv)(m,{prop:"MachineId",label:"设备",width:"240"},{header:(0,l.k6)((()=>[(0,l.Lk)("div",y,[_,(0,l.Lk)("span",null,[(0,l.bF)(d,{size:"small",modelValue:n.name,"onUpdate:modelValue":t[0]||(t[0]=e=>n.name=e),clearable:"",onInput:n.handleRefresh,placeholder:"设备/虚拟网卡/端口转发"},null,8,["modelValue","onInput"])]),(0,l.Lk)("span",null,[(0,l.bF)(i,{size:"small",onClick:n.handleRefresh},{default:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(s)])),_:1})])),_:1},8,["onClick"])])])])),default:(0,l.k6)((e=>[(0,l.Lk)("div",null,[(0,l.Lk)("p",null,[(0,l.bF)(c,{onEdit:n.handleEdit,config:!0,item:e.row},null,8,["onEdit","item"])]),(0,l.Lk)("p",V,[e.row.showip?((0,l.uX)(),(0,l.CE)("span",{key:0,title:"此设备的外网IP",class:"ipaddress",onClick:t=>e.row.showip=!e.row.showip},[(0,l.Lk)("span",null,"😀"+(0,L.v_)(e.row.IP),1)],8,I)):((0,l.uX)(),(0,l.CE)("span",{key:1,title:"此设备的外网IP",class:"ipaddress",onClick:t=>e.row.showip=!e.row.showip},P,8,S)),R,(0,l.bF)(h,{config:!0,item:e.row},null,8,["item"])])])])),_:1})}var B=a(9383),M=a(8104),W=a(3929),U=a(5649),D={emits:["edit","refresh"],components:{Search:w.vji,UpdaterBtn:W.A,DeviceName:U.A},setup(e,{emit:t}){const a=(0,i.KR)(sessionStorage.getItem("search-name")||""),l=(0,B.T)(),n=(0,M.W)(),o=e=>{t("edit",e)},r=()=>{sessionStorage.setItem("search-name",a.value),t("refresh",a.value)};return{tuntap:n,handleEdit:o,handleRefresh:r,name:a,updater:l}}};const N=(0,b.A)(D,[["render",z],["__scopeId","data-v-e7fa483e"]]);var X=N,x=a(8809);const G={key:0};function A(e,t,a,n,o,r){const d=(0,l.g2)("TuntapShow"),s=(0,l.g2)("el-table-column");return(0,l.uX)(),(0,l.Wv)(s,{prop:"tuntap",label:"虚拟网卡",width:"160"},{default:(0,l.k6)((e=>[n.tuntap.list[e.row.MachineId]?((0,l.uX)(),(0,l.CE)("div",G,[(0,l.bF)(d,{config:!0,item:e.row,onEdit:n.handleTuntapIP,onRefresh:n.handleTuntapRefresh},null,8,["item","onEdit","onRefresh"])])):(0,l.Q3)("",!0)])),_:1})}var K=a(9120),O={emits:["edit","refresh"],components:{TuntapShow:K.A},setup(e,{emit:t}){const a=(0,M.W)(),l=e=>{t("edit",e)},n=()=>{t("refresh")};return{tuntap:a,handleTuntapIP:l,handleTuntapRefresh:n}}};const q=(0,b.A)(O,[["render",A]]);var Q=q;const j=e=>((0,l.Qi)("data-v-22dd5fdf"),e=e(),(0,l.jt)(),e),$=j((()=>(0,l.Lk)("span",null,"/",-1))),H=j((()=>(0,l.Lk)("span",{style:{width:"3rem"}},null,-1))),J={key:0,class:"upgrade-wrap"},Y=j((()=>(0,l.Lk)("span",{class:"yellow"},"此设备能使用NAT转发，只需局域网IP，剩下的交给NAT(linux、macos、win10+)",-1))),Z={class:"flex-1"},ee=j((()=>(0,l.Lk)("span",null,"/",-1))),te={class:"pdl-10"},ae=j((()=>(0,l.Lk)("span",{class:"yellow"},"此设备无法使用NAT转发，或只想使用端口转发",-1))),le={class:"flex-1"},ne={class:"pdl-10"};function oe(e,t,a,n,o,r){const d=(0,l.g2)("el-form-item"),s=(0,l.g2)("el-input"),u=(0,l.g2)("el-checkbox"),i=(0,l.g2)("el-popover"),c=(0,l.g2)("Delete"),h=(0,l.g2)("el-icon"),m=(0,l.g2)("el-button"),p=(0,l.g2)("Plus"),g=(0,l.g2)("el-form"),f=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(f,{modelValue:n.state.show,"onUpdate:modelValue":t[6]||(t[6]=e=>n.state.show=e),"close-on-click-modal":!1,"append-to":".app-wrap",title:"组网设置",top:"1vh",width:"700"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(g,{ref:"ruleFormRef",model:n.state.ruleForm,rules:n.state.rules,"label-width":"140"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{prop:"gateway",style:{"margin-bottom":"0"}},{default:(0,l.k6)((()=>[(0,l.eW)(" 赐予此设备IP，其它设备可通过此IP访问 ")])),_:1}),(0,l.bF)(d,{label:"此设备的虚拟网卡IP",prop:"IP"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{modelValue:n.state.ruleForm.IP,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.ruleForm.IP=e),style:{width:"14rem"}},null,8,["modelValue"]),$,(0,l.bF)(s,{onChange:n.handlePrefixLengthChange,modelValue:n.state.ruleForm.PrefixLength,"onUpdate:modelValue":t[1]||(t[1]=e=>n.state.ruleForm.PrefixLength=e),style:{width:"4rem"}},null,8,["onChange","modelValue"]),H,(0,l.bF)(u,{modelValue:n.state.ruleForm.ShowDelay,"onUpdate:modelValue":t[2]||(t[2]=e=>n.state.ruleForm.ShowDelay=e),label:"显示延迟",size:"large"},null,8,["modelValue"]),(0,l.bF)(i,{placement:"top",title:"提示",width:400,trigger:"hover",content:"在测试延迟时，如果未连接，将自动去打洞连接，当你有一百个设备时，每个设备都同时去与其它99台设备连接，这数据量不小，所以尽量不要个设备都勾选"},{reference:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:n.state.ruleForm.AutoConnect,"onUpdate:modelValue":t[3]||(t[3]=e=>n.state.ruleForm.AutoConnect=e),label:"自动连接？",size:"large"},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.bF)(d,{prop:"upgrade",style:{"margin-bottom":"0"}},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:n.state.ruleForm.Upgrade,"onUpdate:modelValue":t[4]||(t[4]=e=>n.state.ruleForm.Upgrade=e),label:"我很懂，我要使用高级功能(点对网和网对网)",size:"large"},null,8,["modelValue"])])),_:1}),n.state.ruleForm.Upgrade?((0,l.uX)(),(0,l.CE)("div",J,[(0,l.bF)(d,{prop:"nat",style:{"margin-bottom":"0"}},{default:(0,l.k6)((()=>[Y])),_:1}),(0,l.bF)(d,{label:"此设备局域网IP",prop:"LanIP",style:{"border-bottom":"1px solid #ddd","margin-bottom":"0"}},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.ruleForm.LanIPs,((e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:t,class:"flex",style:{"margin-bottom":".6rem"}},[(0,l.Lk)("div",Z,[(0,l.bF)(s,{modelValue:n.state.ruleForm.LanIPs[t],"onUpdate:modelValue":e=>n.state.ruleForm.LanIPs[t]=e,style:{width:"14rem"}},null,8,["modelValue","onUpdate:modelValue"]),ee,(0,l.bF)(s,{onChange:e=>n.handleMaskChange(t),modelValue:n.state.ruleForm.Masks[t],"onUpdate:modelValue":e=>n.state.ruleForm.Masks[t]=e,style:{width:"4rem"}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),(0,l.Lk)("div",te,[(0,l.bF)(m,{type:"danger",onClick:e=>n.handleDel(t)},{default:(0,l.k6)((()=>[(0,l.bF)(h,null,{default:(0,l.k6)((()=>[(0,l.bF)(c)])),_:1})])),_:2},1032,["onClick"]),(0,l.bF)(m,{type:"primary",onClick:e=>n.handleAdd(t)},{default:(0,l.k6)((()=>[(0,l.bF)(h,null,{default:(0,l.k6)((()=>[(0,l.bF)(p)])),_:1})])),_:2},1032,["onClick"])])])))),128))])),_:1}),(0,l.bF)(d,{prop:"forward",style:{"margin-bottom":"0"}},{default:(0,l.k6)((()=>[ae])),_:1}),(0,l.bF)(d,{label:"端口转发",prop:"forwards"},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.ruleForm.Forwards,((e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:t,class:"flex",style:{"margin-bottom":".6rem"}},[(0,l.Lk)("div",le,[(0,l.bF)(s,{modelValue:e.ListenAddr,"onUpdate:modelValue":t=>e.ListenAddr=t,style:{width:"7rem"},readonly:""},null,8,["modelValue","onUpdate:modelValue"]),(0,l.eW)(" : "),(0,l.bF)(s,{onChange:e=>n.handleForwardChange(t),modelValue:e.ListenPort,"onUpdate:modelValue":t=>e.ListenPort=t,style:{width:"6rem"}},null,8,["onChange","modelValue","onUpdate:modelValue"]),(0,l.eW)(" -> "),(0,l.bF)(s,{modelValue:e.ConnectAddr,"onUpdate:modelValue":t=>e.ConnectAddr=t,style:{width:"14rem"}},null,8,["modelValue","onUpdate:modelValue"]),(0,l.eW)(" : "),(0,l.bF)(s,{onChange:e=>n.handleForwardChange(t),modelValue:e.ConnectPort,"onUpdate:modelValue":t=>e.ConnectPort=t,style:{width:"6rem"}},null,8,["onChange","modelValue","onUpdate:modelValue"])]),(0,l.Lk)("div",ne,[(0,l.bF)(m,{type:"danger",onClick:e=>n.handleDelForward(t)},{default:(0,l.k6)((()=>[(0,l.bF)(h,null,{default:(0,l.k6)((()=>[(0,l.bF)(c)])),_:1})])),_:2},1032,["onClick"]),(0,l.bF)(m,{type:"primary",onClick:e=>n.handleAddForward(t)},{default:(0,l.k6)((()=>[(0,l.bF)(h,null,{default:(0,l.k6)((()=>[(0,l.bF)(p)])),_:1})])),_:2},1032,["onClick"])])])))),128))])),_:1})])):(0,l.Q3)("",!0),(0,l.bF)(d,{label:"",prop:"Btns"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(m,{onClick:t[5]||(t[5]=e=>n.state.show=!1)},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1}),(0,l.bF)(m,{type:"primary",onClick:n.handleSave},{default:(0,l.k6)((()=>[(0,l.eW)("确认")])),_:1},8,["onClick"])])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue"])}var re=a(5241),de=a(1219),se={props:["modelValue"],emits:["change","update:modelValue"],components:{Delete:w.epd,Plus:w.FWt},setup(e,{emit:t}){const a=(0,u.B)(),n=(0,M.W)(),o=(0,i.KR)(null),r=(0,i.Kh)({show:!0,bufferSize:a.value.bufferSize,ruleForm:{IP:n.value.current.IP,LanIPs:n.value.current.LanIPs.slice(0),Masks:n.value.current.Masks.slice(0),PrefixLength:n.value.current.PrefixLength||24,Gateway:n.value.current.Gateway,ShowDelay:n.value.current.ShowDelay,AutoConnect:n.value.current.AutoConnect,Upgrade:n.value.current.Upgrade,Forwards:0==n.value.current.Forwards.length?[{ListenAddr:"0.0.0.0",ListenPort:0,ConnectAddr:"0.0.0.0",ConnectPort:0}]:n.value.current.Forwards.slice(0)},rules:{}});0==r.ruleForm.LanIPs.length&&(r.ruleForm.LanIPs.push(""),r.ruleForm.Masks.push(24)),(0,l.wB)((()=>r.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const d=()=>{var e=+r.ruleForm.PrefixLength;(e>32||e<16||isNaN(e))&&(e=24),r.ruleForm.PrefixLength=e},s=e=>{var t=+r.ruleForm.Masks[e];(t>32||t<16||isNaN(t))&&(t=24),r.ruleForm.Masks[e]=t},c=e=>{r.ruleForm.LanIPs.splice(e,1),r.ruleForm.Masks.splice(e,1),0==r.ruleForm.LanIPs.length&&h(0)},h=e=>{r.ruleForm.LanIPs.splice(e+1,0,""),r.ruleForm.Masks.splice(e+1,0,24)},m=()=>{const e=JSON.parse(JSON.stringify(n.value.current));e.IP=r.ruleForm.IP||"0.0.0.0";const{lanips:a,masks:l}=r.ruleForm.LanIPs.reduce(((e,t,a)=>(t&&r.ruleForm.Masks[a]&&(e.lanips.push(t),e.masks.push(r.ruleForm.Masks[a])),e)),{lanips:[],masks:[]});e.LanIPs=a,e.Masks=l,e.PrefixLength=+r.ruleForm.PrefixLength,e.Gateway=r.ruleForm.Gateway,e.ShowDelay=r.ruleForm.ShowDelay,e.AutoConnect=r.ruleForm.AutoConnect,e.Upgrade=r.ruleForm.Upgrade,e.Forwards=r.ruleForm.Forwards,e.Forwards.forEach((e=>{e.ListenPort=+e.ListenPort,e.ConnectPort=+e.ConnectPort})),(0,re.ac)(e).then((()=>{r.show=!1,de.nk.success("已操作！"),t("change")})).catch((()=>{de.nk.error("操作失败！")}))},p=e=>{r.ruleForm.Forwards.splice(e,1),0==r.ruleForm.Forwards.length&&g(0)},g=e=>{r.ruleForm.Forwards.splice(e+1,0,{ListenAddr:"0.0.0.0",ListenPort:0,ConnectAddr:"0.0.0.0",ConnectPort:0})},f=()=>{};return{state:r,ruleFormRef:o,handlePrefixLengthChange:d,handleMaskChange:s,handleDel:c,handleAdd:h,handleSave:m,handleForwardChange:f,handleDelForward:p,handleAddForward:g}}};const ue=(0,b.A)(se,[["render",oe],["__scopeId","data-v-22dd5fdf"]]);var ie=ue;const ce={key:0},he=["title","onClick"],me=["onClick"];function pe(e,t,a,n,o,r){const d=(0,l.g2)("el-table-column");return(0,l.uX)(),(0,l.Wv)(d,{prop:"tunnel",label:"隧道",width:"90"},{default:(0,l.k6)((e=>[n.tunnel.list[e.row.MachineId]?((0,l.uX)(),(0,l.CE)("div",ce,[(0,l.Lk)("a",{href:"javascript:;",class:(0,L.C4)(["a-line",{yellow:n.tunnel.list[e.row.MachineId].NeedReboot}]),title:n.tunnel.list[e.row.MachineId].NeedReboot?"需要重启":"调整网关层级有助于打洞成功",onClick:t=>n.handleTunnel(n.tunnel.list[e.row.MachineId])},[(0,l.Lk)("span",null,"网关 : "+(0,L.v_)(n.tunnel.list[e.row.MachineId].RouteLevel)+" + "+(0,L.v_)(n.tunnel.list[e.row.MachineId].RouteLevelPlus),1)],10,he)])):(0,l.Q3)("",!0),(0,l.Lk)("div",null,[(0,l.Lk)("a",{href:"javascript:;",title:"与此设备的隧道连接",class:(0,L.C4)(["a-line",{green:n.connectionCount(e.row.MachineId)>0}]),onClick:t=>n.handleConnections(e.row.MachineId)},[(0,l.eW)(" 连接数 : "),(0,l.Lk)("span",null,(0,L.v_)(n.connectionCount(e.row.MachineId)),1)],10,me)])])),_:1})}var ge=a(83);const fe=Symbol(),we=()=>{const e=(0,u.B)(),t=(0,i.KR)({timer:0,showEdit:!1,current:null,list:{},hashcode:0});(0,l.Gt)(fe,t);const a=()=>{e.value.api.connected?(0,ge.r7)(t.value.hashcode.toString()).then((e=>{t.value.hashcode=e.HashCode,e.List&&(t.value.list=e.List),t.value.timer=setTimeout(a,1060)})).catch((()=>{t.value.timer=setTimeout(a,1060)})):t.value.timer=setTimeout(a,1060)},n=e=>{t.value.current=e,t.value.showEdit=!0},o=()=>{(0,ge.gM)(),de.nk.success({message:"刷新成功",grouping:!0})},r=()=>{clearTimeout(t.value.timer)},d=e=>Object.values(t.value.list).sort(((e,t)=>e.RouteLevel+e.RouteLevelPlus-t.RouteLevel+t.RouteLevelPlus)).map((e=>e.MachineId));return{tunnel:t,_getTunnelInfo:a,handleTunnelEdit:n,handleTunnelRefresh:o,clearTunnelTimeout:r,sortTunnel:d}},ve=()=>(0,l.WQ)(fe),ke=(e="0")=>(0,s.zG)("forwardclient/connections",e),be=e=>(0,s.zG)("forwardclient/removeconnection",e),Fe=(e="0")=>(0,s.zG)("forwardclient/get",e),Ce=e=>(0,s.zG)("forwardclient/getremote",e),Le=()=>(0,s.zG)("forwardclient/bindips"),Te=e=>(0,s.zG)("forwardclient/remove",e),ye=e=>(0,s.zG)("forwardclient/add",e),_e=e=>(0,s.zG)("forwardclient/TestTarget",e),Ve=Symbol(),Ie=Symbol(),Se=Symbol(),Ee=()=>{const e=(0,u.B)(),t=(0,i.KR)({showEdit:!1,speedCache:{},current:"",hashcode:0,hashcode1:0});(0,l.Gt)(Ve,t);const a=(0,i.KR)({timer:0,list:{}});(0,l.Gt)(Ie,a);const n=()=>{e.value.api.connected?ke(t.value.hashcode.toString()).then((e=>{t.value.hashcode=e.HashCode,e.List&&(d(e.List,be),a.value.list=e.List),a.value.timer=setTimeout(n,1e3)})).catch((e=>{a.value.timer=setTimeout(n,1e3)})):a.value.timer=setTimeout(n,1e3)},o=(0,i.KR)({timer:0,list:{}});(0,l.Gt)(Se,o);const r=()=>{e.value.api.connected?(0,re.kl)(t.value.hashcode1.toString()).then((e=>{t.value.hashcode1=e.HashCode,e.List&&(d(e.List,re.vB),o.value.list=e.List),o.value.timer=setTimeout(r,1e3)})).catch((e=>{o.value.timer=setTimeout(r,1e3)})):o.value.timer=setTimeout(r,1e3)},d=(e,a)=>{const l=t.value.speedCache;for(let t in e){const n=e[t];n.removeFunc=a;const o=`${n.RemoteMachineId}-${n.TransactionId}`,r=l[o]||{SendBytes:0,ReceiveBytes:0};n.SendBytesText=s(n.SendBytes-r.SendBytes),n.ReceiveBytesText=s(n.ReceiveBytes-r.ReceiveBytes),r.SendBytes=n.SendBytes,r.ReceiveBytes=n.ReceiveBytes,l[o]=r}},s=e=>{let t=0;while(e>=1024)e/=1024,t++;return`${e.toFixed(2)}${["B/s","KB/s","MB/s","GB/s","TB/s"][t]}`},c=e=>{t.value.current=e,t.value.showEdit=!0},h=()=>{clearTimeout(a.value.timer),clearTimeout(o.value.timer)};return{connections:t,forwardConnections:a,_getForwardConnections:n,tuntapConnections:o,_getTuntapConnections:r,handleTunnelConnections:c,clearConnectionsTimeout:h}},Pe=()=>(0,l.WQ)(Ve),Re=()=>(0,l.WQ)(Ie),ze=()=>(0,l.WQ)(Se);var Be={emits:["edit","refresh"],setup(e,{emit:t}){const a=ve(),l=(Pe(),Re()),n=ze(),o=e=>[l.value.list[e],n.value.list[e]].filter((e=>!!e&&e.Connected)).length,r=e=>{t("edit",e)},d=()=>{t("refresh")},s=e=>{t("connections",e)};return{tunnel:a,handleTunnel:r,handleTunnelRefresh:d,connectionCount:o,handleConnections:s}}};const Me=(0,b.A)(Be,[["render",pe],["__scopeId","data-v-c257d30c"]]);var We=Me;const Ue=e=>((0,l.Qi)("data-v-98329976"),e=e(),(0,l.jt)(),e),De=Ue((()=>(0,l.Lk)("div",null,"网关层级为你的设备与外网的距离，你可以手动调整数值",-1))),Ne=Ue((()=>(0,l.Lk)("div",null,"光猫映射了端口后，可以直接连接，把TcpPortMap调到第一",-1))),Xe={class:"t-c w-100"};function xe(e,t,a,n,o,r){const d=(0,l.g2)("el-form-item"),s=(0,l.g2)("el-input"),u=(0,l.g2)("el-col"),i=(0,l.g2)("el-input-number"),c=(0,l.g2)("el-row"),h=(0,l.g2)("el-button"),m=(0,l.g2)("el-form"),p=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(p,{modelValue:n.state.show,"onUpdate:modelValue":t[5]||(t[5]=e=>n.state.show=e),"close-on-click-modal":!1,"append-to":".app-wrap",title:"设置隧道",width:"400"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(m,{ref:"ruleFormRef",model:n.state.ruleForm,rules:n.state.rules,"label-width":"auto"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{label:"",prop:"alert"},{default:(0,l.k6)((()=>[De])),_:1}),(0,l.bF)(d,{label:""},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.bF)(u,{span:12},{default:(0,l.k6)((()=>[(0,l.bF)(d,{label:"网关层级",prop:"RouteLevel"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{readonly:"",modelValue:n.state.ruleForm.RouteLevel,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.ruleForm.RouteLevel=e)},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.bF)(u,{span:12},{default:(0,l.k6)((()=>[(0,l.bF)(d,{label:"调整层级",prop:"RouteLevelPlus"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:n.state.ruleForm.RouteLevelPlus,"onUpdate:modelValue":t[1]||(t[1]=e=>n.state.ruleForm.RouteLevelPlus=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,l.bF)(d,{label:"",prop:"alert"},{default:(0,l.k6)((()=>[Ne])),_:1}),(0,l.bF)(d,{label:""},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.bF)(u,{span:12},{default:(0,l.k6)((()=>[(0,l.bF)(d,{label:"外网端口",prop:"PortMapWan"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:n.state.ruleForm.PortMapWan,"onUpdate:modelValue":t[2]||(t[2]=e=>n.state.ruleForm.PortMapWan=e)},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.bF)(u,{span:12},{default:(0,l.k6)((()=>[(0,l.bF)(d,{label:"内网端口",prop:"PortMapLan"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:n.state.ruleForm.PortMapLan,"onUpdate:modelValue":t[3]||(t[3]=e=>n.state.ruleForm.PortMapLan=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,l.bF)(d,{label:"",prop:"Btns"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",Xe,[(0,l.bF)(h,{onClick:t[4]||(t[4]=e=>n.state.show=!1)},{default:(0,l.k6)((()=>[(0,l.eW)("取消")])),_:1}),(0,l.bF)(h,{type:"primary",onClick:n.handleSave},{default:(0,l.k6)((()=>[(0,l.eW)("确认")])),_:1},8,["onClick"])])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue"])}var Ge={props:["modelValue"],emits:["change","update:modelValue"],setup(e,{emit:t}){const a=ve(),n=(0,i.KR)(null),o=(0,i.Kh)({show:!0,ruleForm:{RouteLevel:a.value.current.RouteLevel,RouteLevelPlus:a.value.current.RouteLevelPlus,PortMapWan:a.value.current.PortMapWan,PortMapLan:a.value.current.PortMapLan},rules:{}});(0,l.wB)((()=>o.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const r=()=>{const e=JSON.parse(JSON.stringify(a.value.current));e.RouteLevel=+o.ruleForm.RouteLevel,e.RouteLevelPlus=+o.ruleForm.RouteLevelPlus,e.PortMapWan=+o.ruleForm.PortMapWan,e.PortMapLan=+o.ruleForm.PortMapLan,(0,ge.KW)(e).then((()=>{o.show=!1,de.nk.success("已操作！"),t("change")})).catch((()=>{de.nk.error("操作失败！")}))};return{state:o,ruleFormRef:n,handleSave:r}}};const Ae=(0,b.A)(Ge,[["render",xe],["__scopeId","data-v-98329976"]]);var Ke=Ae;const Oe={key:0},qe={class:"list forward"},Qe=["onClick"],je={key:1},$e=["onClick"],He={key:1},Je={class:"list sforward"},Ye={key:1};function Ze(e,t,a,n,o,r){const d=(0,l.g2)("el-table-column");return(0,l.uX)(),(0,l.Wv)(d,{prop:"forward",label:"端口转发"},{default:(0,l.k6)((e=>[e.row.isSelf?((0,l.uX)(),(0,l.CE)("div",He,[(0,l.Lk)("ul",Je,[n.sforward.list&&n.sforward.list.length>0?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:0},(0,l.pI)(n.sforward.list.slice(0,5),((e,a)=>((0,l.uX)(),(0,l.CE)("li",{key:a,class:(0,L.C4)({red:!!e.Msg})},[(0,l.Lk)("a",{href:"javascript:;",onClick:t[0]||(t[0]=e=>n.handleSEdit()),class:(0,L.C4)({green:e.Started})},[(0,l.Lk)("span",null,[(0,l.Lk)("span",{class:(0,L.C4)({red:!!e.Msg})},(0,L.v_)(e.Domain||e.RemotePort),3),(0,l.eW)(" -> "),(0,l.Lk)("span",{class:(0,L.C4)({red:!!e.LocalMsg})},(0,L.v_)(e.LocalEP),3)])],2),(0,l.Lk)("span",null," ("+(0,L.v_)(1<<e.BufferSize)+"KB)",1)],2)))),128)):((0,l.uX)(),(0,l.CE)("li",Ye,[(0,l.Lk)("a",{href:"javascript:;",title:"管理你的服务器穿透",onClick:t[1]||(t[1]=e=>n.handleSEdit())},"暂无配置")]))])])):((0,l.uX)(),(0,l.CE)("div",Oe,[(0,l.Lk)("ul",qe,[n.forward.list[e.row.MachineId]&&n.forward.list[e.row.MachineId].length>0?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:0},(0,l.pI)(n.forward.list[e.row.MachineId],((t,a)=>((0,l.uX)(),(0,l.CE)("li",{key:a},[(0,l.Lk)("a",{href:"javascript:;",onClick:t=>n.handleEdit(e.row.MachineId),class:(0,L.C4)({green:t.Started})},[(0,l.Lk)("span",null,[(0,l.Lk)("span",{class:(0,L.C4)({red:!!t.Msg})},(0,L.v_)(t.Port),3),(0,l.eW)(" -> "),(0,l.Lk)("span",{class:(0,L.C4)({red:!!t.TargetMsg})},(0,L.v_)(t.TargetEP),3)])],10,Qe),(0,l.Lk)("span",null," ("+(0,L.v_)(1<<t.BufferSize)+"KB)",1)])))),128)):((0,l.uX)(),(0,l.CE)("li",je,[(0,l.Lk)("a",{href:"javascript:;",title:"管理你的端口转发",onClick:t=>n.handleEdit(e.row.MachineId)},"暂无配置",8,$e)]))])]))])),_:1})}const et=Symbol(),tt=()=>{const e=(0,u.B)(),t=(0,i.KR)({timer:0,showEdit:!1,showCopy:!1,current:null,list:{},testTimer:0,testTargetTimer:0,hashcode:0,hashcode1:0});(0,l.Gt)(et,t);const a=()=>{e.value.api.connected?Fe(t.value.hashcode.toString()).then((e=>{t.value.hashcode=e.HashCode,e.List&&(t.value.list=e.List),t.value.timer=setTimeout(a,1020)})).catch((()=>{t.value.timer=setTimeout(a,1020)})):t.value.timer=setTimeout(a,1020)},n=(e,a)=>{t.value.current=e,t.value.machineName=a,t.value.showEdit=!0},o=()=>{clearTimeout(t.value.testTargetTimer),_e(t.value.current).then((e=>{t.value.testTargetTimer=setTimeout(o,5e3)})).catch((()=>{t.value.testTargetTimer=setTimeout(o,5e3)}))},r=()=>{clearTimeout(t.value.timer),clearTimeout(t.value.testTimer),clearTimeout(t.value.testTargetTimer)},d=e=>Object.values(t.value.list).reduce(((e,t)=>(e=e.concat(t),e)),[]).filter((t=>(t.Name||"").indexOf(e)>=0||(t.BindIPAddress||"").indexOf(e)>=0||t.Port.toString().indexOf(e)>=0||(t.TargetEP||"").indexOf(e)>=0)).map((e=>e.MachineId));return{forward:t,_getForwardInfo:a,handleForwardEdit:n,_testTargetForwardInfo:o,clearForwardTimeout:r,getForwardMachines:d}},at=()=>(0,l.WQ)(et);var lt=a(743);const nt=Symbol(),ot=()=>{const e=(0,u.B)(),t=(0,l.EW)((()=>e.value.config.Client.Id)),a=(0,i.KR)({timer:0,showEdit:!1,showCopy:!1,list:[],testTimer:0,hashcode:0});(0,l.Gt)(nt,a);const n=()=>{e.value.api.connected?(0,lt.pY)(a.value.hashcode.toString()).then((e=>{a.value.hashcode=e.HashCode,e.List&&(a.value.list=e.List),a.value.timer=setTimeout(n,1040)})).catch((()=>{a.value.timer=setTimeout(n,1040)})):a.value.timer=setTimeout(n,1040)},o=()=>{a.value.showEdit=!0},r=()=>{clearTimeout(a.value.testTimer),(0,lt.eX)().then((e=>{a.value.testTimer=setTimeout(r,5e3)})).catch((()=>{a.value.testTimer=setTimeout(r,5e3)}))},d=()=>{clearTimeout(a.value.timer),clearTimeout(a.value.testTimer)},s=e=>{const l=a.value.list.filter((t=>(t.Name||"").indexOf(e)>=0||(t.Domain||"").indexOf(e)>=0||t.RemotePort.toString().indexOf(e)>=0||t.LocalEP.indexOf(e)>=0));return l.length>0?[t.value]:[]};return{sforward:a,_getSForwardInfo:n,handleSForwardEdit:o,_testLocalSForwardInfo:r,clearSForwardTimeout:d,getSForwardMachines:s}},rt=()=>(0,l.WQ)(nt);var dt={emits:["edit","sedit"],setup(e,{emit:t}){const a=at(),l=rt(),n=e=>{t("edit",e)},o=()=>{t("sedit")},r=()=>{t("refresh")};return{forward:a,sforward:l,handleEdit:n,handleSEdit:o,handleForwardRefresh:r}}};const st=(0,b.A)(dt,[["render",Ze],["__scopeId","data-v-36ba4048"]]);var ut=st;const it={class:"t-c head"},ct={class:"error red"},ht={class:"error red"};function mt(e,t,a,n,o,r){const d=(0,l.g2)("el-button"),s=(0,l.g2)("el-input"),u=(0,l.g2)("el-table-column"),i=(0,l.g2)("el-option"),c=(0,l.g2)("el-select"),h=(0,l.g2)("WarnTriangleFilled"),m=(0,l.g2)("el-icon"),p=(0,l.g2)("el-popover"),g=(0,l.g2)("el-switch"),f=(0,l.g2)("Delete"),w=(0,l.g2)("el-popconfirm"),v=(0,l.g2)("el-table"),k=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(k,{modelValue:n.state.show,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.show=e),onOpen:n.handleOnShowList,"append-to":".app-wrap",title:`端口转发到【${n.state.machineName}】`,top:"1vh",width:"700"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.Lk)("div",it,[(0,l.bF)(d,{type:"success",size:"small",onClick:n.handleAdd},{default:(0,l.k6)((()=>[(0,l.eW)("添加")])),_:1},8,["onClick"]),(0,l.bF)(d,{size:"small",onClick:n.handleRefresh},{default:(0,l.k6)((()=>[(0,l.eW)("刷新")])),_:1},8,["onClick"]),(0,l.bF)(d,{size:"small",onClick:n.handleCopy},{default:(0,l.k6)((()=>[(0,l.eW)("复制转发配置")])),_:1},8,["onClick"])]),(0,l.bF)(v,{data:n.state.data,size:"small",border:"",height:"500",onCellDblclick:n.handleCellClick},{default:(0,l.k6)((()=>[(0,l.bF)(u,{property:"Name",label:"名称"},{default:(0,l.k6)((e=>[e.row.NameEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(s,{key:0,autofocus:"",size:"small",modelValue:e.row.Name,"onUpdate:modelValue":t=>e.row.Name=t,onBlur:t=>n.handleEditBlur(e.row,"Name")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.eW)((0,L.v_)(e.row.Name),1)],64))])),_:1}),(0,l.bF)(u,{prop:"BufferSize",label:"缓冲区",width:"100"},{default:(0,l.k6)((e=>[(0,l.bF)(c,{modelValue:e.row.BufferSize,"onUpdate:modelValue":t=>e.row.BufferSize=t,placeholder:"Select",size:"small",disabled:e.row.Started,onChange:t=>n.handleEditBlur(e.row,"BufferSize")},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.bufferSize,((e,t)=>((0,l.uX)(),(0,l.Wv)(i,{key:t,label:e,value:t},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"])])),_:1}),(0,l.bF)(u,{property:"BindIPAddress",label:"监听IP",width:"140"},{default:(0,l.k6)((e=>[(0,l.bF)(c,{modelValue:e.row.BindIPAddress,"onUpdate:modelValue":t=>e.row.BindIPAddress=t,size:"small",disabled:e.row.Started},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.ips,(e=>((0,l.uX)(),(0,l.Wv)(i,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])])),_:1}),(0,l.bF)(u,{property:"Port",label:"监听端口",width:"80"},{default:(0,l.k6)((e=>[e.row.PortEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(s,{key:0,type:"number",autofocus:"",size:"small",modelValue:e.row.Port,"onUpdate:modelValue":t=>e.row.Port=t,onBlur:t=>n.handleEditBlur(e.row,"Port")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[e.row.Msg?((0,l.uX)(),(0,l.Wv)(p,{key:0,placement:"top",title:"msg",width:"20rem",trigger:"hover",content:e.row.Msg},{reference:(0,l.k6)((()=>[(0,l.Lk)("div",ct,[(0,l.Lk)("span",null,(0,L.v_)(e.row.Port),1),(0,l.bF)(m,{size:"20"},{default:(0,l.k6)((()=>[(0,l.bF)(h)])),_:1})])])),_:2},1032,["content"])):((0,l.uX)(),(0,l.CE)("span",{key:1,class:(0,L.C4)({green:e.row.Started})},(0,L.v_)(e.row.Port),3))],64))])),_:1}),(0,l.bF)(u,{property:"TargetEP",label:"目标服务",width:"140"},{default:(0,l.k6)((e=>[e.row.TargetEPEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(s,{key:0,autofocus:"",size:"small",modelValue:e.row.TargetEP,"onUpdate:modelValue":t=>e.row.TargetEP=t,onBlur:t=>n.handleEditBlur(e.row,"TargetEP")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[e.row.TargetMsg?((0,l.uX)(),(0,l.Wv)(p,{key:0,placement:"top",title:"msg",width:"20rem",trigger:"hover",content:e.row.TargetMsg},{reference:(0,l.k6)((()=>[(0,l.Lk)("span",ht,(0,L.v_)(e.row.TargetEP),1),(0,l.bF)(m,{size:"20"},{default:(0,l.k6)((()=>[(0,l.bF)(h)])),_:1})])),_:2},1032,["content"])):((0,l.uX)(),(0,l.CE)("span",{key:1,class:(0,L.C4)({green:e.row.Started})},(0,L.v_)(e.row.TargetEP),3))],64))])),_:1}),(0,l.bF)(u,{property:"Started",label:"状态",width:"60"},{default:(0,l.k6)((e=>[(0,l.bF)(g,{modelValue:e.row.Started,"onUpdate:modelValue":t=>e.row.Started=t,onChange:t=>n.handleStartChange(e.row),"inline-prompt":"","active-text":"开","inactive-text":"关"},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,l.bF)(u,{label:"操作",width:"54"},{default:(0,l.k6)((e=>[(0,l.bF)(w,{"confirm-button-text":"确认","cancel-button-text":"取消",title:"删除不可逆，是否确认?",onConfirm:t=>n.handleDel(e.row.Id)},{reference:(0,l.k6)((()=>[(0,l.bF)(d,{type:"danger",size:"small"},{default:(0,l.k6)((()=>[(0,l.bF)(m,null,{default:(0,l.k6)((()=>[(0,l.bF)(f)])),_:1})])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data","onCellDblclick"])])])),_:1},8,["modelValue","onOpen","title"])}var pt={props:["data","modelValue"],emits:["update:modelValue"],components:{WarnTriangleFilled:w.DtC,Delete:w.epd},setup(e,{emit:t}){const a=(0,u.B)(),n=at(),o=(0,i.Kh)({show:!0,machineId:n.value.current,machineName:n.value.machineName,data:[],ips:[],timerTestTarget:0,timerTestListen:0,bufferSize:a.value.bufferSize});(0,l.wB)((()=>o.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const r=()=>{Le().then((e=>{e.splice(0,0,"127.0.0.1"),e.splice(0,0,"0.0.0.0"),o.ips=e})).catch((()=>{}))},d=()=>{_e(n.value.current).then((e=>{o.timerTestTarget=setTimeout(d,1e3)})).catch((()=>{o.timerTestTarget=setTimeout(d,1e3)}))},s=()=>{Fe().then((e=>{e.List&&(o.data=e.List[o.machineId]||[])})).catch((()=>{}))},c=()=>{s()},h=(e,t)=>{g(e,t.property)},m=()=>{s(),de.nk.success("已刷新")},p=()=>{k({ID:0,Name:"",Port:0,TargetEP:"127.0.0.1:80",machineId:o.machineId})},g=(e,t)=>{e.Started?de.nk.error("请先停止"):(o.data.forEach((e=>{e["NameEditing"]=!1,e["PortEditing"]=!1,e["TargetEPEditing"]=!1,e["BindIPAddressEditing"]=!1})),e[`${t}Editing`]=!0)},f=(e,t)=>{e.Started?de.nk.error("请先停止"):(e[`${t}Editing`]=!1,k(e))},w=e=>{Te(e).then((()=>{s()}))},v=e=>{k(e)},k=e=>{e.Port=parseInt(e.Port),ye(e).then((()=>{s()})).catch((e=>{de.nk.error(e)}))},b=()=>{n.value.showCopy=!0};return(0,l.sV)((()=>{s(),r(),d()})),(0,l.hi)((()=>{clearTimeout(o.timerTestTarget),clearTimeout(o.timerTestListen)})),{state:o,handleOnShowList:c,handleCellClick:h,handleRefresh:m,handleAdd:p,handleEdit:g,handleEditBlur:f,handleDel:w,handleStartChange:v,handleCopy:b}}};const gt=(0,b.A)(pt,[["render",mt],["__scopeId","data-v-2c1a8404"]]);var ft=gt;const wt=e=>((0,l.Qi)("data-v-3a13c86f"),e=e(),(0,l.jt)(),e),vt={class:"t-c head"},kt=wt((()=>(0,l.Lk)("span",null,"复制",-1))),bt={class:"t-c"},Ft={class:"page-wrap"},Ct={class:"foot t-c"};function Lt(e,t,a,n,o,r){const d=(0,l.g2)("el-pagination"),s=(0,l.g2)("el-option"),u=(0,l.g2)("el-select"),i=(0,l.g2)("el-table-column"),c=(0,l.g2)("el-checkbox"),h=(0,l.g2)("el-table"),m=(0,l.g2)("el-button"),p=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(p,{modelValue:n.state.show,"onUpdate:modelValue":t[1]||(t[1]=e=>n.state.show=e),onOpen:n.handleOnShowList,"append-to":".app-wrap",title:"复制端口转发",top:"1vh",width:"500"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.Lk)("div",vt,[kt,(0,l.bF)(u,{modelValue:n.state.machineId,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.machineId=e),onChange:n.handleMachineChange,filterable:"",remote:"",loading:n.state.loading,"remote-method":n.handleSearch},{header:(0,l.k6)((()=>[(0,l.Lk)("div",bt,[(0,l.Lk)("div",Ft,[(0,l.bF)(d,{small:"",background:"",layout:"prev, pager, next","page-size":n.state.machineIds.Request.Size,total:n.state.machineIds.Count,"pager-count":5,"current-page":n.state.machineIds.Request.Page,onCurrentChange:n.handlePageChange},null,8,["page-size","total","current-page","onCurrentChange"])])])])),default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.machineIds.List,((e,t)=>((0,l.uX)(),(0,l.Wv)(s,{key:t,label:e.MachineName,value:e.MachineId},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange","loading","remote-method"]),(0,l.Lk)("span",null,"到【"+(0,L.v_)(n.state.toMachineName)+"】的端口转发记录",1)]),(0,l.bF)(h,{data:n.state.forwards,size:"small",border:""},{default:(0,l.k6)((()=>[(0,l.bF)(i,{property:"Name",label:"名称"}),(0,l.bF)(i,{prop:"BufferSize",label:"缓冲区",width:"60"},{default:(0,l.k6)((e=>[(0,l.eW)((0,L.v_)(1<<e.row.BufferSize)+"KB ",1)])),_:1}),(0,l.bF)(i,{property:"Port",label:"监听端口",width:"80"}),(0,l.bF)(i,{property:"TargetEP",label:"目标服务",width:"140"}),(0,l.bF)(i,{label:"操作",width:"80"},{default:(0,l.k6)((e=>[(0,l.bF)(c,{modelValue:e.row.use,"onUpdate:modelValue":t=>e.row.use=t},{default:(0,l.k6)((()=>[(0,l.eW)("使用")])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"]),(0,l.Lk)("div",Ct,[(0,l.bF)(m,{type:"primary",onClick:n.handleConfirm},{default:(0,l.k6)((()=>[(0,l.eW)("确定复制")])),_:1},8,["onClick"])])])])),_:1},8,["modelValue","onOpen"])}var Tt={props:["modelValue"],emits:["update:modelValue"],components:{WarnTriangleFilled:w.DtC},setup(e,{emit:t}){(0,u.B)();const a=at(),n=(0,i.Kh)({show:!0,loading:!1,machineId:"",toMachineId:a.value.current,toMachineName:a.value.machineName,machineIds:{Request:{Page:1,Size:10,Name:""},Count:0,List:[]},forwards:[]});(0,l.wB)((()=>n.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const o=()=>{r()},r=()=>{n.loading=!0,(0,g.BS)(n.machineIds.Request).then((e=>{n.loading=!1,n.machineIds.Request=e.Request,n.machineIds.Count=e.Count,n.machineIds.List=e.List,!n.machineId&&n.machineIds.List.length>0&&(n.machineId=n.machineIds.List[0].MachineId,c())})).catch((e=>{n.loading=!1}))},d=e=>{n.machineIds.Request.Page=e,r()},s=e=>{n.machineIds.Request.Name=e,r()},c=()=>{Ce({MachineId:n.machineId,ToMachineId:n.toMachineId}).then((e=>{e.forEach((e=>{e.use=!0})),n.forwards=e})).catch((e=>{console.log(e)}))},h=()=>{c()},m=()=>{const e=n.forwards.filter((e=>e.use)).map((e=>ye({Name:e.Name,Port:e.Port,TargetEP:e.TargetEP,BufferSize:e.BufferSize,MachineId:n.toMachineId})));Promise.all(e).then((()=>{de.nk.success("已操作!"),n.show=!1})).catch((()=>{de.nk.success("操作失败!")}))};return(0,l.sV)((()=>{r()})),(0,l.hi)((()=>{})),{state:n,handleSearch:s,handleOnShowList:o,handleMachineChange:h,handleConfirm:m,handlePageChange:d}}};const yt=(0,b.A)(Tt,[["render",Lt],["__scopeId","data-v-3a13c86f"]]);var _t=yt;const Vt={class:"t-c head"},It={class:"error red"},St={class:"error red"};function Et(e,t,a,n,o,r){const d=(0,l.g2)("el-button"),s=(0,l.g2)("el-input"),u=(0,l.g2)("el-table-column"),i=(0,l.g2)("WarnTriangleFilled"),c=(0,l.g2)("el-icon"),h=(0,l.g2)("el-popover"),m=(0,l.g2)("el-switch"),p=(0,l.g2)("Delete"),g=(0,l.g2)("el-popconfirm"),f=(0,l.g2)("el-table"),w=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(w,{modelValue:n.state.show,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.show=e),onOpen:n.handleOnShowList,"append-to":".app-wrap",title:"服务器代理穿透",top:"1vh",width:"700"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.Lk)("div",Vt,[(0,l.bF)(d,{type:"success",size:"small",onClick:n.handleAdd},{default:(0,l.k6)((()=>[(0,l.eW)("添加")])),_:1},8,["onClick"]),(0,l.bF)(d,{size:"small",onClick:n.handleRefresh},{default:(0,l.k6)((()=>[(0,l.eW)("刷新")])),_:1},8,["onClick"]),(0,l.bF)(d,{size:"small",onClick:n.handleCopy},{default:(0,l.k6)((()=>[(0,l.eW)("复制穿透配置")])),_:1},8,["onClick"])]),(0,l.bF)(f,{data:n.state.data,size:"small",border:"",height:"500",onCellDblclick:n.handleCellClick},{default:(0,l.k6)((()=>[(0,l.bF)(u,{property:"Name",label:"名称"},{default:(0,l.k6)((e=>[e.row.NameEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(s,{key:0,autofocus:"",size:"small",modelValue:e.row.Name,"onUpdate:modelValue":t=>e.row.Name=t,onBlur:t=>n.handleEditBlur(e.row,"Name")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.eW)((0,L.v_)(e.row.Name),1)],64))])),_:1}),(0,l.bF)(u,{prop:"BufferSize",label:"缓冲区",width:"100"},{default:(0,l.k6)((e=>[(0,l.Lk)("span",null,(0,L.v_)(1<<e.row.BufferSize)+"KB",1)])),_:1}),(0,l.bF)(u,{property:"Temp",label:"远程端口/域名",width:"160"},{default:(0,l.k6)((e=>[e.row.TempEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(s,{key:0,autofocus:"",size:"small",modelValue:e.row.Temp,"onUpdate:modelValue":t=>e.row.Temp=t,onBlur:t=>n.handleEditBlur(e.row,"Temp")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[e.row.Msg?((0,l.uX)(),(0,l.Wv)(h,{key:0,placement:"top",title:"msg",width:"20rem",trigger:"hover",content:e.row.Msg},{reference:(0,l.k6)((()=>[(0,l.Lk)("div",It,[(0,l.Lk)("span",null,(0,L.v_)(e.row.Temp),1),(0,l.bF)(c,{size:"20"},{default:(0,l.k6)((()=>[(0,l.bF)(i)])),_:1})])])),_:2},1032,["content"])):((0,l.uX)(),(0,l.CE)("span",{key:1,class:(0,L.C4)({green:e.row.Started})},(0,L.v_)(e.row.Temp),3))],64))])),_:1}),(0,l.bF)(u,{property:"LocalEP",label:"本机服务",width:"140"},{default:(0,l.k6)((e=>[e.row.LocalEPEditing&&0==e.row.Started?((0,l.uX)(),(0,l.Wv)(s,{key:0,autofocus:"",size:"small",modelValue:e.row.LocalEP,"onUpdate:modelValue":t=>e.row.LocalEP=t,onBlur:t=>n.handleEditBlur(e.row,"LocalEP")},null,8,["modelValue","onUpdate:modelValue","onBlur"])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[e.row.LocalMsg?((0,l.uX)(),(0,l.Wv)(h,{key:0,placement:"top",title:"msg",width:"20rem",trigger:"hover",content:e.row.LocalMsg},{reference:(0,l.k6)((()=>[(0,l.Lk)("span",St,(0,L.v_)(e.row.LocalEP),1),(0,l.bF)(c,{size:"20"},{default:(0,l.k6)((()=>[(0,l.bF)(i)])),_:1})])),_:2},1032,["content"])):((0,l.uX)(),(0,l.CE)("span",{key:1,class:(0,L.C4)({green:e.row.Started})},(0,L.v_)(e.row.LocalEP),3))],64))])),_:1}),(0,l.bF)(u,{property:"Started",label:"状态",width:"60"},{default:(0,l.k6)((e=>[(0,l.bF)(m,{modelValue:e.row.Started,"onUpdate:modelValue":t=>e.row.Started=t,onChange:t=>n.handleStartChange(e.row),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,l.bF)(u,{label:"操作",width:"54"},{default:(0,l.k6)((e=>[(0,l.bF)(g,{"confirm-button-text":"确认","cancel-button-text":"取消",title:"删除不可逆，是否确认?",onConfirm:t=>n.handleDel(e.row.Id)},{reference:(0,l.k6)((()=>[(0,l.bF)(d,{type:"danger",size:"small"},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.bF)(p)])),_:1})])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data","onCellDblclick"])])])),_:1},8,["modelValue","onOpen"])}var Pt={props:["data","modelValue"],emits:["update:modelValue"],components:{WarnTriangleFilled:w.DtC,Delete:w.epd},setup(e,{emit:t}){const a=(0,u.B)(),n=rt(),o=(0,i.Kh)({bufferSize:a.value.bufferSize,show:!0,data:[],timerTestLocal:0});(0,l.wB)((()=>o.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const r=()=>{(0,lt.eX)().then((e=>{o.timerTestLocal=setTimeout(r,1e3)})).catch((()=>{o.timerTestLocal=setTimeout(r,1e3)}))},d=()=>{(0,lt.pY)().then((e=>{let t=e.List||[];t.forEach((e=>{e.Temp=(e.Domain||e.RemotePort).toString(),e.RemotePort=0,e.Domain=""})),o.data=t})).catch((()=>{}))},s=()=>{d()},c=(e,t)=>{p(e,t.property)},h=()=>{d(),de.nk.success("已刷新")},m=()=>{(0,lt.Qs)({Id:0,Name:"",RemotePort:0,LocalEP:"127.0.0.1:80",Domain:"",Temp:""}).then((()=>{setTimeout((()=>{d()}),100)})).catch((e=>{de.nk.error(e)}))},p=(e,t)=>{e.Started?de.nk.error("请先停止运行"):(o.data.forEach((e=>{e["NameEditing"]=!1,e["RemotePortEditing"]=!1,e["LocalEPEditing"]=!1,e["DomainEditing"]=!1,e["TempEditing"]=!1})),e[`${t}Editing`]=!0)},g=(e,t)=>{e.Started?de.nk.error("请先停止运行"):(e[`${t}Editing`]=!1,v(e))},f=e=>{(0,lt.DY)(e).then((()=>{d()}))},w=e=>{v(e)},v=e=>{e.Temp&&(/^\d+$/.test(e.Temp)?e.RemotePort=parseInt(e.Temp):e.Domain=e.Temp,(0,lt.Qs)(e).then((()=>{setTimeout((()=>{d()}),100)})).catch((e=>{de.nk.error(e)})))},k=()=>{n.value.showCopy=!0},b=()=>{const e=(t=1e4)=>{if(t>2e4)return;const a={Name:`s-${t}`,RemotePort:t,LocalEP:"127.0.0.1:80",Started:!0};(0,lt.Qs)(a).then((a=>{setTimeout((()=>{e(++t)}),50)})).catch((a=>{console.log(a),de.nk.error(a),setTimeout((()=>{e(++t)}),100)}))};e()};return(0,l.sV)((()=>{d(),r()})),(0,l.hi)((()=>{clearTimeout(o.timerTestLocal)})),{state:o,handleOnShowList:s,handleCellClick:c,handleRefresh:h,handleAdd:m,handleEdit:p,handleEditBlur:g,handleDel:f,handleStartChange:w,handleCopy:k,handle10000:b}}};const Rt=(0,b.A)(Pt,[["render",Et],["__scopeId","data-v-5e37381c"]]);var zt=Rt;const Bt=e=>((0,l.Qi)("data-v-5512121a"),e=e(),(0,l.jt)(),e),Mt={class:"t-c head"},Wt=Bt((()=>(0,l.Lk)("span",null,"复制",-1))),Ut={class:"t-c"},Dt={class:"page-wrap"},Nt=Bt((()=>(0,l.Lk)("span",null,"的服务器代理穿透记录",-1))),Xt={class:"foot t-c"};function xt(e,t,a,n,o,r){const d=(0,l.g2)("el-pagination"),s=(0,l.g2)("el-option"),u=(0,l.g2)("el-select"),i=(0,l.g2)("el-table-column"),c=(0,l.g2)("el-checkbox"),h=(0,l.g2)("el-table"),m=(0,l.g2)("el-button"),p=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(p,{modelValue:n.state.show,"onUpdate:modelValue":t[1]||(t[1]=e=>n.state.show=e),onOpen:n.handleOnShowList,"append-to":".app-wrap",title:"复制服务器代理穿透",top:"1vh",width:"500"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.Lk)("div",Mt,[Wt,(0,l.bF)(u,{modelValue:n.state.machineId,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.machineId=e),onChange:n.handleMachineChange,filterable:"",remote:"",loading:n.state.loading,"remote-method":n.handleSearch},{header:(0,l.k6)((()=>[(0,l.Lk)("div",Ut,[(0,l.Lk)("div",Dt,[(0,l.bF)(d,{small:"",background:"",layout:"prev, pager, next","page-size":n.state.machineIds.Request.Size,total:n.state.machineIds.Count,"pager-count":5,"current-page":n.state.machineIds.Request.Page,onCurrentChange:n.handlePageChange},null,8,["page-size","total","current-page","onCurrentChange"])])])])),default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.state.machineIds.List,((e,t)=>((0,l.uX)(),(0,l.Wv)(s,{key:t,label:e.MachineName,value:e.MachineId},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange","loading","remote-method"]),Nt]),(0,l.bF)(h,{data:n.state.forwards,size:"small",border:""},{default:(0,l.k6)((()=>[(0,l.bF)(i,{property:"Name",label:"名称"}),(0,l.bF)(i,{property:"Domain",label:"域名/端口"},{default:(0,l.k6)((e=>[(0,l.Lk)("span",null,(0,L.v_)(e.row.Domain||e.row.RemotePort),1)])),_:1}),(0,l.bF)(i,{property:"LocalEP",label:"本机服务",width:"140"}),(0,l.bF)(i,{label:"操作",width:"80"},{default:(0,l.k6)((e=>[(0,l.bF)(c,{modelValue:e.row.use,"onUpdate:modelValue":t=>e.row.use=t},{default:(0,l.k6)((()=>[(0,l.eW)("使用")])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"]),(0,l.Lk)("div",Xt,[(0,l.bF)(m,{type:"primary",onClick:n.handleConfirm},{default:(0,l.k6)((()=>[(0,l.eW)("确定复制")])),_:1},8,["onClick"])])])])),_:1},8,["modelValue","onOpen"])}var Gt={props:["modelValue"],emits:["update:modelValue"],components:{WarnTriangleFilled:w.DtC},setup(e,{emit:t}){(0,u.B)();const a=(0,i.Kh)({show:!0,loading:!1,machineId:"",machineIds:{Request:{Page:1,Size:10,Name:""},Count:0,List:[]},forwards:[]});(0,l.wB)((()=>a.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e)}),300)}));const n=()=>{o()},o=()=>{a.loading=!0,(0,g.BS)(a.machineIds.Request).then((e=>{a.loading=!1,a.machineIds.Request=e.Request,a.machineIds.Count=e.Count,a.machineIds.List=e.List,!a.machineId&&a.machineIds.List.length>0&&(a.machineId=a.machineIds.List[0].MachineId,s())})).catch((e=>{a.loading=!1}))},r=e=>{a.machineIds.Request.Page=e,o()},d=e=>{a.machineIds.Request.Name=e,o()},s=()=>{(0,lt.$U)(a.machineId).then((e=>{e.forEach((e=>{e.use=!0})),a.forwards=e})).catch((e=>{console.log(e)}))},c=()=>{s()},h=()=>{const e=a.forwards.filter((e=>e.use)).map((e=>(0,lt.Qs)({Name:e.Name,Domain:e.Domain,RemotePort:e.RemotePort,LocalEP:e.LocalEP})));Promise.all(e).then((()=>{de.nk.success("已操作!"),a.show=!1})).catch((()=>{de.nk.success("操作失败!")}))};return(0,l.sV)((()=>{o()})),(0,l.hi)((()=>{})),{state:a,handleSearch:d,handleOnShowList:n,handleMachineChange:c,handleConfirm:h,handlePageChange:r}}};const At=(0,b.A)(Gt,[["render",xt],["__scopeId","data-v-5512121a"]]);var Kt=At;function Ot(e,t,a,n,o,r){const d=(0,l.g2)("el-table-column"),s=(0,l.g2)("Delete"),u=(0,l.g2)("el-icon"),i=(0,l.g2)("el-button"),c=(0,l.g2)("el-popconfirm"),h=(0,l.g2)("el-table"),m=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(m,{modelValue:n.state.show,"onUpdate:modelValue":t[0]||(t[0]=e=>n.state.show=e),"append-to":".app-wrap",title:"隧道链接",top:"1vh",width:"700"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(h,{data:n.state.data,size:"small",border:"",height:"500"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{property:"RemoteMachineId",label:"目标"},{default:(0,l.k6)((e=>[(0,l.Lk)("div",{class:(0,L.C4)({green:e.row.Connected})},[(0,l.Lk)("p",null,(0,L.v_)(e.row.IPEndPoint),1),(0,l.Lk)("p",null,"ssl : "+(0,L.v_)(e.row.SSL),1)],2)])),_:1}),(0,l.bF)(d,{property:"TransactionId",label:"事务",width:"80"},{default:(0,l.k6)((e=>[(0,l.Lk)("span",null,(0,L.v_)(n.state.transactions[e.row.TransactionId]),1)])),_:1}),(0,l.bF)(d,{property:"TransportName",label:"协议"},{default:(0,l.k6)((e=>[(0,l.Lk)("div",null,[(0,l.Lk)("p",null,(0,L.v_)(e.row.TransportName)+"("+(0,L.v_)(n.state.protocolTypes[e.row.ProtocolType])+")",1),(0,l.Lk)("p",null,(0,L.v_)(n.state.types[e.row.Type])+" - "+(0,L.v_)(1<<e.row.BufferSize)+"KB",1)])])),_:1}),(0,l.bF)(d,{property:"Delay",label:"延迟",width:"80"},{default:(0,l.k6)((e=>[(0,l.Lk)("span",null,(0,L.v_)(e.row.Delay)+"ms",1)])),_:1}),(0,l.bF)(d,{property:"Bytes",label:"通信"},{default:(0,l.k6)((e=>[(0,l.Lk)("div",null,[(0,l.Lk)("p",null,"up : "+(0,L.v_)(e.row.SendBytesText),1),(0,l.Lk)("p",null,"down : "+(0,L.v_)(e.row.ReceiveBytesText),1)])])),_:1}),(0,l.bF)(d,{label:"操作",width:"54"},{default:(0,l.k6)((e=>[(0,l.bF)(c,{"confirm-button-text":"确认","cancel-button-text":"取消",title:"确定关闭此连接?",onConfirm:t=>n.handleDel(e.row)},{reference:(0,l.k6)((()=>[(0,l.bF)(i,{type:"danger",size:"small"},{default:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(s)])),_:1})])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])])])),_:1},8,["modelValue"])}var qt={props:["modelValue"],emits:["change","update:modelValue"],components:{Delete:w.epd},setup(e,{emit:t}){const a=Pe(),n=Re(),o=ze(),r=(0,i.Kh)({show:!0,protocolTypes:{1:"tcp",2:"udp",4:"msquic"},types:{0:"打洞",1:"中继"},transactions:{forward:"端口转发",tuntap:"虚拟网卡"},data:(0,l.EW)((()=>[n.value.list[a.value.current],o.value.list[a.value.current]].filter((e=>!!e))))});(0,l.wB)((()=>r.show),(e=>{e||setTimeout((()=>{t("update:modelValue",e),t("change")}),300)}));const d=e=>{e.removeFunc(e.RemoteMachineId).then((()=>{de.nk.success("删除成功")})).catch((()=>{}))};return{state:r,handleDel:d}}};const Qt=(0,b.A)(qt,[["render",Ot],["__scopeId","data-v-4760aa5d"]]);var jt=Qt,$t=a(7985),Ht={components:{Oper:C,Device:X,DeviceEdit:x.A,Tunnel:We,TunnelEdit:Ke,ConnectionsEdit:jt,Tuntap:Q,TuntapEdit:ie,Forward:ut,ForwardEdit:ft,ForwardCopy:_t,SForwardEdit:zt,SForwardCopy:Kt},setup(e){const t=(0,u.B)(),a=(0,i.Kh)({height:(0,l.EW)((()=>t.value.height-90))}),{devices:n,machineId:o,_getSignList:r,_getSignList1:d,handleDeviceEdit:c,handlePageChange:h,handlePageSizeChange:m,handleDel:p,clearDevicesTimeout:g,setSort:f}=(0,$t.r)(),{tuntap:w,_getTuntapInfo:v,handleTuntapEdit:k,handleTuntapRefresh:b,clearTuntapTimeout:F,getTuntapMachines:C,sortTuntapIP:L}=(0,M.O)(),{tunnel:T,_getTunnelInfo:y,handleTunnelEdit:_,handleTunnelRefresh:V,clearTunnelTimeout:I,sortTunnel:S}=we(),{forward:E,_getForwardInfo:P,handleForwardEdit:R,_testTargetForwardInfo:z,clearForwardTimeout:W,getForwardMachines:U}=tt(),{sforward:D,_getSForwardInfo:N,handleSForwardEdit:X,_testLocalSForwardInfo:x,clearSForwardTimeout:G,getSForwardMachines:A}=ot(),{connections:K,forwardConnections:O,_getForwardConnections:q,tuntapConnections:Q,_getTuntapConnections:j,handleTunnelConnections:$,clearConnectionsTimeout:H}=Ee(),{_getUpdater:J,clearUpdaterTimeout:Y}=(0,B.d)(),Z=e=>{n.page.Request.Prop=e.prop,n.page.Request.Asc="ascending"==e.order;let t=new Promise(((e,t)=>{e()}));if("tunnel"==e.prop){const e=S(n.page.Request.Asc);e.length>0&&(t=f(e))}else if("tuntap"==e.prop){const e=L(n.page.Request.Asc);e.length>0&&(t=f(e))}t.then((()=>{h()})).catch((()=>{}))},ee=e=>{R(e,n.page.List.filter((t=>t.MachineId==e))[0].MachineName)},te=e=>{n.page.Request.Name=e||"",n.page.Request.Name?n.page.Request.Ids=C(n.page.Request.Name).concat(U(n.page.Request.Name)).concat(A(n.page.Request.Name)).reduce(((e,t)=>(-1==e.indexOf(t)&&e.push(t),e)),[]):n.page.Request.Ids=[],h(),V(),b(),de.nk.success({message:"刷新成功",grouping:!0})},ae=()=>{h(),V(),b(),de.nk.success({message:"刷新成功",grouping:!0})};return(0,l.sV)((()=>{(0,s.jH)((e=>{e&&(h(),r(),V(),b())})),r(),d(),v(),y(),q(),j(),P(),N(),J(),z(),x()})),(0,l.hi)((()=>{g(),H(),F(),I(),W(),G(),Y()})),{state:a,devices:n,machineId:o,handleSortChange:Z,handleDeviceEdit:c,handlePageRefresh:te,handlePageSearch:ae,handlePageChange:h,handlePageSizeChange:m,handleDel:p,tuntap:w,handleTuntapEdit:k,handleTuntapRefresh:b,tunnel:T,connections:K,handleTunnelEdit:_,handleTunnelRefresh:V,handleTunnelConnections:$,forward:E,_handleForwardEdit:ee,sforward:D,handleSForwardEdit:X}}};const Jt=(0,b.A)(Ht,[["render",d],["__scopeId","data-v-6aa4e468"]]);var Yt=Jt}}]);